/*! For license information please see 906.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkbee_maze_game=self.webpackChunkbee_maze_game||[]).push([[906],{906:(e,t,n)=>{n.r(t),n.d(t,{BeeGame:()=>Ze,default:()=>Ke});var i=n(437);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}var s=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.overlay=null,this.loadingProgress=null,this.menuButtons=[],this.isLoading=!0,this.isMenuActive=!1,this.createOverlay()},(t=[{key:"createOverlay",value:function(){var e=this,t=document.getElementById("loading-screen");t&&(t.style.display="none"),this.overlay=document.createElement("div"),this.overlay.id="vibejam-overlay",this.overlay.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: #000;\n        color: white;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        z-index: 2000;\n        font-family: Arial, sans-serif;\n      ";var n=document.createElement("h1");n.textContent="#vibeJam",n.style.cssText="\n        font-size: 48px;\n        color: #ffd700;\n        margin-bottom: 40px;\n        letter-spacing: 2px;\n        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);\n      ";var i=document.createElement("h2");i.textContent="powered by Ai",i.style.cssText="\n        font-size: 36px;\n        color: #ffd700;\n        margin-bottom: 20px;\n      ";var r=document.createElement("div");r.className="loading-content",r.style.cssText="\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        transition: opacity 0.5s;\n      ";var a=document.createElement("p");a.textContent="Loading game...",a.style.cssText="\n        font-size: 18px;\n        margin-bottom: 10px;\n      ";var o=document.createElement("div");o.style.cssText="\n        width: 300px;\n        height: 10px;\n        background-color: #333;\n        border-radius: 5px;\n        margin: 20px 0;\n        overflow: hidden;\n      ",this.loadingProgress=document.createElement("div"),this.loadingProgress.style.cssText="\n        height: 100%;\n        width: 0%;\n        background-color: #ffd700;\n        transition: width 0.3s;\n      ",o.appendChild(this.loadingProgress),r.appendChild(a),r.appendChild(o);var s=document.createElement("div");s.className="menu-content",s.style.cssText="\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        opacity: 0;\n        transform: translateY(20px);\n        transition: opacity 0.5s, transform 0.5s;\n        pointer-events: none;\n      ";var l=document.createElement("p");l.textContent="play until you win",l.style.cssText="\n        font-size: 18px;\n        margin-bottom: 30px;\n        max-width: 600px;\n        text-align: center;\n      ",s.appendChild(l);var c=this.createButton("Start Game",(function(){e.game.startGame(),e.hideOverlay()}));s.appendChild(c),this.menuButtons.push(c);var h=this.createButton("Controls",(function(){e.game.ui&&"function"==typeof e.game.ui.toggleControlsHelp&&e.game.ui.toggleControlsHelp()}));s.appendChild(h),this.menuButtons.push(h);var u=document.createElement("div");u.style.cssText="\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        z-index: -1;\n      ";for(var p=0;p<20;p++){var d=document.createElement("div"),m=50+100*Math.random(),y=100*Math.random(),f=100*Math.random(),v=5*Math.random(),g=5+10*Math.random();d.style.cssText="\n          position: absolute;\n          width: ".concat(m,"px;\n          height: ").concat(m,"px;\n          left: ").concat(y,"vw;\n          top: ").concat(f,"vh;\n          background-color: rgba(255, 215, 0, 0.1);\n          clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);\n          animation: float").concat(p," ").concat(g,"s ease-in-out ").concat(v,"s infinite alternate;\n        ");var b=document.createElement("style");b.textContent="\n          @keyframes float".concat(p," {\n            0% { transform: translateY(0) rotate(0deg); opacity: 0.1; }\n            100% { transform: translateY(-").concat(20+30*Math.random(),"px) rotate(").concat(20*Math.random(),"deg); opacity: 0.2; }\n          }\n        "),document.head.appendChild(b),u.appendChild(d)}this.overlay.appendChild(u),this.overlay.appendChild(n),this.overlay.appendChild(i),this.overlay.appendChild(r),this.overlay.appendChild(s),document.body.appendChild(this.overlay),this.loadingContainer=r,this.menuContainer=s}},{key:"createButton",value:function(e,t){var n=document.createElement("button");return n.textContent=e,n.className="menu-button",n.style.cssText="\n        padding: 12px 24px;\n        margin: 10px 0;\n        font-size: 18px;\n        background-color: #ffc107;\n        color: #333;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n        transition: background-color 0.2s;\n        min-width: 180px;\n      ",n.addEventListener("mouseover",(function(){n.style.backgroundColor="#ffda44"})),n.addEventListener("mouseout",(function(){n.style.backgroundColor="#ffc107"})),n.addEventListener("click",t),n}},{key:"updateProgress",value:function(e){var t=this;this.loadingProgress&&(this.loadingProgress.style.width="".concat(e,"%")),e>=100&&this.isLoading&&(this.isLoading=!1,setTimeout((function(){return t.showMenu()}),500))}},{key:"showMenu",value:function(){this.isMenuActive||(this.isMenuActive=!0,this.loadingContainer&&(this.loadingContainer.style.opacity="0",this.loadingContainer.style.pointerEvents="none"),this.menuContainer&&(this.menuContainer.style.opacity="1",this.menuContainer.style.transform="translateY(0)",this.menuContainer.style.pointerEvents="auto"))}},{key:"hideOverlay",value:function(){var e=this;this.overlay&&(this.overlay.style.transition="opacity 0.5s",this.overlay.style.opacity="0",setTimeout((function(){e.overlay&&e.overlay.parentNode&&(e.overlay.parentNode.removeChild(e.overlay),e.overlay=null)}),500))}}])&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),l=n(92);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,d(i.key),i)}}function d(e){var t=function(e){if("object"!=c(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:t+""}var m=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.models={},this.textures={},this.sounds={},this.animations={},this.totalAssets=0,this.loadedAssets=0,this.loadingErrors=0,this.gltfLoader=new l.B,this.textureLoader=new i.Tap,this.audioLoader=new i.Am1,this.onProgressCallback=null,this.loadingQueue=[],this.isProcessingQueue=!1,this.assetPaths={models:{bee:"assets/models/bee.glb",ant:"assets/models/ant_enemy.glb"},textures:{spaceSkybox:"assets/textures/dark_forest_high.png"},sounds:{}}},t=[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.onProgressCallback=e,this.totalAssets=Object.keys(this.assetPaths.models).length+Object.keys(this.assetPaths.textures).length+Object.keys(this.assetPaths.sounds).length,this.loadedAssets=0,this.loadingErrors=0,this.queueModelLoads(),this.queueTextureLoads(),this.processQueue()}},{key:"queueModelLoads",value:function(){for(var e=this,t=this.assetPaths.models,n=function(){var t=h(r[i],2),n=t[0],a=t[1];e.loadingQueue.push((function(){return e.loadModel(n,a)}))},i=0,r=Object.entries(t);i<r.length;i++)n()}},{key:"queueTextureLoads",value:function(){for(var e=this,t=this.assetPaths.textures,n=function(){var t=h(r[i],2),n=t[0],a=t[1];e.loadingQueue.push((function(){return e.loadTexture(n,a)}))},i=0,r=Object.entries(t);i<r.length;i++)n()}},{key:"processQueue",value:function(){var e=this;return this.isProcessingQueue?Promise.resolve():(this.isProcessingQueue=!0,new Promise((function(t){var n=function(){if(0===e.loadingQueue.length)return e.isProcessingQueue=!1,void t();e.loadingQueue.shift()().catch((function(t){console.error("Error loading asset:",t),e.loadingErrors++,e.updateProgress()})).finally((function(){setTimeout(n,10)}))};n()})))}},{key:"loadModel",value:function(e,t){var n=this;return new Promise((function(i,r){n.gltfLoader.load(t,(function(t){n.models[e]={scene:t.scene,animations:t.animations},t.animations&&t.animations.length>0&&(n.animations[e]=t.animations),t.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),n.loadedAssets++,n.updateProgress(),i(t)}),(function(e){}),(function(t){console.error("Error loading model ".concat(e,":"),t),n.createFallbackModel(e),r(t)}))}))}},{key:"loadTexture",value:function(e,t){var n=this;return new Promise((function(r,a){n.textureLoader.load(t,(function(t){t.colorSpace=i.er$,e.includes("Skybox")&&(t.mapping=i.wfO),n.textures[e]=t,n.loadedAssets++,n.updateProgress(),r(t)}),void 0,(function(t){console.error("Error loading texture ".concat(e,":"),t),n.createFallbackTexture(e),a(t)}))}))}},{key:"createFallbackModel",value:function(e){var t,n;if("bee"===e){var r=new i.YJl;t=new i.Gu$(1,16,16),n=new i.tXL({color:16763904});var a=new i.eaF(t,n);a.scale.set(1,.8,1.2),r.add(a);var o=new i.tcD(.5,16),s=new i.tXL({color:16777215,transparent:!0,opacity:.4,side:i.$EB}),l=new i.eaF(o,s);l.position.set(-.5,.2,.5),l.rotation.z=Math.PI/6,l.rotation.y=Math.PI/8,l.scale.set(.5,.5,.5),l.name="leftWing",r.add(l);var c=new i.eaF(o,s);c.position.set(.5,.2,.5),c.rotation.z=-Math.PI/6,c.rotation.y=-Math.PI/8,c.scale.set(.5,.5,.5),c.name="rightWing",r.add(c),this.models[e]={scene:r,animations:[]}}else if("ant"===e){var h=new i.YJl;n=new i.tXL({color:16724736}),t=new i.Gu$(.5,16,16);var u=new i.eaF(t,n);u.position.set(0,0,.8),h.add(u),t=new i.Gu$(.4,16,16);var p=new i.eaF(t,n);p.position.set(0,0,0),h.add(p),t=new i.Gu$(.7,16,16);var d=new i.eaF(t,n);d.position.set(0,0,-.9),h.add(d),t=new i.Ho_(.05,.05,1,8);for(var m=0;m<6;m++){var y=new i.eaF(t,n),f=m%2==0?1:-1,v=Math.floor(m/2)-1;y.position.set(.5*f,0,.5*v),y.rotation.z=f*Math.PI/4,y.rotation.y=.3*v,h.add(y)}this.models[e]={scene:h,animations:[]}}else{t=new i.iNn(1,1,1),n=new i.qBx;var g=new i.eaF(t,n),b=new i.YJl;b.add(g),this.models[e]={scene:b,animations:[]}}this.loadedAssets++,this.updateProgress()}},{key:"createFallbackTexture",value:function(e){var t=document.createElement("canvas");t.width=512,t.height=512;var n=t.getContext("2d");if("honeycomb"===e){n.fillStyle="#FFCC66",n.fillRect(0,0,t.width,t.height),n.fillStyle="#FF8800";for(var r=0;r<t.height;r+=75)for(var a=0;a<t.width;a+=86.5){var o=Math.floor(r/75)%2*50*.865;n.beginPath();for(var s=0;s<6;s++){var l=Math.PI/3*s,c=a+o+50*Math.cos(l),h=r+50*Math.sin(l);0===s?n.moveTo(c,h):n.lineTo(c,h)}n.closePath(),n.fill()}}else if(e.includes("Skybox")){var u=n.createLinearGradient(0,0,0,t.height);if("forestSkybox"===e?(u.addColorStop(0,"#87CEEB"),u.addColorStop(1,"#E0F7FA")):(u.addColorStop(0,"#000000"),u.addColorStop(.5,"#0B3D91"),u.addColorStop(1,"#111111")),n.fillStyle=u,n.fillRect(0,0,t.width,t.height),"spaceSkybox"===e){n.fillStyle="#FFFFFF";for(var p=0;p<100;p++){var d=Math.random()*t.width,m=Math.random()*t.height,y=2*Math.random();n.beginPath(),n.arc(d,m,y,0,2*Math.PI),n.fill()}}}else for(var f=64,v=0;v<t.height;v+=f)for(var g=0;g<t.width;g+=f){var b=(g/f+v/f)%2==0;n.fillStyle=b?"#A5A5A5":"#FFFFFF",n.fillRect(g,v,f,f)}var w=new i.GOR(t);w.colorSpace=i.er$,e.includes("Skybox")&&(w.mapping=i.wfO),this.textures[e]=w,this.loadedAssets++,this.updateProgress()}},{key:"getModel",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.models[e]?t?this.models[e].scene.clone():this.models[e].scene:(console.warn("Model '".concat(e,"' not found in AssetManager")),null)}},{key:"getAnimations",value:function(e){return this.animations[e]||null}},{key:"getTexture",value:function(e){return this.textures[e]?this.textures[e]:null}},{key:"updateProgress",value:function(){var e=this.totalAssets>0?this.loadedAssets/this.totalAssets*100:100;this.onProgressCallback&&this.onProgressCallback({loaded:this.loadedAssets,total:this.totalAssets,progress:e,errors:this.loadingErrors})}},{key:"getProgress",value:function(){return{loaded:this.loadedAssets,total:this.totalAssets,progress:this.totalAssets>0?this.loadedAssets/this.totalAssets*100:100,errors:this.loadingErrors,isComplete:this.loadedAssets>=this.totalAssets}}},{key:"isLoaded",value:function(){return this.loadedAssets>=this.totalAssets}},{key:"handleVisibilityChange",value:function(){document.hidden}},{key:"dispose",value:function(){var e=this;Object.values(this.models).forEach((function(t){t.scene&&t.scene.traverse((function(t){t.isMesh&&(t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach((function(t){return e.disposeMaterial(t)})):e.disposeMaterial(t.material)))}))})),Object.values(this.textures).forEach((function(e){e&&"function"==typeof e.dispose&&e.dispose()})),this.models={},this.textures={},this.animations={},this.totalAssets=0,this.loadedAssets=0,this.loadingErrors=0}},{key:"disposeMaterial",value:function(e){e&&(Object.values(e).forEach((function(e){e&&e.isTexture&&e.dispose()})),e.dispose())}}],t&&p(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function f(){f=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,i){var a=t&&t.prototype instanceof b?t:b,o=Object.create(a.prototype),s=new O(i||[]);return r(o,"_invoke",{value:T(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",d="suspendedYield",m="executing",v="completed",g={};function b(){}function w(){}function x(){}var k={};c(k,o,(function(){return this}));var S=Object.getPrototypeOf,P=S&&S(S(D([])));P&&P!==n&&i.call(P,o)&&(k=P);var M=x.prototype=b.prototype=Object.create(k);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(r,a,o,s){var l=u(e[r],e,a);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==y(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var a;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return a=a?a.then(r,r):r()}})}function T(t,n,i){var r=p;return function(a,o){if(r===m)throw Error("Generator is already running");if(r===v){if("throw"===a)throw o;return{value:e,done:!0}}for(i.method=a,i.arg=o;;){var s=i.delegate;if(s){var l=A(s,i);if(l){if(l===g)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===p)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var c=u(t,n,i);if("normal"===c.type){if(r=i.done?v:d,c.arg===g)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r=v,i.method="throw",i.arg=c.arg)}}}function A(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var a=u(r,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var o=a.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function z(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(z,this),this.reset(!0)}function D(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(y(t)+" is not iterable")}return w.prototype=x,r(M,"constructor",{value:x,configurable:!0}),r(x,"constructor",{value:w,configurable:!0}),w.displayName=c(x,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c(e,l,"GeneratorFunction")),e.prototype=Object.create(M),e},t.awrap=function(e){return{__await:e}},C(E.prototype),c(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new E(h(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(M),c(M,l,"Generator"),c(M,o,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=D,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;L(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:D(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),g}},t}function v(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){v(a,i,r,o,s,"next",e)}function s(e){v(a,i,r,o,s,"throw",e)}o(void 0)}))}}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,w(i.key),i)}}function w(e){var t=function(e){if("object"!=y(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==y(t)?t:t+""}var x=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.buffers=new Map,this.currentMusicSource=null,this.isMuted=!1,this.volume=.2,this.masterGain=this.audioContext.createGain(),this.masterGain.gain.setValueAtTime(this.volume,this.audioContext.currentTime),this.masterGain.connect(this.audioContext.destination)}catch(e){this.audioContext=null}},t=[{key:"resumeContext",value:function(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().then((function(){})).catch((function(e){return console.error("Error resuming AudioContext:",e)}))}},{key:"loadSounds",value:(n=g(f().mark((function e(t){var n,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioContext){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t.map(function(){var e=g(f().mark((function e(t){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t.path);case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("HTTP error! status: ".concat(n.status," for ").concat(t.path));case 6:return e.next=8,n.arrayBuffer();case 8:return r=e.sent,e.next=11,i.audioContext.decodeAudioData(r);case 11:a=e.sent,i.buffers.set(t.name,a),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),i.buffers.set(t.name,null);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}()),e.next=5,Promise.all(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"playSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!this.audioContext)return null;var i=this.buffers.get(e);if(!i)return null;var r=this.audioContext.createBufferSource();r.buffer=i,r.loop=t;var a=this.audioContext.createGain();return a.gain.setValueAtTime(n,this.audioContext.currentTime),r.connect(a),a.connect(this.masterGain),r.start(0),r}},{key:"stopMusic",value:function(){if(this.currentMusicSource){try{this.currentMusicSource.stop(),this.currentMusicSource.disconnect()}catch(e){}this.currentMusicSource=null}}},{key:"playMusic",value:function(e){if(this.audioContext&&e&&0!==e.length){this.stopMusic();var t=e[Math.floor(Math.random()*e.length)];this.currentMusicSource=this.playSound(t,!0),this.currentMusicSource?this.currentMusicSource.onended=function(){}:console.error("Failed to play music track: ".concat(t))}}},{key:"setVolume",value:function(e){this.audioContext&&this.masterGain&&(this.volume=Math.max(0,Math.min(1,e)),this.isMuted||this.masterGain.gain.setValueAtTime(this.volume,this.audioContext.currentTime))}},{key:"toggleMute",value:function(){return this.audioContext&&this.masterGain?(this.isMuted=!this.isMuted,this.isMuted?this.masterGain.gain.setValueAtTime(0,this.audioContext.currentTime):this.masterGain.gain.setValueAtTime(this.volume,this.audioContext.currentTime),this.isMuted):this.isMuted}},{key:"getMuteState",value:function(){return this.isMuted}},{key:"pauseAll",value:function(){this.audioContext&&"running"===this.audioContext.state&&this.audioContext.suspend().then((function(){})).catch((function(e){return console.error("Error suspending AudioContext:",e)}))}},{key:"resumeAll",value:function(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().then((function(){})).catch((function(e){return console.error("Error resuming AudioContext:",e)}))}}],t&&b(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,P(i.key),i)}}function P(e){var t=function(e){if("object"!=k(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==k(t)?t:t+""}var M=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scene=t.scene,this.treeGroup=new i.YJl,this.scene.add(this.treeGroup),this.createBackgroundPlane(),this.p5Instance=null,this.animationStarted=!1,this.transitionTriggered=!1,this.transitionProgress=0,this.autoTransitionEnabled=!0,this.initP5Animation()},(t=[{key:"createBackgroundPlane",value:function(){var e=new i.bdM(2e3,1e3);this.backgroundCanvas=document.createElement("canvas"),this.backgroundCanvas.width=1024,this.backgroundCanvas.height=512,this.backgroundTexture=new i.GOR(this.backgroundCanvas),this.backgroundTexture.minFilter=i.k6q;var t=new i.V9B({map:this.backgroundTexture,transparent:!0,side:i.$EB});this.backgroundPlane=new i.eaF(e,t),this.backgroundPlane.position.set(0,0,-500),this.treeGroup.add(this.backgroundPlane)}},{key:"initP5Animation",value:function(){var e=this,t=document.getElementById("tree-hive-container");if(t||((t=document.createElement("div")).id="tree-hive-container",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.opacity="0",t.style.pointerEvents="none",t.style.zIndex="-9999",document.body.appendChild(t)),"undefined"!=typeof p5)this.createP5Sketch(t);else{var n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js",n.onload=function(){e.createP5Sketch(t)},n.onerror=function(){console.warn("Failed to load p5.js, falling back to simple animation"),e.createFallbackAnimation()},document.head.appendChild(n)}}},{key:"createP5Sketch",value:function(e){var t=this;this.p5Instance=new p5((function(e){var n=t.backgroundCanvas,i=n.getContext("2d"),r=[],a=[],o=[],s={background:[255,248,220],honeycomb:[255,204,50],hiveOutline:[165,115,30],honeyDrop:[255,204,0],bee:[0,0,0]};e.setup=function(){e.noCanvas();for(var i=-2;i<n.height/60+2;i++)for(var s=-2;s<n.width/69.2+2;s++){var l=40*s*1.73+i%2*40*.865,c=40*i*1.5,h=.2+.8*Math.random();r.push({x:l,y:c,size:40*h,z:h,honey:Math.random()>.3,honeyLevel:.1+.7*Math.random(),pulse:Math.random()*Math.PI*2})}for(var u=0;u<10;u++)t.addHoneyDrop(a,n);for(var p=0;p<8;p++)o.push({x:Math.random()*n.width,y:Math.random()*n.height,size:5+5*Math.random(),speedX:2*(Math.random()-.5),speedY:2*(Math.random()-.5),wingPhase:Math.random()*Math.PI*2,wingSpeed:.2+.2*Math.random()});t.animationStarted=!0},e.draw=function(){if(t.animationStarted){i.fillStyle="rgb(".concat(s.background.join(","),")"),i.fillRect(0,0,n.width,n.height),i.fillStyle="rgb(".concat(s.hiveOutline.join(","),")"),i.beginPath(),i.ellipse(n.width/2,n.height+100,n.width/1.5,200,0,Math.PI,!1),i.fill();var l=n.width/2,c=n.height/2,h=i.createRadialGradient(l,c,40,l,c,160);h.addColorStop(0,"rgba(255, 204, 50, 0.6)"),h.addColorStop(1,"rgba(255, 204, 50, 0)"),i.fillStyle=h,i.beginPath(),i.arc(l,c,160,0,2*Math.PI),i.fill(),i.fillStyle="rgba(40, 26, 13, 0.8)",i.beginPath(),i.arc(l,c,80,0,2*Math.PI),i.fill(),t.drawHoneycomb(i,r,s,e),t.updateHoneyDrops(i,a,n,s),t.updateBees(i,o,n,s,e),t.transitionTriggered?t.updateTransitionEffect(i,l,c,80,n):t.autoTransitionEnabled&&"playing"===t.game.gameState&&(setTimeout((function(){"playing"===t.game.gameState&&t.triggerTransition()}),2e3),t.autoTransitionEnabled=!1),t.backgroundTexture.needsUpdate=!0}}}),e)}},{key:"drawHoneycomb",value:function(e,t,n,i){var r=i?i.millis()/1e3:performance.now()/1e3,a=function(t,n,i){e.beginPath();for(var r=0;r<6;r++){var a=Math.PI/3*r-Math.PI/6,o=t+i*Math.cos(a),s=n+i*Math.sin(a);0===r?e.moveTo(o,s):e.lineTo(o,s)}e.closePath()};t.forEach((function(t){var i=1+.05*Math.sin(.5*r+t.pulse),o=t.size*i;if(e.fillStyle="rgba(".concat(n.hiveOutline.join(","),", 0.8)"),a(t.x,t.y,1.05*o),e.fill(),e.fillStyle="rgba(".concat(n.honeycomb.join(","),", ").concat(.4+.6*t.z,")"),a(t.x,t.y,o),e.fill(),t.honey){var s=.95+.05*Math.sin(.8*r+.01*t.x+.01*t.y);e.fillStyle="rgba(".concat(n.honeyDrop.join(","),", 0.7)"),a(t.x,t.y,o*t.honeyLevel*s),e.fill();var l=t.x-.2*o,c=t.y-.2*o,h=.3*o;e.fillStyle="rgba(255, 255, 255, 0.4)",e.beginPath(),e.arc(l,c,h,0,2*Math.PI),e.fill()}}))}},{key:"addHoneyDrop",value:function(e,t){e.push({x:Math.random()*t.width,y:-20,size:5+10*Math.random(),speed:.5+1.5*Math.random(),lifetime:0,maxLifetime:100+100*Math.random()})}},{key:"updateHoneyDrops",value:function(e,t,n,i){for(var r=t.length-1;r>=0;r--){var a=t[r];a.y+=a.speed,a.lifetime++,e.fillStyle="rgba(".concat(i.honeyDrop.join(","),", 0.8)"),e.beginPath(),e.arc(a.x,a.y,a.size,0,2*Math.PI),e.fill(),e.fillStyle="rgba(".concat(i.honeyDrop.join(","),", 0.4)");for(var o=1;o<=5;o++){var s=a.y-2*o*a.speed,l=a.size*(1-.15*o);e.beginPath(),e.arc(a.x,s,l,0,2*Math.PI),e.fill()}(a.y>n.height+20||a.lifetime>a.maxLifetime)&&(t.splice(r,1),this.addHoneyDrop(t,n))}}},{key:"updateBees",value:function(e,t,n,i,r){var a=r?r.millis()/1e3:performance.now()/1e3;t.forEach((function(t){t.x+=t.speedX,t.y+=t.speedY,(t.x<0||t.x>n.width)&&(t.speedX*=-1),(t.y<0||t.y>n.height)&&(t.speedY*=-1),e.fillStyle="rgb(".concat(i.bee.join(","),")"),e.beginPath(),e.ellipse(t.x,t.y,t.size,1.5*t.size,Math.atan2(t.speedY,t.speedX),0,2*Math.PI),e.fill(),e.fillStyle="rgb(".concat(i.honeycomb.join(","),")"),e.beginPath(),e.ellipse(t.x-t.speedX*t.size*.2,t.y-t.speedY*t.size*.2,.8*t.size,.8*t.size,Math.atan2(t.speedY,t.speedX),0,2*Math.PI),e.fill();var r=.5*Math.sin(a*t.wingSpeed*10+t.wingPhase);e.fillStyle="rgba(255, 255, 255, 0.7)",e.save(),e.translate(t.x,t.y),e.rotate(Math.atan2(t.speedY,t.speedX)+Math.PI/2+r),e.beginPath(),e.ellipse(.8*-t.size,0,.5*t.size,t.size,0,0,2*Math.PI),e.fill(),e.restore(),e.save(),e.translate(t.x,t.y),e.rotate(Math.atan2(t.speedY,t.speedX)+Math.PI/2-r),e.beginPath(),e.ellipse(.8*t.size,0,.5*t.size,t.size,0,0,2*Math.PI),e.fill(),e.restore()}))}},{key:"updateTransitionEffect",value:function(e,t,n,i,r){this.transitionProgress+=.02,e.fillStyle="rgba(0, 0, 0, ".concat(.5*this.transitionProgress,")"),e.fillRect(0,0,r.width,r.height);var a=i*(1+10*this.transitionProgress);e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.arc(t,n,a,0,2*Math.PI),e.fill();for(var o=0;o<5;o++){var s=Math.random()*Math.PI*2,l=.8*a*Math.random(),c=2+8*Math.random();e.fillStyle="rgba(255, 204, 0, 0.7)",e.beginPath(),e.arc(t+Math.cos(s)*l,n+Math.sin(s)*l,c,0,2*Math.PI),e.fill()}this.transitionProgress>=1&&this.completeTransition()}},{key:"createFallbackAnimation",value:function(){var e=this,t=this.backgroundCanvas.getContext("2d"),n=function(){e.animationStarted||(e.animationStarted=!0),t.fillStyle="#FFF8DC",t.fillRect(0,0,e.backgroundCanvas.width,e.backgroundCanvas.height);var i=e.backgroundCanvas.width/2,r=e.backgroundCanvas.height/2,a=t.createRadialGradient(i,r,40,i,r,160);a.addColorStop(0,"rgba(255, 204, 50, 0.6)"),a.addColorStop(1,"rgba(255, 204, 50, 0)"),t.fillStyle=a,t.beginPath(),t.arc(i,r,160,0,2*Math.PI),t.fill(),t.fillStyle="rgba(40, 26, 13, 0.8)",t.beginPath(),t.arc(i,r,80,0,2*Math.PI),t.fill(),e.backgroundTexture.needsUpdate=!0,e.transitionTriggered?e.updateTransitionEffect(t,i,r,80,e.backgroundCanvas):e.autoTransitionEnabled&&"playing"===e.game.gameState&&(setTimeout((function(){"playing"===e.game.gameState&&e.triggerTransition()}),2e3),e.autoTransitionEnabled=!1),e.animationStarted&&requestAnimationFrame(n)};n()}},{key:"triggerTransition",value:function(){this.transitionTriggered=!0,this.transitionProgress=0}},{key:"completeTransition",value:function(){this.game&&"function"==typeof this.game.switchEnvironment&&this.game.switchEnvironment("interior"),this.transitionTriggered=!1,this.transitionProgress=0}},{key:"update",value:function(){if(this.backgroundPlane&&this.game.camera){var e=this.game.camera.position.clone();if("exterior"===this.game.currentEnvironment){var t=new i.Pq0(0,0,-1).applyQuaternion(this.game.camera.quaternion),n=e.clone().add(t.multiplyScalar(500));this.backgroundPlane.position.copy(n),this.backgroundPlane.lookAt(e)}}}},{key:"checkEntranceCollision",value:function(e,t){return!1}}])&&S(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,T(i.key),i)}}function T(e){var t=function(e){if("object"!=C(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==C(t)?t:t+""}var A=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.createMenuScreen(),this.createGameOverScreen(),this.createVictoryScreen(),this.createControlsHelp(),this.createVolumeControl(),this.createPauseScreen(),this.updateGameState("menu")},(t=[{key:"createMenuScreen",value:function(){var e=this;this.menuScreen=document.createElement("div"),this.menuScreen.style.position="absolute",this.menuScreen.style.top="0",this.menuScreen.style.left="0",this.menuScreen.style.width="100%",this.menuScreen.style.height="100%",this.menuScreen.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.menuScreen.style.display="flex",this.menuScreen.style.flexDirection="column",this.menuScreen.style.alignItems="center",this.menuScreen.style.justifyContent="center",this.menuScreen.style.color="white",this.menuScreen.style.fontFamily="Arial, sans-serif";var t=document.createElement("h1");t.textContent="Get the Queen",t.style.fontSize="48px",t.style.marginBottom="20px",t.style.color="#ffd700",this.menuScreen.appendChild(t);var n=document.createElement("h2");n.textContent="Navigate through the honeycomb maze to find the queen bee!",n.style.fontSize="24px",n.style.marginBottom="40px",n.style.maxWidth="600px",n.style.textAlign="center",this.menuScreen.appendChild(n);var i=this.createButton("Start Game",(function(){return e.game.startGame()}));i.style.marginBottom="20px",this.menuScreen.appendChild(i);var r=this.createButton("Controls",(function(){return e.toggleControlsHelp()}));this.menuScreen.appendChild(r),document.body.appendChild(this.menuScreen)}},{key:"createGameOverScreen",value:function(){var e=this;this.gameOverScreen=document.createElement("div"),this.gameOverScreen.style.position="absolute",this.gameOverScreen.style.top="0",this.gameOverScreen.style.left="0",this.gameOverScreen.style.width="100%",this.gameOverScreen.style.height="100%",this.gameOverScreen.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.gameOverScreen.style.display="none",this.gameOverScreen.style.flexDirection="column",this.gameOverScreen.style.alignItems="center",this.gameOverScreen.style.justifyContent="center",this.gameOverScreen.style.color="white",this.gameOverScreen.style.fontFamily="Arial, sans-serif";var t=document.createElement("h1");t.textContent="Game Over",t.style.fontSize="48px",t.style.marginBottom="20px",t.style.color="#ff4444",this.gameOverScreen.appendChild(t);var n=document.createElement("p");n.textContent="You got lost in the honeycomb maze!",n.style.fontSize="24px",n.style.marginBottom="20px",this.gameOverScreen.appendChild(n),this.gameOverTimeDisplay=document.createElement("p"),this.gameOverTimeDisplay.style.fontSize="20px",this.gameOverTimeDisplay.style.marginBottom="30px",this.gameOverScreen.appendChild(this.gameOverTimeDisplay);var i=this.createButton("Try Again",(function(){return e.game.startGame()}));i.style.marginBottom="20px",this.gameOverScreen.appendChild(i);var r=this.createButton("Main Menu",(function(){e.game.gameState="menu",e.updateGameState("menu")}));this.gameOverScreen.appendChild(r),document.body.appendChild(this.gameOverScreen)}},{key:"createVictoryScreen",value:function(){var e=this;this.victoryScreen=document.createElement("div"),this.victoryScreen.style.position="absolute",this.victoryScreen.style.top="0",this.victoryScreen.style.left="0",this.victoryScreen.style.width="100%",this.victoryScreen.style.height="100%",this.victoryScreen.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.victoryScreen.style.display="none",this.victoryScreen.style.flexDirection="column",this.victoryScreen.style.alignItems="center",this.victoryScreen.style.justifyContent="center",this.victoryScreen.style.color="white",this.victoryScreen.style.fontFamily="Arial, sans-serif";var t=document.createElement("h1");t.textContent="Victory!",t.style.fontSize="48px",t.style.marginBottom="20px",t.style.color="#ffd700",this.victoryScreen.appendChild(t);var n=document.createElement("p");n.textContent="You found the queen bee!",n.style.fontSize="24px",n.style.marginBottom="20px",this.victoryScreen.appendChild(n),this.victoryTimeDisplay=document.createElement("p"),this.victoryTimeDisplay.style.fontSize="20px",this.victoryTimeDisplay.style.marginBottom="30px",this.victoryScreen.appendChild(this.victoryTimeDisplay);var i=this.createButton("Play Again",(function(){return e.game.startGame()}));i.style.marginBottom="20px",this.victoryScreen.appendChild(i);var r=this.createButton("Main Menu",(function(){e.game.gameState="menu",e.updateGameState("menu")}));this.victoryScreen.appendChild(r),document.body.appendChild(this.victoryScreen)}},{key:"createControlsHelp",value:function(){var e=this;this.controlsHelp=document.createElement("div"),this.controlsHelp.style.position="absolute",this.controlsHelp.style.top="50%",this.controlsHelp.style.left="50%",this.controlsHelp.style.transform="translate(-50%, -50%)",this.controlsHelp.style.width="400px",this.controlsHelp.style.padding="20px",this.controlsHelp.style.backgroundColor="rgba(0, 0, 0, 0.8)",this.controlsHelp.style.borderRadius="10px",this.controlsHelp.style.color="white",this.controlsHelp.style.fontFamily="Arial, sans-serif",this.controlsHelp.style.display="none",this.controlsHelp.style.zIndex="100";var t=document.createElement("h2");t.textContent="Controls",t.style.fontSize="24px",t.style.marginBottom="15px",t.style.textAlign="center",this.controlsHelp.appendChild(t);var n=document.createElement("ul");n.style.listStyleType="none",n.style.padding="0",n.style.marginBottom="20px",[{key:"W / Arrow Up",action:"Turn and move upward"},{key:"S / Arrow Down",action:"Turn and move downward"},{key:"A / Arrow Left",action:"Turn and move left"},{key:"D / Arrow Right",action:"Turn and move right"},{key:"Space",action:"Boost Speed (temporary)"},{key:"Esc",action:"Pause Game"}].forEach((function(e){var t=document.createElement("li");t.style.margin="10px 0";var i=document.createElement("span");i.textContent=e.key,i.style.display="inline-block",i.style.width="150px",i.style.backgroundColor="#333",i.style.padding="3px 8px",i.style.borderRadius="4px",i.style.marginRight="10px",i.style.textAlign="center";var r=document.createElement("span");r.textContent=e.action,t.appendChild(i),t.appendChild(r),n.appendChild(t)})),this.controlsHelp.appendChild(n);var i=this.createButton("Close",(function(){return e.toggleControlsHelp()}));i.style.margin="0 auto",i.style.display="block",this.controlsHelp.appendChild(i),document.body.appendChild(this.controlsHelp)}},{key:"createButton",value:function(e,t){var n=document.createElement("button");return n.textContent=e,n.style.padding="12px 24px",n.style.fontSize="18px",n.style.backgroundColor="#ffc107",n.style.color="#333",n.style.border="none",n.style.borderRadius="5px",n.style.cursor="pointer",n.style.textAlign="center",n.style.transition="background-color 0.2s",n.addEventListener("mouseover",(function(){n.style.backgroundColor="#ffda44"})),n.addEventListener("mouseout",(function(){n.style.backgroundColor="#ffc107"})),n.addEventListener("click",t),n}},{key:"createPauseScreen",value:function(){var e=this;this.pauseScreen&&document.body.removeChild(this.pauseScreen),this.pauseScreen=document.createElement("div"),this.pauseScreen.style.position="absolute",this.pauseScreen.style.top="0",this.pauseScreen.style.left="0",this.pauseScreen.style.width="100%",this.pauseScreen.style.height="100%",this.pauseScreen.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.pauseScreen.style.display="none",this.pauseScreen.style.flexDirection="column",this.pauseScreen.style.alignItems="center",this.pauseScreen.style.justifyContent="center",this.pauseScreen.style.color="white",this.pauseScreen.style.fontFamily="Arial, sans-serif",this.pauseScreen.style.zIndex="999";var t=document.createElement("h1");t.textContent="GAME PAUSED",t.style.fontSize="48px",t.style.marginBottom="40px",t.style.color="#ffd700",this.pauseScreen.appendChild(t);var n=document.createElement("div");n.style.backgroundColor="rgba(0, 0, 0, 0.5)",n.style.padding="20px",n.style.borderRadius="10px",n.style.marginBottom="40px",n.style.minWidth="300px",n.style.textAlign="center";var i=document.createElement("div");i.textContent="Mouse Sensitivity",i.style.fontSize="24px",i.style.marginBottom="15px",n.appendChild(i);var r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center";var a=document.createElement("input");a.type="range",a.min="0.2",a.max="3.0",a.step="0.1",a.value=this.game.player?this.game.player.mouseSensitivity:"2.0",a.style.width="200px",a.style.height="25px",a.style.accentColor="#ffd700",a.addEventListener("input",(function(){var t=parseFloat(a.value);e.game.player&&(e.game.player.mouseSensitivity=t,console.log("Sensitivity updated to:",t)),o.textContent=t.toFixed(1)+"x"})),r.appendChild(a);var o=document.createElement("span");o.textContent=a.value+"x",o.style.marginLeft="15px",o.style.fontSize="20px",o.style.minWidth="50px",r.appendChild(o),n.appendChild(r),this.pauseScreen.appendChild(n);var s=document.createElement("p");s.textContent="Press ESC to continue",s.style.fontSize="24px",this.pauseScreen.appendChild(s),document.body.appendChild(this.pauseScreen)}},{key:"toggleControlsHelp",value:function(){"none"===this.controlsHelp.style.display?this.controlsHelp.style.display="block":this.controlsHelp.style.display="none"}},{key:"updateGameState",value:function(e,t){switch(this.menuScreen.style.display="none",this.gameOverScreen.style.display="none",this.victoryScreen.style.display="none",this.pauseScreen.style.display="none",e){case"menu":this.menuScreen.style.display="flex";break;case"playing":break;case"paused":this.pauseScreen.style.display="flex";break;case"gameover":this.gameOverScreen.style.display="flex",t&&(this.gameOverTimeDisplay.textContent="Time: ".concat(this.formatTime(t)));break;case"victory":this.victoryScreen.style.display="flex",t&&(this.victoryTimeDisplay.textContent="You found the queen in: ".concat(this.formatTime(t)))}}},{key:"formatTime",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))}},{key:"createVolumeControl",value:function(){var e=this;if(this.volumeControlContainer=document.createElement("div"),this.volumeControlContainer.style.position="absolute",this.volumeControlContainer.style.bottom="20px",this.volumeControlContainer.style.right="20px",this.volumeControlContainer.style.display="flex",this.volumeControlContainer.style.alignItems="center",this.volumeControlContainer.style.backgroundColor="rgba(0, 0, 0, 0.5)",this.volumeControlContainer.style.padding="5px 10px",this.volumeControlContainer.style.borderRadius="5px",this.volumeControlContainer.style.zIndex="1001",this.volumeIcon=document.createElement("div"),this.volumeIcon.style.fontSize="24px",this.volumeIcon.style.cursor="pointer",this.volumeIcon.style.userSelect="none",this.volumeIcon.style.marginRight="10px",this.volumeIcon.textContent="🔊",this.volumeIcon.addEventListener("click",(function(){if(e.game.soundManager){var t=e.game.soundManager.toggleMute();e.updateVolumeIcon(t)}})),this.volumeControlContainer.appendChild(this.volumeIcon),this.volumeSlider=document.createElement("input"),this.volumeSlider.type="range",this.volumeSlider.min="0",this.volumeSlider.max="1",this.volumeSlider.step="0.05",this.volumeSlider.value=this.game.soundManager?this.game.soundManager.volume:"1",this.volumeSlider.style.width="80px",this.volumeSlider.style.height="5px",this.volumeSlider.style.cursor="pointer",this.volumeSlider.style.accentColor="#ffd700",this.volumeSlider.addEventListener("input",(function(t){var n=parseFloat(t.target.value);e.game.soundManager&&(e.game.soundManager.setVolume(n),e.updateVolumeIcon(0===n||e.game.soundManager.getMuteState()))})),this.volumeControlContainer.appendChild(this.volumeSlider),document.body.appendChild(this.volumeControlContainer),this.game.soundManager){var t=this.game.soundManager.getMuteState()||"0"===this.volumeSlider.value;this.updateVolumeIcon(t)}}},{key:"updateVolumeIcon",value:function(e){this.volumeIcon&&(this.volumeIcon.textContent=e?"🔇":"🔊")}}])&&E(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function L(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,O(i.key),i)}}function O(e){var t=function(e){if("object"!=z(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==z(t)?t:t+""}var D=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.updateInterval=t.updateInterval||500,this.avgSamples=t.samples||20,this.frames=0,this.lastTime=performance.now(),this.fps=0,this.fpsHistory=[],this.lastUpdate=0,this.createDisplay(t)},t=[{key:"createDisplay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.top=e.top||"10px",this.container.style.right=e.right||"10px",this.container.style.backgroundColor=e.bgColor||"rgba(0, 0, 0, 0.5)",this.container.style.color=e.textColor||"#ffffff",this.container.style.padding="6px 10px",this.container.style.borderRadius="4px",this.container.style.fontFamily="monospace",this.container.style.fontSize="14px",this.container.style.zIndex="1000",this.container.style.userSelect="none",this.container.style.transition="background-color 0.3s",document.body.appendChild(this.container),this.container.textContent="FPS: --"}},{key:"update",value:function(){var e=performance.now();if(this.frames++,e-this.lastUpdate>=this.updateInterval){var t=e-this.lastTime,n=1e3*this.frames/t;this.fpsHistory.push(n),this.fpsHistory.length>this.avgSamples&&this.fpsHistory.shift(),this.fps=this.fpsHistory.reduce((function(e,t){return e+t}),0)/this.fpsHistory.length,this.container.textContent="FPS: ".concat(Math.round(this.fps)),this.fps<30?this.container.style.backgroundColor="rgba(255, 0, 0, 0.5)":this.fps<50?this.container.style.backgroundColor="rgba(255, 165, 0, 0.5)":this.container.style.backgroundColor="rgba(0, 128, 0, 0.5)",this.frames=0,this.lastTime=e,this.lastUpdate=e}}},{key:"toggle",value:function(){this.container.style.display="none"===this.container.style.display?"block":"none"}},{key:"show",value:function(){this.container.style.display="block"}},{key:"hide",value:function(){this.container.style.display="none"}},{key:"destroy",value:function(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}}],t&&L(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function B(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,j(i.key),i)}}function j(e){var t=function(e){if("object"!=I(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==I(t)?t:t+""}var H=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scene=t.scene,this.position=new i.Pq0(0,0,0),this.velocity=new i.Pq0(0,0,0),this.direction=new i.Pq0(0,0,-1),this.accelerate=!1,this.brake=!1,this.moveUp=!1,this.moveDown=!1,this.movementProfiles={exterior:{maxSpeed:.3,moveSpeed:.2,acceleration:.005,deceleration:.01,damping:.98,boostFactor:2,boostDuration:1e3,cameraDistance:8,cameraHeight:3},interior:{maxSpeed:.9,moveSpeed:.6,acceleration:.01,deceleration:.015,damping:.99,boostFactor:2.5,boostDuration:1500,cameraDistance:12,cameraHeight:4}},this.currentProfile=this.movementProfiles.exterior,this.speed=0,this.boostActive=!1,this.boostTime=0,this.boostCooldown=3e3,this.lastBoostTime=0,this.verticalSpeed=0,this.maxVerticalSpeed=.3,this.verticalAcceleration=.003,this.verticalDamping=.95,this.yaw=0,this.pitch=0,this.mouseSensitivity=2,this.maxPitchAngle=Math.PI/2.5,this.accelerateWithMouse=!1,this.verticalSpeed=0,this.maxVerticalSpeed=.3,this.verticalAcceleration=.003,this.verticalDamping=.95,this.radius=5.5,this.collisionRecoveryTime=0,this.cameraOffset=new i.Pq0(0,2,5),this.distanceScalingFactor=1,this.targetRotation=new i.PTz,this.currentRotation=new i.PTz,this.applyMovementProfile(),this.createBeeModel()},(t=[{key:"applyMovementProfile",value:function(){this.maxSpeed=this.currentProfile.maxSpeed,this.moveSpeed=this.currentProfile.moveSpeed,this.acceleration=this.currentProfile.acceleration,this.deceleration=this.currentProfile.deceleration,this.damping=this.currentProfile.damping,this.boostFactor=this.currentProfile.boostFactor,this.boostDuration=this.currentProfile.boostDuration}},{key:"switchMovementProfile",value:function(e){this.movementProfiles[e]&&(this.currentProfile=this.movementProfiles[e],this.applyMovementProfile())}},{key:"createBeeModel",value:function(){if(this.model=new i.YJl,this.game.assetManager){var e=this.game.assetManager.getModel("bee");e?(this.model.add(e),e.rotation.x=Math.PI/2,this.model.scale.set(1.5,1.5,1.5)):this.createFallbackBeeModel()}else this.createFallbackBeeModel();this.scene.add(this.model),this.reset()}},{key:"createFallbackBeeModel",value:function(){var e=new i.Gu$(1,16,16),t=new i.tXL({color:16763904}),n=new i.eaF(e,t);n.scale.set(1,.8,1.2),this.model.add(n);var r=new i.iNn(1.1,.3,.7),a=new i.tXL({color:0}),o=new i.eaF(r,a);o.position.z=.2,this.model.add(o);var s=new i.eaF(r,a);s.position.z=-.2,this.model.add(s)}},{key:"update",value:function(){var e=performance.now();this.boostActive&&e-this.boostTime>this.boostDuration&&(this.boostActive=!1);var t=new i.Pq0(0,0,0),n=new i.Pq0(0,0,-1).applyQuaternion(this.currentRotation),r=new i.Pq0(1,0,0).applyQuaternion(this.currentRotation);if(this.moveUp&&t.add(n),this.moveDown&&t.sub(n),this.moveLeft&&t.sub(r),this.moveRight&&t.add(r),t.lengthSq()>0){t.normalize();var a=t.multiplyScalar(this.boostActive?this.maxSpeed*this.boostFactor:this.maxSpeed);this.velocity.lerp(a,.2)}else this.velocity.multiplyScalar(this.damping),this.velocity.length()<.01&&this.velocity.set(0,0,0);this.position.add(this.velocity),this.model.position.copy(this.position),this.model.quaternion.copy(this.currentRotation),this.updateRotation(),this.updateCamera()}},{key:"updateRotation",value:function(){var e=(new i.PTz).setFromAxisAngle(new i.Pq0(0,1,0),this.yaw),t=(new i.PTz).setFromAxisAngle(new i.Pq0(1,0,0),this.pitch);this.targetRotation.copy(e).multiply(t),this.currentRotation.slerp(this.targetRotation,.15)}},{key:"handleBoundaryCollision",value:function(e){this.velocity.copy(e)}},{key:"handleMouseMove",value:function(e,t){var n=.002*this.mouseSensitivity;this.yaw-=e*n,this.pitch-=t*n,this.yaw=this.yaw%(2*Math.PI),this.yaw<0&&(this.yaw+=2*Math.PI);var i=.47*Math.PI;this.pitch=Math.max(-i,Math.min(i,this.pitch))}},{key:"handleMobileMove",value:function(e,t){this.moveLeft=e<-.2,this.moveRight=e>.2,this.moveUp=t<-.2,this.moveDown=t>.2;var n=Math.min(1,Math.sqrt(e*e+t*t));if(n>.1){var r=new i.Pq0(e,0,t).normalize();r.multiplyScalar(n*this.moveSpeed),this.velocity.lerp(r,.2)}}},{key:"handleMobileRotation",value:function(e,t){var n=.03*this.mouseSensitivity;if(Math.abs(e)>.1&&(this.yaw-=e*n),Math.abs(t)>.1){this.pitch-=t*n;var i=.47*Math.PI;this.pitch=Math.max(-i,Math.min(i,this.pitch))}}},{key:"updateCamera",value:function(){var e=this.currentProfile.cameraDistance,t=this.currentProfile.cameraHeight,n=this.position.clone(),r=new i.Pq0(0,0,1).applyQuaternion(this.currentRotation);n.add(r.multiplyScalar(e)),n.y+=t,this.game.camera.position.lerp(n,.1),this.game.camera.lookAt(this.position)}},{key:"boost",value:function(){var e=performance.now();!this.boostActive&&e-this.lastBoostTime>this.boostCooldown&&(this.boostActive=!0,this.boostTime=e,this.lastBoostTime=e,this.createBoostEffect())}},{key:"createBoostEffect",value:function(){if(this.game.particlePool){var e=new i.Pq0(0,0,1).applyQuaternion(this.currentRotation),t=this.position.clone().add(e.clone().multiplyScalar(.6));this.game.particlePool.createEffect({type:"spark",position:t,count:20,spread:.3,velocity:.2,acceleration:new i.Pq0(0,0,0),maxLifetime:30,parent:this.model,onUpdate:function(t){t.position.add(e.clone().multiplyScalar(.1)),t.material.opacity-=.05}})}}},{key:"reset",value:function(){this.position.set(0,0,50),this.velocity.set(0,0,0),this.direction.set(0,0,-1),this.moveUp=!1,this.moveDown=!1,this.moveLeft=!1,this.moveRight=!1,this.boostActive=!1,this.lastBoostTime=0,this.yaw=0,this.pitch=0,this.currentRotation=new i.PTz,this.targetRotation=new i.PTz,this.model.position.copy(this.position),this.model.quaternion.copy(this.currentRotation),this.model.rotation.set(0,0,0),this.updateCamera()}}])&&B(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function G(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return q(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function _(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,R(i.key),i)}}function R(e){var t=function(e){if("object"!=F(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==F(t)?t:t+""}var U=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.parent=n,this.config={playerCooldown:150,maxPlayerBullets:30,maxEnemyBullets:20,bulletSpeed:3,bulletLifetime:200,bulletPoolSize:100,impactParticleCount:6},this.activeBullets=[],this.lastPlayerShotTime=0,this.initBulletPool()},t=[{key:"initBulletPool",value:function(){this.bulletPool=[],this.bulletGeometries={player:new i.Gu$(.2,6,6),enemy:new i.Gu$(.2,6,6)},this.bulletMaterials={player:new i.V9B({color:65535,transparent:!0,opacity:.8}),enemy:new i.V9B({color:16711680,transparent:!0,opacity:.8})};for(var e=0;e<this.config.bulletPoolSize;e++){var t=new i.eaF(this.bulletGeometries.player,this.bulletMaterials.player);t.visible=!1,t.userData={active:!1,isPlayerBullet:!0,direction:new i.Pq0,lifetime:0},this.parent.add(t),this.bulletPool.push(t);var n=new i.eaF(this.bulletGeometries.enemy,this.bulletMaterials.enemy);n.visible=!1,n.userData={active:!1,isPlayerBullet:!1,direction:new i.Pq0,lifetime:0},this.parent.add(n),this.bulletPool.push(n)}this.bulletLights={player:[],enemy:[]};for(var r=0;r<3;r++){var a=new i.HiM(65535,.8,5);a.visible=!1,this.parent.add(a),this.bulletLights.player.push(a)}for(var o=0;o<3;o++){var s=new i.HiM(16711680,.8,5);s.visible=!1,this.parent.add(s),this.bulletLights.enemy.push(s)}this.impactPool={geometries:[new i.Gu$(.05,4,4),new i.Gu$(.04,4,4),new i.Gu$(.03,4,4)],materials:{player:new i.V9B({color:65535,transparent:!0,opacity:.8}),enemy:new i.V9B({color:16711680,transparent:!0,opacity:.8})}}}},{key:"getBulletFromPool",value:function(e){var t,n=0,i=0,r=G(this.activeBullets);try{for(r.s();!(t=r.n()).done;)t.value.userData.isPlayerBullet?n++:i++}catch(e){r.e(e)}finally{r.f()}if(e&&n>=this.config.maxPlayerBullets){var a,o=G(this.activeBullets);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.userData.isPlayerBullet)return s}}catch(e){o.e(e)}finally{o.f()}}else if(!e&&i>=this.config.maxEnemyBullets){var l,c=G(this.activeBullets);try{for(c.s();!(l=c.n()).done;){var h=l.value;if(!h.userData.isPlayerBullet)return h}}catch(e){c.e(e)}finally{c.f()}}var u,p=G(this.bulletPool);try{for(p.s();!(u=p.n()).done;){var d=u.value;if(!d.userData.active&&d.userData.isPlayerBullet===e)return d}}catch(e){p.e(e)}finally{p.f()}var m,y=G(this.bulletPool);try{for(y.s();!(m=y.n()).done;){var f=m.value;if(!f.userData.active)return f.material=e?this.bulletMaterials.player:this.bulletMaterials.enemy,f.userData.isPlayerBullet=e,f}}catch(e){y.e(e)}finally{y.f()}if(this.activeBullets.length>0){var v=this.activeBullets[0];return v.userData.isPlayerBullet!==e&&(v.material=e?this.bulletMaterials.player:this.bulletMaterials.enemy,v.userData.isPlayerBullet=e),v}return console.warn("Could not find bullet in pool"),null}},{key:"prewarmSystem",value:function(){for(var e=new i.Pq0(0,0,0),t=new i.Pq0(0,1,0),n=0;n<20;n++){var r=this.createBullet(e,t,!0);r&&this.recycleBullet(r)}for(var a=0;a<20;a++){var o=this.createBullet(e,t,!1);o&&this.recycleBullet(o)}}},{key:"createBullet",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){var i=performance.now();if(i-this.lastPlayerShotTime<this.config.playerCooldown)return null;this.lastPlayerShotTime=i}var r=this.getBulletFromPool(n);return r?(r.position.copy(e),r.userData.direction.copy(t),r.userData.lifetime=0,r.userData.active=!0,r.visible=!0,this.activeBullets.includes(r)||this.activeBullets.push(r),r):null}},{key:"recycleBullet",value:function(e){if(e){var t=this.activeBullets.indexOf(e);-1!==t&&this.activeBullets.splice(t,1),e.visible=!1,e.userData.active=!1,e.userData.lifetime=0}}},{key:"update",value:function(e,t){if(0!==this.activeBullets.length)for(var n=this.activeBullets.length-1;n>=0;n--){var i=this.activeBullets[n];if(i.position.addScaledVector(i.userData.direction,this.config.bulletSpeed),i.userData.lifetime++,i.userData.lifetime>this.config.bulletLifetime)this.recycleBullet(i);else{if(!i.userData.isPlayerBullet&&this.game.player&&i.position.distanceTo(this.game.player.position)<1){this.game.handlePlayerHit?this.game.handlePlayerHit():void 0!==this.game.playerHealth&&(this.game.playerHealth-=10,console.log("Player health reduced to:",this.game.playerHealth),this.game.playerHealth<=0&&this.game.endGame(!1)),this.recycleBullet(i);continue}(i.userData.isPlayerBullet&&t&&t.checkBulletEnemyCollisions(i)||e&&e(i.position,.2))&&this.recycleBullet(i)}}}},{key:"reset",value:function(){for(;this.activeBullets.length>0;)this.recycleBullet(this.activeBullets[0]);return this.bulletLights.player.forEach((function(e){return e.visible=!1})),this.bulletLights.enemy.forEach((function(e){return e.visible=!1})),this.lastPlayerShotTime=0,!0}}],t&&_(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,W(i.key),i)}}function W(e){var t=function(e){if("object"!=N(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==N(t)?t:t+""}var Y=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"basic";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.currentState="patrol",this.targetPosition=new i.Pq0,this.movementVector=new i.Pq0,this.lastStateChange=performance.now(),this.lastDecision=performance.now(),this.decisionInterval=500+500*Math.random(),this.config={preferredDistance:50,decisionVariability:.3*Math.random(),maxSpeed:.1+.3*Math.random(),acceleration:.02,turnRate:.08,maxPitchAngle:Math.PI/3,flankingFactor:.6+.4*Math.random(),aggressiveness:.5+.5*Math.random(),evasiveness:.7*Math.random(),usesFormations:Math.random()>.3,usesAmbush:Math.random()>.7},"boss"===t&&this.configBossEnemy(),this.formationOffset=new i.Pq0(40*(Math.random()-.5),20*(Math.random()-.5),40*(Math.random()-.5))},t=[{key:"configBossEnemy",value:function(){this.config.maxSpeed*=1.2,this.config.preferredDistance*=.6,this.config.aggressiveness=.9,this.config.evasiveness=.8,this.config.usesFormations=!1,this.decisionInterval=300}},{key:"update",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!t)return new i.Pq0;var o=performance.now();return o-this.lastDecision>this.decisionInterval&&(this.updateState(t,n,a),this.lastDecision=o),this.calculateMovement(e,t,n,r)}},{key:"updateState",value:function(e,t,n){var i=this.getDistanceToPlayer(e),r=performance.now()-this.lastStateChange;switch(this.currentState){case"patrol":i<1e3?this.changeState("attack"):r>5e3&&(this.setRandomPatrolPoint(e.position),this.lastStateChange=performance.now());break;case"attack":this.config.flankingFactor>.7&&Math.random()>.7?this.changeState("flank"):n&&Math.random()<this.config.evasiveness?this.changeState("evade"):i>1e3&&this.changeState("patrol");break;case"flank":r>3e3&&this.changeState("attack");break;case"evade":r>2e3&&this.changeState("attack");break;case"formation":i<60*this.config.aggressiveness?this.changeState("attack"):r>4e3&&(this.lastStateChange=performance.now())}this.config.usesFormations&&t.length>2&&"evade"!==this.currentState&&Math.random()>.6&&"formation"!==this.currentState&&this.changeState("formation")}},{key:"changeState",value:function(e){this.currentState=e,this.lastStateChange=performance.now()}},{key:"calculateMovement",value:function(e,t,n,r){var a=new i.Pq0;switch(this.currentState){case"patrol":a.copy(this.calculatePatrolMovement());break;case"attack":a.copy(this.calculateAttackMovement(t));break;case"flank":a.copy(this.calculateFlankMovement(t));break;case"evade":a.copy(this.calculateEvadeMovement(t));break;case"formation":a.copy(this.calculateFormationMovement(t,n))}var o=this.config.maxSpeed*("evade"===this.currentState?1.2:1);return a.normalize().multiplyScalar(o),this.movementVector.copy(a),a}},{key:"calculatePatrolMovement",value:function(){var e=performance.now(),t=new i.Pq0;if(this.targetPosition.lengthSq()>0){t.subVectors(this.targetPosition,this.currentPosition||new i.Pq0).normalize();var n=.2*Math.sin(.001*e);t.x+=n,t.y+=.1*Math.sin(.0015*e)}else this.setRandomPatrolPoint(),t.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize();return t}},{key:"calculateAttackMovement",value:function(e){var t=new i.Pq0,n=this.calculateLeadPosition(e);return t.subVectors(n,this.currentPosition||new i.Pq0),t.length()<this.config.preferredDistance*this.config.aggressiveness?t.negate().multiplyScalar(.5):t.normalize(),t}},{key:"calculateFlankMovement",value:function(e){var t=new i.Pq0;t.subVectors(e.position,this.currentPosition||new i.Pq0);var n=new i.Pq0(-t.z,0,t.x).normalize(),r=1.5*this.config.flankingFactor;return t.normalize(),t.add(n.multiplyScalar(r)),t}},{key:"calculateEvadeMovement",value:function(e){var t=new i.Pq0;return t.subVectors(this.currentPosition||new i.Pq0,e.position),t.x+=2*(Math.random()-.5),t.y+=2*(Math.random()-.5),t.z+=2*(Math.random()-.5),t.normalize()}},{key:"calculateFormationMovement",value:function(e,t){var n=new i.Pq0;n.subVectors(e.position,this.currentPosition||new i.Pq0);var r=n.length();r<120?n.negate().multiplyScalar(.5):r>170?n.normalize():n.set(0,0,0);var a=new i.Pq0(0,0,-1).applyQuaternion(e.quaternion||new i.PTz).normalize(),o=new i.Pq0(1,0,0).applyQuaternion(e.quaternion||new i.PTz),s=new i.Pq0(0,1,0);return n.add(o.clone().multiplyScalar(this.formationOffset.x).add(s.clone().multiplyScalar(this.formationOffset.y).add(a.clone().multiplyScalar(this.formationOffset.z)))),n.normalize()}},{key:"setCurrentPosition",value:function(e){this.currentPosition=e.clone()}},{key:"getMovementVector",value:function(){return this.movementVector}},{key:"calculateLeadPosition",value:function(e){var t=e.position.clone();if(e.velocity){var n=this.getDistanceToPlayer(e),i=Math.min(n/100,1.5);t.add(e.velocity.clone().multiplyScalar(i))}return t}},{key:"getDistanceToPlayer",value:function(e){if(!this.currentPosition)return 1e3;var t=e.position.x-this.currentPosition.x,n=e.position.y-this.currentPosition.y,i=e.position.z-this.currentPosition.z;return Math.sqrt(t*t+n*n+i*i)}},{key:"setRandomPatrolPoint",value:function(e){var t=e||new i.Pq0,n=100+200*Math.random(),r=Math.random()*Math.PI*2,a=100*Math.random()-50;this.targetPosition.set(t.x+Math.cos(r)*n,t.y+a,t.z+Math.sin(r)*n)}},{key:"getRotationQuaternion",value:function(e){if(!e||0===e.lengthSq())return new i.PTz;var t=new i.kn4;t.lookAt(new i.Pq0(0,0,0),e,new i.Pq0(0,1,0));var n=new i.PTz;return n.setFromRotationMatrix(t),n}}],t&&V(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=new Y(e);return"hard"===t?(n.config.maxSpeed*=1.3,n.config.flankingFactor*=1.5,n.config.aggressiveness*=1.3,n.decisionInterval*=.7):"easy"===t&&(n.config.maxSpeed*=.8,n.config.flankingFactor*=.7,n.config.aggressiveness*=.7,n.decisionInterval*=1.5),n}function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,J(i.key),i)}}function J(e){var t=function(e){if("object"!=$(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==$(t)?t:t+""}var Z=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.parent=n,this.enemies=[],this.enemiesDefeated=0,this.totalEnemies=100,this.lastSpawnTime=0,this.spawnInterval=4e3,this.maxEnemies=10,this.bossSpawned=!1,this.bossDefeated=!1,this.bossEnemy=null,this.waveNumber=1,this.enemiesPerWave=5,this.enemiesRemainingInWave=this.enemiesPerWave,this.timeBetweenWaves=5e3,this.lastWaveTime=0,this.isWaveActive=!1,this.canSpawnGroups=!1,this.groupSize=3,this.groupSpawnChance=.3,this.createGlobalEnemyLights(),this.initSpatialGrid(),this.initInstancedEnemies(),this.initHealthBars()},t=[{key:"initHealthBars",value:function(){this.healthBarGeometry=new i.bdM(4,.5),this.healthBarBgMaterial=new i.V9B({color:3355443,transparent:!0,opacity:.7,depthTest:!1}),this.healthBarFillMaterial=new i.V9B({color:16724787,transparent:!0,opacity:.8,depthTest:!1}),this.healthBars={},this.healthBarConfig={showDuration:3e3,fadeTime:1e3,yOffset:5,maxAlpha:.8}}},{key:"updateEnemyHealthBar",value:function(e){var t=e.instanceId,n=e.userData.health/100;if(!this.healthBars[t]){var r=new i.YJl,a=new i.eaF(this.healthBarGeometry,this.healthBarBgMaterial.clone()),o=new i.eaF(this.healthBarGeometry,this.healthBarFillMaterial.clone());o.position.z=.01,r.add(a),r.add(o),this.parent.add(r),this.healthBars[t]={group:r,background:a,fill:o,lastHitTime:performance.now(),visible:!0}}var s=this.healthBars[t];s.lastHitTime=performance.now(),s.visible=!0,s.background.material.opacity=this.healthBarConfig.maxAlpha,s.fill.material.opacity=this.healthBarConfig.maxAlpha,s.fill.scale.x=Math.max(.01,n),s.fill.position.x=2*(n-1),n>.6?s.fill.material.color.setRGB(.2,.8,.2):n>.3?s.fill.material.color.setRGB(.9,.9,.2):s.fill.material.color.setRGB(.9,.2,.2)}},{key:"updateHealthBars",value:function(){var e=this,t=performance.now(),n=this.game.camera;if(n){var i=function(i){var r=e.healthBars[i],a=e.enemies.find((function(e){return e.instanceId===parseInt(i)}));if(!a)return r.group.parent&&r.group.parent.remove(r.group),delete e.healthBars[i],1;var o=t-r.lastHitTime;if(o>e.healthBarConfig.showDuration){var s=Math.min(1,(o-e.healthBarConfig.showDuration)/e.healthBarConfig.fadeTime),l=e.healthBarConfig.maxAlpha*(1-s);r.background.material.opacity=l,r.fill.material.opacity=l,s>=1&&(r.visible=!1)}r.visible&&(r.group.position.copy(a.position),r.group.position.y+=e.healthBarConfig.yOffset,r.group.lookAt(n.position))};for(var r in this.healthBars)i(r)}}},{key:"createGlobalEnemyLights",value:function(){var e=[[150,50,150],[-150,50,150],[150,50,-150],[-150,50,-150]];this.enemyLights=[];for(var t=0;t<e.length;t++){var n=new i.HiM(16733440,.8,200);n.position.set(e[t][0],e[t][1],e[t][2]),this.parent.add(n),this.enemyLights.push(n)}}},{key:"initSpatialGrid",value:function(){this.gridCellSize=5e3,this.gridSize=20,this.grid=[];for(var e=0;e<this.gridSize;e++){this.grid[e]=[];for(var t=0;t<this.gridSize;t++)this.grid[e][t]=[]}}},{key:"updateSpatialGrid",value:function(){for(var e=0;e<this.gridSize;e++)for(var t=0;t<this.gridSize;t++)this.grid[e][t]=[];for(var n=0;n<this.enemies.length;n++){var i=this.enemies[n],r=Math.floor((i.position.x+500)/this.gridCellSize),a=Math.floor((i.position.z+500)/this.gridCellSize);r>=0&&r<this.gridSize&&a>=0&&a<this.gridSize&&this.grid[r][a].push(i)}}},{key:"spawnInitialEnemies",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;this.createEnemy();for(var n=1;n<t;n++)setTimeout((function(){e.createEnemy()}),500*n)}},{key:"initInstancedEnemies",value:function(){var e,t;if(this.instanceCount=this.maxEnemies,this.game.assetManager){var n=this.game.assetManager.getModel("ant",!1);n?n.traverse((function(n){n.isMesh&&!e&&(e=n.geometry,t=n.material.clone())})):console.log("[EnemyManager] 'ant' model NOT found in AssetManager.")}else console.log("[EnemyManager] AssetManager not available.");e||(console.log("[EnemyManager] Using fallback SphereGeometry."),e=new i.Gu$(1,8,8),t=new i.tXL({color:16720384,emissive:4460800,shininess:50})),this.enemyInstances=new i.ZLX(e,t,this.instanceCount),this.enemyInstances.instanceMatrix.setUsage(i.Vnu),this.enemyInstances.frustumCulled=!1,this.parent.add(this.enemyInstances)}},{key:"createEnemy",value:function(){var e=this.enemies.length;if(e>=this.instanceCount)return null;var t=Math.random()*Math.PI*2,n=70+220*Math.random(),r=new i.Pq0(Math.cos(t)*n,50,Math.sin(t)*n),a={position:r,quaternion:new i.PTz,instanceId:e,userData:{health:100,speed:this.enemyBaseSpeed||.9,velocity:new i.Pq0,targetDirection:new i.Pq0,rotationSpeed:.1,maxSpeed:.9,acceleration:.01,currentSpeed:0,state:"patrolling",target:new i.Pq0,lastStateChange:performance.now(),lastAttackTime:0,attackCooldown:2e3+1e3*Math.random(),patrolRadius:80+70*Math.random(),originalPosition:r.clone()},aiController:X(Math.random()>.8?"aggressive":"basic")},o=new i.kn4;return o.setPosition(r),this.enemyInstances.setMatrixAt(e,o),this.enemyInstances.instanceMatrix.needsUpdate=!0,this.setNewPatrolTarget(a),this.enemies.push(a),a}},{key:"increaseWaveDifficulty",value:function(){this.waveNumber++,this.enemiesPerWave=Math.min(5+Math.floor(1.5*this.waveNumber),20),this.waveNumber>=3&&(this.canSpawnGroups=!0,this.groupSpawnChance=Math.min(.3+.05*(this.waveNumber-3),.6),this.groupSize=Math.min(3+Math.floor((this.waveNumber-3)/2),6)),this.spawnInterval=Math.max(4e3-200*this.waveNumber,1500),this.maxEnemies=Math.min(5+Math.floor(this.waveNumber/2),15),this.enemyBaseHealth=100+10*this.waveNumber,this.enemyBaseSpeed=.8,this.enemiesRemainingInWave=this.enemiesPerWave,this.isWaveActive=!1,this.game.ui&&"function"==typeof this.game.ui.showWaveNotification?this.game.ui.showWaveNotification(this.waveNumber):this.showWaveText("WAVE ".concat(this.waveNumber))}},{key:"showWaveText",value:function(e){if(document&&document.body){var t=document.createElement("div");t.textContent=e,t.style.position="absolute",t.style.color="#ffcc00",t.style.fontSize="48px",t.style.fontWeight="bold",t.style.top="40%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.textShadow="0 0 10px black",t.style.pointerEvents="none",t.style.zIndex="1000",t.style.transition="all 1.5s ease-out",document.body.appendChild(t),setTimeout((function(){t.style.opacity="0",t.style.transform="translate(-50%, -150%)",setTimeout((function(){t.parentNode&&document.body.removeChild(t)}),1500)}),2e3)}}},{key:"spawnEnemyGroup",value:function(e){for(var t=this.getSpawnPosition(),n=0;n<e;n++){var r=n/e*Math.PI*2,a=new i.Pq0(20*Math.cos(r),n%2*10,20*Math.sin(r)),o=this.createEnemyAt(t.clone().add(a));o&&o.userData&&(o.userData.speed*=1.1)}}},{key:"createEnemyAt",value:function(e){var t=this.enemies.length;if(t>=this.instanceCount)return null;var n={position:e,quaternion:new i.PTz,instanceId:t,userData:{health:this.enemyBaseHealth||100,speed:this.enemyBaseSpeed||.05+.05*Math.random(),state:"patrolling",target:new i.Pq0,lastStateChange:performance.now(),lastAttackTime:0,attackCooldown:2e3+1e3*Math.random(),patrolRadius:80+70*Math.random(),originalPosition:e.clone()}},r=new i.kn4;return r.setPosition(e),this.enemyInstances.setMatrixAt(t,r),this.enemyInstances.instanceMatrix.needsUpdate=!0,this.setNewPatrolTarget(n),this.enemies.push(n),n}},{key:"getSpawnPosition",value:function(){var e=new i.Pq0,t=(this.game.player?this.game.player.position:new i.Pq0,Math.random()*Math.PI*2),n=100+200*Math.random();return e.set(Math.cos(t)*n,50+50*Math.random(),Math.sin(t)*n),e}},{key:"setNewPatrolTarget",value:function(e){var t=Math.random()*Math.PI*2,n=Math.random()*e.userData.patrolRadius,i=e.userData.originalPosition;return e.userData.target.set(i.x+Math.cos(t)*n,i.y+(50*Math.random()-25),i.z+Math.sin(t)*n),e.userData.target}},{key:"createFallbackEnemyModel",value:function(e){}},{key:"spawnBoss",value:function(){if(!this.bossSpawned){console.log("Boss fight starting!"),this.bossSpawned=!0,this.bossBar=document.createElement("div"),this.bossBar.style.cssText="position:fixed;top:20px;left:20%;right:20%;height:20px;background:#333;border-radius:5px;z-index:100;",this.bossBarFill=document.createElement("div"),this.bossBarFill.style.cssText="width:100%;height:100%;background:red;border-radius:5px;transition:width 0.3s;",this.bossBar.appendChild(this.bossBarFill),document.body.appendChild(this.bossBar);var e,t,n,r=new i.Pq0(0,50,0);if(this.bossEnemy=(e={position:r,quaternion:new i.PTz,model:null,aiController:X("boss"),userData:{health:500,speed:.15,velocity:new i.Pq0,state:"attacking",lastAttackTime:0,rotationSpeed:.05}},t="aiController",n=X("boss","hard"),(t=J(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e),this.game.assetManager){var a=this.game.assetManager.getModel("ant")||this.game.assetManager.getModel("bee");a&&(a.scale.set(50,50,50),this.bossEnemy.model=a,this.parent.add(a),a.position.copy(r))}}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16.667;if(this.bossEnemy&&this.bossEnemy.model&&(this.bossEnemy.model.position.copy(this.bossEnemy.position),this.bossEnemy.model.quaternion.copy(this.bossEnemy.quaternion),this.bossEnemy.rotationFixed||(this.bossEnemy.model.rotation.y=Math.PI,this.bossEnemy.rotationFixed=!0)),this.bossEnemy&&this.bossEnemy.aiController&&this.game.player){this.bossEnemy.aiController.setCurrentPosition(this.bossEnemy.position);var t=this.bossEnemy.aiController.update(e,this.game.player,this.enemies,[],!1);if(t){var n=this.bossEnemy.userData.speed;this.bossEnemy.position.add(t.clone().multiplyScalar(n))}}if(this.bossEnemy&&this.game.player){var r=performance.now(),a=this.bossEnemy.userData;if(r-a.lastAttackTime>(a.attackCooldown||1500)){var o=this.bossEnemy.position.distanceTo(this.game.player.position);if(o<250){var s=.8-o/500;s*=1.8,Math.random()<s&&(this.enemyShoot(this.bossEnemy),a.lastAttackTime=r)}}}if(this.enemies&&0!==this.enemies.length){this.updateSpatialGrid();var l=performance.now();if(!this.isWaveActive&&this.enemiesRemainingInWave>0&&l-this.lastWaveTime>this.timeBetweenWaves&&(this.isWaveActive=!0),this.isWaveActive&&this.enemies.length<this.maxEnemies&&this.enemiesRemainingInWave>0){var c=1;this.canSpawnGroups&&Math.random()<this.groupSpawnChance&&(c=Math.min(this.groupSize,this.enemiesRemainingInWave)),l-this.lastSpawnTime>this.spawnInterval&&(c>1?this.spawnEnemyGroup(c):this.createEnemy(),this.enemiesRemainingInWave-=c,this.lastSpawnTime=l,this.enemiesRemainingInWave<=0&&(this.isWaveActive=!1,this.lastWaveTime=l))}this.enemiesRemainingInWave<=0&&0===this.enemies.length&&!this.isWaveActive&&l-this.lastWaveTime>this.timeBetweenWaves&&this.increaseWaveDifficulty(),this.enemyInstances&&(this.enemyInstances.instanceMatrix.needsUpdate=!1);for(var h=this.enemies.length-1;h>=0;h--){var u=this.enemies[h],p=u.userData;if(p.velocity||(p.velocity=new i.Pq0,p.rotationSpeed=.1),this.game.player&&l-p.lastAttackTime>p.attackCooldown){var d=u.position.distanceTo(this.game.player.position);if(d<150){var m=.6-d/300;u.aiController&&u.aiController.config&&u.aiController.config.aggressiveness>.7&&(m*=1.5),Math.random()<m&&(this.enemyShoot(u),p.lastAttackTime=l)}}u.aiController.setCurrentPosition(u.position);var y=u.aiController.update(e,this.game.player,this.enemies,[],!1).clone().multiplyScalar(p.speed);if(p.velocity.lerp(y,.3),"stunned"===p.state&&p.velocity.multiplyScalar(.7),u.position.add(p.velocity),p.velocity.lengthSq()>.01){var f=p.velocity.clone().normalize(),v=new i.PTz,g=new i.kn4;g.lookAt(new i.Pq0(0,0,0),f,new i.Pq0(0,1,0)),v.setFromRotationMatrix(g),u.quaternion.slerp(v,p.rotationSpeed),this.updateHealthBars()}if(this.enemyInstances){var b=new i.kn4,w=new i.Pq0(7,7,7),x=new i.PTz;x.copy(u.quaternion);var k=(new i.PTz).setFromAxisAngle(new i.Pq0(1,0,0),Math.PI/2);x.multiply(k),b.compose(u.position,x,w),this.enemyInstances.setMatrixAt(u.instanceId,b)}}this.enemyInstances&&(this.enemyInstances.instanceMatrix.needsUpdate=!0),this.enemies.length<this.maxEnemies&&l-this.lastSpawnTime>this.spawnInterval&&this.enemiesDefeated<this.totalEnemies&&(this.createEnemy(),this.lastSpawnTime=l)}}},{key:"moveTowardTarget",value:function(e,t,n){if(e&&t){var r=(new i.Pq0).subVectors(t,e.position).normalize();e.position.add(r.multiplyScalar(n)),e.position.y+=.02*Math.sin(.002*performance.now())}}},{key:"lookAtTarget",value:function(e,t){if(e&&t){(new i.Pq0).subVectors(t,e.position);var n=new i.kn4;n.lookAt(e.position,t,new i.Pq0(0,1,0)),e.quaternion.setFromRotationMatrix(n);var r=(new i.PTz).setFromAxisAngle(new i.Pq0(0,1,0),Math.PI);e.quaternion.multiply(r)}}},{key:"enemyShoot",value:function(e){if(this.game.combatArena&&this.game.player){var t=e.position.clone(),n=this.game.player.position.clone(),r=t.distanceTo(n)/30*.1;n.x+=(2*Math.random()-1)*r,n.y+=(2*Math.random()-1)*r,n.z+=(2*Math.random()-1)*r;var a=(new i.Pq0).subVectors(n,t).normalize();this.game.combatArena.bulletManager&&(this.game.combatArena.bulletManager.createBullet(t,a,!1),this.game.soundManager.playSound("shoot"))}}},{key:"handleEnemyHit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;if(e)if(this.bossEnemy&&e===this.bossEnemy){if(e.userData.health-=t,this.bossBarFill){var n=Math.max(0,e.userData.health/500*100);this.bossBarFill.style.width=n+"%"}e.userData.health<=0&&(this.bossDefeated=!0,e.model&&this.parent.remove(e.model),"function"==typeof this.onEnemyDefeated&&this.onEnemyDefeated(1e3),this.game.endGame&&this.game.endGame(!0))}else e.userData.health-=t,this.updateEnemyHealthBar(e),e.userData.health<=0?("function"==typeof this.onEnemyDefeated&&this.onEnemyDefeated(100),this.destroyEnemy(e)):(e.userData.state="stunned",e.userData.lastStateChange=performance.now())}},{key:"showEnemyHitEffect",value:function(e){this.game&&this.game.particlePool&&this.game.particlePool.createEffect({type:"spark",position:e.clone(),count:8,spread:.5,velocity:.15,maxLifetime:20})}},{key:"destroyEnemy",value:function(e){var t=this.enemies.indexOf(e);if(-1!==t){if(this.game&&this.game.particlePool&&(this.game.particlePool.createExplosion(e.position.clone(),{count:20,spread:1.2,velocity:.25,lifetime:60}),this.game.particlePool.createEffect({type:"honey",position:e.position.clone(),count:12,spread:1,velocity:.2,maxLifetime:50})),this.enemies.splice(t,1),this.enemyInstances){var n=new i.kn4;n.compose(new i.Pq0(1e4,1e4,1e4),new i.PTz,new i.Pq0(1,1,1)),this.enemyInstances.setMatrixAt(e.instanceId,n),this.enemyInstances.instanceMatrix.needsUpdate=!0}this.enemiesDefeated++,this.checkVictoryCondition()&&this.game.endGame(!0)}}},{key:"checkBulletEnemyCollisions",value:function(e){if(!e||!e.userData||!e.userData.isPlayerBullet)return!1;if(this.bossEnemy&&this.bossEnemy.model&&e.position.distanceTo(this.bossEnemy.position)<35)return this.handleEnemyHit(this.bossEnemy),!0;for(var t=Math.floor((e.position.x+500)/this.gridCellSize),n=Math.floor((e.position.z+500)/this.gridCellSize),i=Math.max(0,t-1);i<=Math.min(this.gridSize-1,t+1);i++)for(var r=Math.max(0,n-1);r<=Math.min(this.gridSize-1,n+1);r++)if(this.grid[i]&&this.grid[i][r])for(var a=this.grid[i][r],o=0;o<a.length;o++){var s=a[o];if(e.position.distanceTo(s.position)<5.5)return this.handleEnemyHit(s),!0}return!1}},{key:"checkVictoryCondition",value:function(){return!!this.bossDefeated||!this.bossSpawned&&this.enemiesDefeated>=this.totalEnemies&&(this.spawnBoss(),!1)}},{key:"reset",value:function(){if(this.enemies=[],this.enemiesDefeated=0,this.lastSpawnTime=0,this.enemyInstances){var e=new i.kn4;e.setPosition(1e4,1e4,1e4);for(var t=0;t<this.instanceCount;t++)this.enemyInstances.setMatrixAt(t,e);this.enemyInstances.instanceMatrix.needsUpdate=!0}return!0}}],t&&Q(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ne(i.key),i)}}function ne(e){var t=function(e){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(t)?t:t+""}var ie=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.arenaGroup=n,this.powerUps=[],this.types=["health","speed","weapon"],this.spawnInterval=15e3,this.lastSpawnTime=0,this.maxPowerUps=5,this.initGeometryAndMaterials()},t=[{key:"initGeometryAndMaterials",value:function(){this.geometry=new i.Ufg(3,0),this.materials={health:new i.tXL({color:16711680,emissive:3342336,shininess:50,transparent:!0,opacity:.8}),speed:new i.tXL({color:65535,emissive:13107,shininess:50,transparent:!0,opacity:.8}),weapon:new i.tXL({color:16755200,emissive:3351040,shininess:50,transparent:!0,opacity:.8})}}},{key:"spawnPowerUp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.powerUps.length>=this.maxPowerUps&&this.removePowerUp(this.powerUps[0]);var t=e||this.types[Math.floor(Math.random()*this.types.length)],n=new i.eaF(this.geometry,this.materials[t]),r=this.getSpawnPosition();n.position.copy(r),this.arenaGroup.add(n);var a=new i.HiM(this.materials[t].color,1,30);a.position.copy(r),n.add(a);var o={mesh:n,type:t,effect:this.getEffectForType(t),createdAt:performance.now()};return this.powerUps.push(o),this.lastSpawnTime=performance.now(),o}},{key:"getSpawnPosition",value:function(){var e=new i.Pq0,t=this.game.player?this.game.player.position:new i.Pq0,n=0;do{var r=Math.random()*Math.PI*2,a=50+150*Math.random(),o=50+100*Math.random();e.set(Math.cos(r)*a,o,Math.sin(r)*a),n++}while(e.distanceTo(t)<50&&n<10);return e}},{key:"getEffectForType",value:function(e){var t=this;switch(e){case"health":return function(e){void 0!==t.game.playerHealth&&(t.game.playerHealth=Math.min(100,t.game.playerHealth+25),t.showEffectText("+".concat(25," Health"),16711680))};case"speed":return function(e){var n=e.maxSpeed;e.maxSpeed*=1.5,t.showEffectText("Speed Boost!",65535),setTimeout((function(){e.maxSpeed=n}),2e4)};case"weapon":return function(e){if(t.game.combatArena&&t.game.combatArena.bulletManager){var n=t.game.combatArena.bulletManager,i=n.config.playerCooldown;n.config.playerCooldown=i/2,t.showEffectText("Weapon Upgrade!",16755200),setTimeout((function(){n.config.playerCooldown=i}),15e3)}};default:return function(){}}}},{key:"showEffectText",value:function(e,t){if(document&&document.body){var n=document.createElement("div");n.textContent=e,n.style.position="absolute",n.style.color="#"+new i.Q1f(t).getHexString(),n.style.fontSize="24px",n.style.fontWeight="bold",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.textShadow="0 0 5px black",n.style.pointerEvents="none",n.style.zIndex="1000",n.style.transition="all 1s ease-out",document.body.appendChild(n),setTimeout((function(){n.style.opacity="0",n.style.transform="translate(-50%, -150%)",setTimeout((function(){n.parentNode&&document.body.removeChild(n)}),1e3)}),50)}}},{key:"checkCollisions",value:function(e,t){if(e&&0!==this.powerUps.length)for(var n=this.powerUps.length-1;n>=0;n--){var i=this.powerUps[n];i.mesh&&e.distanceTo(i.mesh.position)<t+5&&(this.game.soundManager&&this.game.soundManager.playSound("pickup"),i.effect&&this.game.player&&i.effect(this.game.player),this.removePowerUp(i))}}},{key:"removePowerUp",value:function(e){var t=this.powerUps.indexOf(e);-1!==t&&(this.powerUps.splice(t,1),e.mesh&&e.mesh.parent&&e.mesh.parent.remove(e.mesh))}},{key:"update",value:function(){var e=performance.now();e-this.lastSpawnTime>this.spawnInterval&&this.powerUps.length<this.maxPowerUps&&this.spawnPowerUp();var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ee(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(this.powerUps);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.mesh&&(i.mesh.rotation.y+=.02,i.mesh.rotation.x+=.01,i.mesh.position.y+=.05*Math.sin(.001*e))}}catch(e){n.e(e)}finally{n.f()}this.game.player&&this.game.player.position&&this.checkCollisions(this.game.player.position,this.game.player.radius||2)}},{key:"reset",value:function(){for(;this.powerUps.length>0;)this.removePowerUp(this.powerUps[0]);return this.lastSpawnTime=0,!0}}],t&&te(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function re(e){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},re(e)}function ae(){ae=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,i){var a=t&&t.prototype instanceof v?t:v,o=Object.create(a.prototype),s=new z(i||[]);return r(o,"_invoke",{value:C(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",d="suspendedYield",m="executing",y="completed",f={};function v(){}function g(){}function b(){}var w={};c(w,o,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(L([])));k&&k!==n&&i.call(k,o)&&(w=k);var S=b.prototype=v.prototype=Object.create(w);function P(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){function n(r,a,o,s){var l=u(e[r],e,a);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==re(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var a;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return a=a?a.then(r,r):r()}})}function C(t,n,i){var r=p;return function(a,o){if(r===m)throw Error("Generator is already running");if(r===y){if("throw"===a)throw o;return{value:e,done:!0}}for(i.method=a,i.arg=o;;){var s=i.delegate;if(s){var l=E(s,i);if(l){if(l===f)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===p)throw r=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var c=u(t,n,i);if("normal"===c.type){if(r=i.done?y:d,c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r=y,i.method="throw",i.arg=c.arg)}}}function E(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var a=u(r,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,f;var o=a.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,f):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function L(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(re(t)+" is not iterable")}return g.prototype=b,r(S,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},P(M.prototype),c(M.prototype,s,(function(){return this})),t.AsyncIterator=M,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new M(h(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},P(S),c(S,l,"Generator"),c(S,o,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=L,z.prototype={constructor:z,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;A(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:L(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}function oe(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function se(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){oe(a,i,r,o,s,"next",e)}function s(e){oe(a,i,r,o,s,"throw",e)}o(void 0)}))}}function le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ce(i.key),i)}}function ce(e){var t=function(e){if("object"!=re(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=re(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==re(t)?t:t+""}var he=function(){return e=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.parent=n,this.scale=r,this.environmentGroup=new i.YJl,this.parent.add(this.environmentGroup),this.textures={honeycomb:null,honey:null,cells:null},this.hiveElements={honeycombs:null,honeyDrops:null,waxStructures:null},this.createEnvironment()},t=[{key:"createEnvironment",value:(r=se(ae().mark((function e(){return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTextures();case 2:this.createCylindricalArena(),this.createHiveElements(),this.createSunlight();case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"loadTextures",value:(n=se(ae().mark((function e(){var t,n;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.game.honeycombTextures||this.game.textureGenerator||this.game.honeycombTextureGenerator){e.next=3;break}return e.abrupt("return");case 3:if(e.prev=3,"function"!=typeof t.getTexture){e.next=17;break}return e.next=7,t.getTexture("honeycomb");case 7:return this.textures.honeycomb=e.sent,e.next=10,t.getTexture("honey");case 10:return this.textures.honey=e.sent,e.next=13,t.getTexture("cells");case 13:this.textures.cells=e.sent,console.log("Successfully loaded textures during initialization"),e.next=25;break;case 17:if("function"!=typeof t.initialize){e.next=24;break}return e.next=20,t.initialize();case 20:n=e.sent,this.textures.honeycomb=n,e.next=25;break;case 24:t.textures&&(t.textures.honeycomb&&(this.textures.honeycomb=t.textures.honeycomb),t.textures.honey&&(this.textures.honey=t.textures.honey),t.textures.cells&&(this.textures.cells=t.textures.cells));case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),console.log("Note: Initial texture loading deferred - will be applied when available");case 30:case"end":return e.stop()}}),e,this,[[3,27]])}))),function(){return n.apply(this,arguments)})},{key:"createCylindricalArena",value:function(){var e=400*this.scale,t=300*this.scale,n=new i.Ho_(e,e,t,32,1,!0),r=new i.uSd({color:8965375,metalness:.2,roughness:.05,transparent:!0,opacity:.3,side:i.$EB,transmission:.95,reflectivity:.2,clearcoat:.3});this.wallMaterial=r;var a=new i.eaF(n,r);a.position.set(0,t/2,0),a.name="walls",this.environmentGroup.add(a);var o=new i.tcD(e,32),s=new i._4j({map:this.textures.honeycomb||null,side:i.$EB,roughness:.8,metalness:.2});this.floorMaterial=s;var l=new i.eaF(o,s);l.rotation.x=-Math.PI/2,l.position.set(0,0,0),l.name="floor",l.receiveShadow=!0,this.environmentGroup.add(l);var c=new i.tcD(e,32),h=new i._4j({map:this.textures.honeycomb||null,side:i.$EB,roughness:.8,metalness:.2});this.ceilingMaterial=h;var u=new i.eaF(c,h);u.rotation.x=Math.PI/2,u.position.set(0,t,0),u.name="ceiling",this.environmentGroup.add(u)}},{key:"createHiveElements",value:function(){var e=400*this.scale,t=300*this.scale;this.createHoneycombCells(e,t),this.createHoneyDrops(e,t),this.createWaxStructures(e,t),this.createFireCubes(e,t)}},{key:"createHoneycombCells",value:function(e,t){var n=new i.Ho_(5*this.scale,5*this.scale,2*this.scale,6),r=new i._4j({map:this.textures.cells||this.textures.honeycomb,color:14527044,roughness:.7,metalness:.2}),a=new i.ZLX(n,r,120);a.castShadow=!0,a.receiveShadow=!0,this.environmentGroup.add(a),this.hiveElements.honeycombs=a;for(var o=new i.kn4,s=new i.PTz,l=0;l<120;l++){var c=void 0,h=void 0,u=void 0;if(l<84){var p=Math.random()*Math.PI*2,d=.9*e;c=Math.cos(p)*d,u=Math.sin(p)*d,h=Math.random()*t;var m=new i.Pq0(-c,0,-u).normalize();s.setFromUnitVectors(new i.Pq0(0,1,0),m)}else c=(Math.random()-.5)*e*1.5,u=(Math.random()-.5)*e*1.5,h=20+Math.random()*(t-40),s.setFromEuler(new i.O9p(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI));var y=(.8+.4*Math.random())*this.scale;o.compose(new i.Pq0(c,h,u),s,new i.Pq0(y,y,y)),a.setMatrixAt(l,o)}a.instanceMatrix.needsUpdate=!0}},{key:"createHoneyDrops",value:function(e,t){var n=new i.Gu$(2*this.scale,8,8),r=new i._4j({map:this.textures.honey||this.textures.honeycomb,color:16763938,roughness:.2,metalness:.1,emissive:16759552,emissiveIntensity:.2}),a=new i.ZLX(n,r,40);a.castShadow=!0,this.environmentGroup.add(a),this.hiveElements.honeyDrops=a;for(var o=new i.kn4,s=0;s<40;s++){var l=void 0,c=void 0,h=void 0;s<24?(l=(Math.random()-.5)*e*1.6,h=(Math.random()-.5)*e*1.6,c=t-20*Math.random()*this.scale):(l=(Math.random()-.5)*e*1.4,h=(Math.random()-.5)*e*1.4,c=Math.random()*t);var u=(.8+.4*Math.random())*this.scale,p=(Math.random()>.5?1+1.5*Math.random():.8+.4*Math.random())*this.scale,d=u;o.compose(new i.Pq0(l,c,h),new i.PTz,new i.Pq0(u,p,d)),a.setMatrixAt(s,o)}a.instanceMatrix.needsUpdate=!0}},{key:"createWaxStructures",value:function(e,t){var n=new i.iNn(8*this.scale,3*this.scale,4*this.scale),r=new i._4j({map:this.textures.honeycomb,color:16777130,roughness:.5,metalness:.1}),a=new i.ZLX(n,r,35);a.castShadow=!0,a.receiveShadow=!0,this.environmentGroup.add(a),this.hiveElements.waxStructures=a;for(var o=new i.kn4,s=new i.PTz,l=[],c=0;c<7;c++)l.push({x:(Math.random()-.5)*e*.8,y:50+Math.random()*(t-100),z:(Math.random()-.5)*e*.8});for(var h=0;h<35;h++){var u=l[Math.floor(Math.random()*l.length)],p=u.x+30*(Math.random()-.5)*this.scale,d=u.y+30*(Math.random()-.5)*this.scale,m=u.z+30*(Math.random()-.5)*this.scale;s.setFromEuler(new i.O9p(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI));var y=(.7+.6*Math.random())*this.scale;o.compose(new i.Pq0(p,d,m),s,new i.Pq0(y,y,y)),a.setMatrixAt(h,o)}a.instanceMatrix.needsUpdate=!0}},{key:"_createVibeJamTexture",value:function(){var e=256,t=document.createElement("canvas");t.width=e,t.height=e;var n=t.getContext("2d");n.fillStyle="#6A0DAD",n.fillRect(0,0,e,e),n.fillStyle="#FFFF00",n.font="bold 48px Arial",n.textAlign="center",n.textBaseline="middle",n.fillText("#vibeJam",128,128);var r=new i.GOR(t);return r.needsUpdate=!0,r}},{key:"createFireCubes",value:function(e,t){var n=new i.iNn(6*this.scale,6*this.scale,6*this.scale),r=this._createVibeJamTexture(),a=new i._4j({map:r,roughness:.7,metalness:.1}),o=new i.ZLX(n,a,25);o.castShadow=!0,this.environmentGroup.add(o),this.hiveElements.fireCubes=o;for(var s=new i.kn4,l=new i.PTz,c=0;c<25;c++){var h=(Math.random()-.5)*e*1.8,u=(Math.random()-.5)*e*1.8,p=10*this.scale+Math.random()*(t-20*this.scale);l.setFromEuler(new i.O9p(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2));var d=(.8+.4*Math.random())*this.scale;s.compose(new i.Pq0(h,p,u),l,new i.Pq0(d,d,d)),o.setMatrixAt(c,s)}o.instanceMatrix.needsUpdate=!0}},{key:"createSunlight",value:function(){var e=new i.$p8(16777164,.4);this.environmentGroup.add(e);var t=new i.ZyN(16777215,1.6);t.position.set(0,500*this.scale,200*this.scale),t.castShadow=!0,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.shadow.camera.near=50*this.scale,t.shadow.camera.far=1e3*this.scale;var n=500*this.scale;t.shadow.camera.left=-n,t.shadow.camera.right=n,t.shadow.camera.top=n,t.shadow.camera.bottom=-n,this.environmentGroup.add(t),this.sunLight=t,this.shadowTarget=new i.B69,this.shadowTarget.position.set(0,0,0),this.environmentGroup.add(this.shadowTarget),t.target=this.shadowTarget;var r=new i.HiM(16777164,.7,300*this.scale);r.position.set(0,280*this.scale,0),this.environmentGroup.add(r);var a=new i.HiM(16755268,.5,150*this.scale);a.position.set(100*this.scale,150*this.scale,100*this.scale),this.environmentGroup.add(a);var o=new i.HiM(16768358,.5,150*this.scale);o.position.set(-100*this.scale,150*this.scale,-100*this.scale),this.environmentGroup.add(o)}},{key:"update",value:function(e){this.game.player&&this.shadowTarget&&(this.shadowTarget.position.copy(this.game.player.position),this.sunLight.target.updateMatrixWorld()),this.updateAnimatedTextures(),Math.random()<.2&&this.animateHoneyDrops()}},{key:"updateAnimatedTextures",value:function(){this.textures.honeycomb&&this.textures.honeycomb.image instanceof HTMLCanvasElement&&(this.textures.honeycomb.needsUpdate=!0),this.textures.honey&&this.textures.honey.image instanceof HTMLCanvasElement&&(this.textures.honey.needsUpdate=!0),this.textures.cells&&this.textures.cells.image instanceof HTMLCanvasElement&&(this.textures.cells.needsUpdate=!0),this.hiveElements.honeycombs&&this.hiveElements.honeycombs.material&&(this.hiveElements.honeycombs.material.needsUpdate=!0),this.hiveElements.honeyDrops&&this.hiveElements.honeyDrops.material&&(this.hiveElements.honeyDrops.material.needsUpdate=!0),this.hiveElements.waxStructures&&this.hiveElements.waxStructures.material&&(this.hiveElements.waxStructures.material.needsUpdate=!0),this.floorMaterial&&(this.floorMaterial.needsUpdate=!0),this.ceilingMaterial&&(this.ceilingMaterial.needsUpdate=!0)}},{key:"animateHoneyDrops",value:function(){if(this.hiveElements.honeyDrops)for(var e=this.hiveElements.honeyDrops,t=300*this.scale,n=Math.min(5,e.count),r=Math.floor(Math.random()*(e.count-n)),a=new i.kn4,o=new i.Pq0,s=new i.PTz,l=new i.Pq0,c=r;c<r+n;c++)e.getMatrixAt(c,a),a.decompose(o,s,l),o.y>t-50*this.scale&&(o.y-=.2*this.scale,o.y<t-40*this.scale?(o.y=t-10*Math.random()*this.scale,l.y=(1+1.5*Math.random())*this.scale):l.y+=.05*this.scale,a.compose(o,s,l),e.setMatrixAt(c,a),e.instanceMatrix.needsUpdate=!0)}},{key:"updateTextures",value:function(e,t){if(t){switch(e in this.textures&&(this.textures[e]=t),e){case"honeycomb":this.floorMaterial&&(this.floorMaterial.map=t,this.floorMaterial.needsUpdate=!0),this.ceilingMaterial&&(this.ceilingMaterial.map=t,this.ceilingMaterial.needsUpdate=!0),this.hiveElements.waxStructures&&(this.hiveElements.waxStructures.material.map=t,this.hiveElements.waxStructures.material.needsUpdate=!0);break;case"honey":this.hiveElements.honeyDrops&&(this.hiveElements.honeyDrops.material.map=t,this.hiveElements.honeyDrops.material.needsUpdate=!0);break;case"cells":this.hiveElements.honeycombs&&(this.hiveElements.honeycombs.material.map=t,this.hiveElements.honeycombs.material.needsUpdate=!0)}(t.animated||t.source&&t.source.data&&"CANVAS"===t.source.data.tagName)&&(t.needsConstantUpdate=!0)}else console.warn("Attempted to update with null texture of type:",e)}},{key:"getColliders",value:function(){var e=[];e.push({type:"plane",position:new i.Pq0(0,0,0),normal:new i.Pq0(0,1,0)}),e.push({type:"plane",position:new i.Pq0(0,300*this.scale,0),normal:new i.Pq0(0,-1,0)});var t=400*this.scale;return e.push({type:"cylinder",position:new i.Pq0(0,150*this.scale,0),radius:t,height:300*this.scale,invertNormals:!0}),e}}],t&&le(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function de(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,me(i.key),i)}}function me(e){var t=function(e){if("object"!=ue(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ue(t)?t:t+""}var ye=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scene=t.scene,this.arenaGroup=new i.YJl,this.scene.add(this.arenaGroup),this.textureApplied=!1,this.textureUUID=null,this.bulletManager=new U(t,this.arenaGroup),this.enemyManager=new Z(t,this.arenaGroup),this.environment=new he(t,this.arenaGroup),this.powerUpManager=new ie(t,this.arenaGroup),this.gameStartTime=0,this.gameScore=0,this.killStreak=0,this.createScoreDisplay(),this.createHealthIndicator(),this.applyExistingTextures()},(t=[{key:"applyExistingTextures",value:function(){var e=this,t=this.game.honeycombTextures||this.game.textureGenerator;t&&("function"==typeof t.getTexture?Promise.all([t.getTexture("honeycomb"),t.getTexture("fire")]).then((function(t){var n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return pe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),i=n[0],r=n[1];i&&e.updateTexture(i),r&&e.environment.updateTextures("fire",r)})).catch((function(e){console.warn("Could not apply existing textures:",e)})):t.textures&&(t.textures.honeycomb&&this.updateTexture(t.textures.honeycomb),t.textures.fire&&this.environment.updateTextures("fire",t.textures.fire)))}},{key:"updateTexture",value:function(e){return!!e&&(this.textureUUID=e.uuid,this.environment&&(e.name&&e.name.includes("fire")||e.generator&&e.generator.includes("fire")?this.environment.updateTextures("fire",e):this.environment.updateTextures("honeycomb",e),this.textureApplied=!0),!0)}},{key:"createScoreDisplay",value:function(){this.scoreDisplay=document.createElement("div"),this.scoreDisplay.style.position="absolute",this.scoreDisplay.style.top="70px",this.scoreDisplay.style.right="20px",this.scoreDisplay.style.backgroundColor="rgba(0, 0, 0, 0.0)",this.scoreDisplay.style.color="white",this.scoreDisplay.style.padding="5px 10px",this.scoreDisplay.style.borderRadius="5px",this.scoreDisplay.style.fontFamily="Arial, sans-serif",this.scoreDisplay.style.fontSize="20px",this.scoreDisplay.style.display="none",this.scoreDisplay.style.zIndex="100",this.streakText=document.createElement("div"),this.streakText.textContent="Streak: 0",this.scoreDisplay.appendChild(this.streakText),document.body.appendChild(this.scoreDisplay)}},{key:"updateScoreDisplay",value:function(){this.scoreDisplay&&this.streakText&&(this.streakText.textContent="Streak: ".concat(this.killStreak))}},{key:"addScore",value:function(e){var t=1+.1*this.killStreak,n=Math.round(e*t);this.gameScore+=n,this.killStreak++,this.updateScoreDisplay(),this.killStreak%10==0&&this.powerUpManager.spawnPowerUp(),this.showScoreText("+".concat(n),this.game.player.position)}},{key:"showScoreText",value:function(e,t){if(this.game.camera&&t){var n=t.clone();n.project(this.game.camera);var i=(.5*n.x+.5)*window.innerWidth,r=-(.5*n.y-.5)*window.innerHeight,a=document.createElement("div");a.textContent=e,a.style.position="absolute",a.style.color="#ffcc00",a.style.fontSize="16px",a.style.fontWeight="bold",a.style.top="".concat(r,"px"),a.style.left="".concat(i,"px"),a.style.textShadow="0 0 3px black",a.style.pointerEvents="none",a.style.zIndex="1000",a.style.transition="all 0.8s ease-out",document.body.appendChild(a),setTimeout((function(){a.style.opacity="0",a.style.transform="translate(0, -30px)",setTimeout((function(){a.parentNode&&document.body.removeChild(a)}),800)}),50)}}},{key:"resetStreak",value:function(){this.killStreak=0,this.updateScoreDisplay()}},{key:"createHealthIndicator",value:function(){this.healthContainer=document.createElement("div"),this.healthContainer.style.position="absolute",this.healthContainer.style.top="20px",this.healthContainer.style.left="20px",this.healthContainer.style.width="200px",this.healthContainer.style.backgroundColor="rgba(0, 0, 0, 0.5)",this.healthContainer.style.padding="10px",this.healthContainer.style.borderRadius="5px",this.healthContainer.style.display="none",this.healthContainer.style.zIndex="100";var e=document.createElement("div");e.textContent="HEALTH",e.style.color="white",e.style.fontSize="14px",e.style.marginBottom="5px",e.style.fontFamily="Arial, sans-serif",e.style.fontWeight="bold",this.healthContainer.appendChild(e);var t=document.createElement("div");t.style.width="100%",t.style.height="20px",t.style.backgroundColor="rgba(255, 255, 255, 0.2)",t.style.borderRadius="3px",t.style.overflow="hidden",this.healthContainer.appendChild(t),this.healthBar=document.createElement("div"),this.healthBar.style.width="100%",this.healthBar.style.height="100%",this.healthBar.style.backgroundColor="#00ff00",this.healthBar.style.transition="width 0.3s, background-color 0.3s",t.appendChild(this.healthBar),this.healthValue=document.createElement("div"),this.healthValue.textContent="100/100",this.healthValue.style.color="white",this.healthValue.style.fontSize="14px",this.healthValue.style.marginTop="5px",this.healthValue.style.fontFamily="Arial, sans-serif",this.healthValue.style.textAlign="center",this.healthContainer.appendChild(this.healthValue),document.body.appendChild(this.healthContainer),this.updateHealthIndicator(100)}},{key:"updateHealthIndicator",value:function(e){if(this.healthBar&&this.healthValue){var t=Math.max(0,Math.min(100,e/100*100));if(this.healthBar.style.width="".concat(t,"%"),this.healthBar.style.backgroundColor=t>60?"#00ff00":t>30?"#ffff00":"#ff0000",this.healthValue.textContent="".concat(Math.ceil(e),"/").concat(100),t<20){if(this.healthContainer.style.animation="pulse 1.5s infinite",!document.getElementById("health-pulse-animation")){var n=document.createElement("style");n.id="health-pulse-animation",n.textContent="\n          @keyframes pulse {\n            0% { transform: scale(1); }\n            50% { transform: scale(1.05); }\n            100% { transform: scale(1); }\n          }\n        ",document.head.appendChild(n)}}else this.healthContainer.style.animation="none"}}},{key:"initializeCombat",value:function(){var e=this;if(this.arenaGroup.visible=!0,this.game.collisionSystem){var t=this.environment?this.environment.getColliders():[];this.game.collisionSystem.addColliders(t),this.game.collidersRegistered=!0}this.bulletManager&&this.bulletManager.prewarmSystem(),this.scoreDisplay&&(this.scoreDisplay.style.display="block"),this.healthContainer&&(this.healthContainer.style.display="block"),this.gameStartTime=performance.now(),this.gameScore=0,this.killStreak=0,this.updateScoreDisplay(),this.enemyManager?(this.enemyManager.reset(),this.enemyManager.spawnInitialEnemies(5),setTimeout((function(){"function"==typeof e.enemyManager.increaseWaveDifficulty?e.enemyManager.increaseWaveDifficulty():console.warn("Wave system not available on enemyManager")}),2e3)):console.error("Enemy manager not initialized!"),setTimeout((function(){e.powerUpManager&&e.powerUpManager.spawnPowerUp()}),15e3)}},{key:"reset",value:function(){return this.bulletManager&&this.bulletManager.reset(),this.enemyManager&&this.enemyManager.reset(),this.powerUpManager&&this.powerUpManager.reset(),this.gameScore=0,this.killStreak=0,this.updateScoreDisplay(),this.scoreDisplay&&(this.scoreDisplay.style.display="none"),this.healthContainer&&(this.healthContainer.style.display="none"),!0}},{key:"update",value:function(e){var t=this;this.environment&&this.environment.update(e),this.bulletManager&&this.bulletManager.update((function(e,t){return!1}),this.enemyManager),this.enemyManager&&this.enemyManager.update(e),this.powerUpManager&&this.powerUpManager.update(),void 0!==this.game.playerHealth&&this.healthContainer&&this.updateHealthIndicator(this.game.playerHealth),this.enemyManager&&(this.enemyManager.onEnemyDefeated||(this.enemyManager.onEnemyDefeated=function(){t.addScore(100)}))}}])&&de(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}function ve(e){return function(e){if(Array.isArray(e))return ge(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ge(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ge(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function be(){be=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,i){var a=t&&t.prototype instanceof v?t:v,o=Object.create(a.prototype),s=new z(i||[]);return r(o,"_invoke",{value:C(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",d="suspendedYield",m="executing",y="completed",f={};function v(){}function g(){}function b(){}var w={};c(w,o,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(L([])));k&&k!==n&&i.call(k,o)&&(w=k);var S=b.prototype=v.prototype=Object.create(w);function P(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){function n(r,a,o,s){var l=u(e[r],e,a);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==fe(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var a;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return a=a?a.then(r,r):r()}})}function C(t,n,i){var r=p;return function(a,o){if(r===m)throw Error("Generator is already running");if(r===y){if("throw"===a)throw o;return{value:e,done:!0}}for(i.method=a,i.arg=o;;){var s=i.delegate;if(s){var l=E(s,i);if(l){if(l===f)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===p)throw r=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var c=u(t,n,i);if("normal"===c.type){if(r=i.done?y:d,c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r=y,i.method="throw",i.arg=c.arg)}}}function E(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var a=u(r,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,f;var o=a.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,f):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function L(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(fe(t)+" is not iterable")}return g.prototype=b,r(S,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},P(M.prototype),c(M.prototype,s,(function(){return this})),t.AsyncIterator=M,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new M(h(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},P(S),c(S,l,"Generator"),c(S,o,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=L,z.prototype={constructor:z,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;A(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:L(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}function we(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function xe(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){we(a,i,r,o,s,"next",e)}function s(e){we(a,i,r,o,s,"throw",e)}o(void 0)}))}}function ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Se(i.key),i)}}function Se(e){var t=function(e){if("object"!=fe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==fe(t)?t:t+""}var Pe=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.size=t,this.textures={},this.p5Instance=null,this.initialized=!1,this.isP5Loaded=!1,this.fallbackMode=!1,this.textureTypes={honeycomb:{canvas:null,texture:null,animating:!1,time:0,animationSpeed:.5,colors:{background:[255,204,102],honeyCells:[255,170,50],honey:[255,150,0],highlights:[255,220,150],darkHoney:[180,100,0]},generator:this._generateHoneycombTexture.bind(this),updater:this._updateHoneycombTexture.bind(this)},fire:{canvas:null,texture:null,animating:!1,time:0,animationSpeed:.8,colors:{base:[25,120,20],highlight:[25,255,100],dark:[80,30,0]},generator:this._generateFireTexture.bind(this),updater:this._updateFireTexture.bind(this)},honey:{canvas:null,texture:null,animating:!1,time:0,animationSpeed:.3,colors:{base:[255,200,40],highlight:[255,240,150],dark:[200,160,0]},generator:this._generateHoneyTexture.bind(this),updater:this._updateHoneyTexture.bind(this)},cells:{canvas:null,texture:null,animating:!1,time:0,animationSpeed:.4,colors:{background:[240,220,180],cells:[220,180,120],highlight:[255,240,200]},generator:this._generateCellsTexture.bind(this),updater:this._updateCellsTexture.bind(this)}},"undefined"!=typeof p5&&(this.isP5Loaded=!0)},t=[{key:"initialize",value:(a=xe(be().mark((function e(){var t,n,r=this,a=arguments;return be().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"honeycomb",e.next=3,this.ensureP5Loaded();case 3:if(this.isP5Loaded){e.next=6;break}return this.fallbackMode=!0,e.abrupt("return",this.createFallbackTexture(t));case 6:if(this.textureTypes[t]||(console.warn("Texture type '".concat(t,"' not found, using honeycomb instead")),t="honeycomb"),!this.textures[t]||!this.textures[t].texture){e.next=9;break}return e.abrupt("return",this.textures[t].texture);case 9:return(n=document.getElementById("texture-container"))||((n=document.createElement("div")).id="texture-container",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.opacity="0.1",n.style.pointerEvents="none",n.style.zIndex="-9999",document.body.appendChild(n)),this.currentType=t,e.abrupt("return",new Promise((function(e){try{new p5((function(a){a.setup=function(){try{var o=a.createCanvas(r.size,r.size);o.parent(n),a.colorMode(a.RGB),a.noStroke(),r.textureTypes[t].canvas=o,r.textureTypes[t].generator(a);var s=new i.GOR(o.elt);s.wrapS=i.GJx,s.wrapT=i.GJx,s.repeat.set(3,3),s.needsUpdate=!0,r.textureTypes[t].texture=s,r.textures[t]=r.textureTypes[t],r.textureTypes[t].animating=!0,r.p5Instance||(r.p5Instance=a),r.initialized=!0,e(s)}catch(n){console.error("Error initializing texture:",n),r.fallbackMode=!0,e(r.createFallbackTexture(t))}},a.draw=function(){if(r.textureTypes[t].animating)try{r.textureTypes[t].time+=r.textureTypes[t].animationSpeed,r.textureTypes[t].updater(a),r.textureTypes[t].texture&&(r.textureTypes[t].texture.needsUpdate=!0)}catch(e){console.error("Error in draw:",e),r.textureTypes[t].animating=!1}}}),n)}catch(n){console.error("Error creating P5 instance:",n),r.fallbackMode=!0,e(r.createFallbackTexture(t))}})));case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getTexture",value:(r=xe(be().mark((function e(){var t,n=arguments;return be().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:"honeycomb",!this.textures[t]||!this.textures[t].texture){e.next=3;break}return e.abrupt("return",this.textures[t].texture);case 3:return e.abrupt("return",this.initialize(t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"registerTextureType",value:function(e,t){return this.textureTypes[e]&&console.warn("Texture type '".concat(e,"' already exists and will be overwritten")),this.textureTypes[e]={canvas:null,texture:null,animating:!1,time:0,animationSpeed:t.animationSpeed||.5,colors:t.colors||{},generator:t.generator||this._generateFallbackTexture.bind(this),updater:t.updater||this._updateFallbackTexture.bind(this)},e}},{key:"startAnimation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?this.textureTypes[t]&&(this.textureTypes[t].animating=!0):Object.keys(this.textureTypes).forEach((function(t){e.textureTypes[t].texture&&(e.textureTypes[t].animating=!0)}))}},{key:"stopAnimation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?this.textureTypes[t]&&(this.textureTypes[t].animating=!1):Object.keys(this.textureTypes).forEach((function(t){e.textureTypes[t].animating=!1}))}},{key:"_generateHoneycombTexture",value:function(e){var t=this.textureTypes.honeycomb.colors;e.background.apply(e,ve(t.background));e.fill.apply(e,ve(t.honeyCells));for(var n=-1;n<this.size/86.6+1;n++)for(var i=-1;i<this.size/75+1;i++){var r=75*i+n%2*75/2,a=86.6*n;if(e.fill(t.darkHoney),this._drawHexagon(e,r,a,52.5),e.fill.apply(e,ve(t.honeyCells)),this._drawHexagon(e,r,a,50),Math.random()>.5){var o=.4+.5*Math.random();e.fill.apply(e,ve(t.honey).concat([200])),this._drawHexagon(e,r,a,50*o),e.fill.apply(e,ve(t.highlights).concat([150])),e.ellipse(r-10,a-10,15)}}}},{key:"_updateHoneycombTexture",value:function(e){var t=this.textureTypes.honeycomb.colors,n=this.textureTypes.honeycomb.time;e.background.apply(e,ve(t.background));for(var i=-1;i<this.size/86.6+1;i++)for(var r=-1;r<this.size/75+1;r++){var a=75*r+i%2*75/2,o=86.6*i,s=.3*n,l=Math.sqrt(Math.pow(a-this.size/2,2)+Math.pow(o-this.size/2,2)),c=1+.05*Math.sin(s+.01*l);e.fill(t.darkHoney),this._drawHexagon(e,a,o,50*c*1.05),e.fill.apply(e,ve(t.honeyCells)),this._drawHexagon(e,a,o,50*c);var h=e.noise(.01*a,.01*o,.05*s);if(h>.4){var u=e.map(h,.4,1,0,.9);e.fill.apply(e,ve(t.honey).concat([220])),this._drawWobblyHexagon(e,a,o,50*u*c,s);var p=a-10+3*Math.sin(s+.1*a),d=o-10+3*Math.cos(s+.1*o);e.fill.apply(e,ve(t.highlights).concat([150])),e.ellipse(p,d,15)}}this._drawHoneyDrips(e,t,n)}},{key:"_generateFireTexture",value:function(e){var t=this.textureTypes.fire.colors;e.background(0,0,0);for(var n=0;n<this.size;n++){var i=n/this.size,r=e.lerp(t.base[0],t.dark[0],i),a=e.lerp(t.base[1],t.dark[1],i),o=e.lerp(t.base[2],t.dark[2],i);e.stroke(r,a,o),e.line(0,n,this.size,n)}e.noStroke()}},{key:"_updateFireTexture",value:function(e){var t=this.textureTypes.fire.colors,n=this.textureTypes.fire.time;e.background(0,0,0);for(var i=0;i<this.size;i+=4)for(var r=0;r<this.size;r+=4){var a=e.noise(.01*r,.01*i-.1*n,.05*n);if(a>.5){var o=e.map(a,.5,1,0,1),s=void 0,l=void 0,c=void 0,h=void 0;if(o<.5){var u=2*o;s=e.lerp(t.dark[0],t.base[0],u),l=e.lerp(t.dark[1],t.base[1],u),c=e.lerp(t.dark[2],t.base[2],u),h=200}else{var p=2*(o-.5);s=e.lerp(t.base[0],t.highlight[0],p),l=e.lerp(t.base[1],t.highlight[1],p),c=e.lerp(t.base[2],t.highlight[2],p),h=255}e.fill(s,l,c,h);var d=e.map(a,.5,1,4,12),m=10*Math.sin(.1*n+.1*r);e.ellipse(r,i+m,d,1.5*d)}}for(var y=0;y<100;y++){var f=Math.sin(.1*y+.1*n)*this.size*.4+.5*this.size,v=.2*this.size+100*Math.cos(.1*y+.2*n)-2*y;if(e.noise(.1*y,.1*n)>.6){e.fill.apply(e,ve(t.highlight).concat([150]));var g=5*e.noise(y,.2*n);e.ellipse(f,v,g,g)}}}},{key:"_generateHoneyTexture",value:function(e){var t=this.textureTypes.honey.colors;e.background.apply(e,ve(t.base));for(var n=0;n<50;n++){var i=Math.random()*this.size,r=Math.random()*this.size,a=10+40*Math.random();e.fill.apply(e,ve(t.dark).concat([100])),e.ellipse(i,r,a+4),e.fill.apply(e,ve(t.base).concat([200])),e.ellipse(i,r,a),e.fill.apply(e,ve(t.highlight).concat([150])),e.ellipse(i-.3*a,r-.3*a,.4*a)}}},{key:"_updateHoneyTexture",value:function(e){var t=this.textureTypes.honey.colors,n=this.textureTypes.honey.time;e.background.apply(e,ve(t.base));for(var i=0;i<this.size;i+=20)for(var r=0;r<this.size;r+=20){var a=e.noise(.005*r,.005*i,.05*n);if(a>.4){var o=e.map(a,.4,1,50,150);e.fill.apply(e,ve(t.dark).concat([o]));var s=e.map(a,.4,1,10,40),l=10*Math.sin(.1*n+.01*i);e.ellipse(r+l,i,s,s)}}for(var c=0;c<30;c++){var h=.2*c+.05*n,u=100+50*Math.sin(.3*c+.1*n),p=this.size/2+Math.cos(h)*u,d=this.size/2+Math.sin(h)*u,m=20+5*Math.sin(.2*n+c);e.fill.apply(e,ve(t.dark).concat([100])),e.ellipse(p,d,m+4),e.fill.apply(e,ve(t.base).concat([200])),e.ellipse(p,d,m);var y=p-.2*m+2*Math.sin(.3*n),f=d-.2*m+2*Math.cos(.3*n);e.fill.apply(e,ve(t.highlight).concat([150])),e.ellipse(y,f,.4*m)}}},{key:"_generateCellsTexture",value:function(e){var t=this.textureTypes.cells.colors;e.background.apply(e,ve(t.background));for(var n=0;n<this.size;n+=30)for(var i=0;i<this.size;i+=30){var r=30*(.8+.4*Math.random());e.fill.apply(e,ve(t.cells)),e.ellipse(i,n,r),Math.random()>.7&&(e.fill.apply(e,ve(t.highlight).concat([150])),e.ellipse(i-.2*r,n-.2*r,.3*r))}}},{key:"_updateCellsTexture",value:function(e){var t=this.textureTypes.cells.colors,n=this.textureTypes.cells.time;e.background.apply(e,ve(t.background));for(var i=0;i<this.size;i+=30)for(var r=0;r<this.size;r+=30){var a=e.noise(.01*r,.01*i,.1*n),o=30*(.7+.6*a),s=5*Math.sin(.2*n+.02*i),l=5*Math.cos(.2*n+.02*r);if(e.fill.apply(e,ve(t.cells).concat([150+100*a])),e.ellipse(r+s,i+l,o),a>.5){var c=.4*o;e.fill.apply(e,ve(t.highlight).concat([150])),e.ellipse(r+s-.2*o,i+l-.2*o,c)}}e.noFill(),e.stroke.apply(e,ve(t.cells).concat([30])),e.strokeWeight(2);for(var h=0;h<5;h++){var u=100+100*h+50*Math.sin(.3*n);e.ellipse(this.size/2,this.size/2,u)}e.noStroke()}},{key:"_drawHexagon",value:function(e,t,n,i){e.beginShape();for(var r=0;r<6;r++){var a=e.TWO_PI/6*r-e.PI/6,o=t+i*Math.cos(a),s=n+i*Math.sin(a);e.vertex(o,s)}e.endShape(e.CLOSE)}},{key:"_drawWobblyHexagon",value:function(e,t,n,i,r){e.beginShape();for(var a=0;a<6;a++){var o=e.TWO_PI/6*a-e.PI/6,s=i+2*Math.sin(2*r+.5*a),l=t+s*Math.cos(o),c=n+s*Math.sin(o);e.vertex(l,c)}e.endShape(e.CLOSE)}},{key:"_drawHoneyDrips",value:function(e,t,n){for(var i=0;i<20;i++){var r=(.5*Math.sin(.5*i)+.5)*this.size,a=.3*Math.cos(.4*i)*this.size,o=.3+.2*Math.sin(i),s=50+20*Math.cos(2*i);if(n>2*i){var l=(a+(n-2*i)*o)%this.size;e.fill.apply(e,ve(t.honey).concat([200])),e.ellipse(r,l,10,15),e.beginShape();for(var c=0;c<10;c++){var h=c/9,u=l-h*s,p=e.lerp(10,3,h),d=2*Math.sin(n+c);e.ellipse(r+d,u,p,.7*p)}e.endShape(),e.fill.apply(e,ve(t.highlights).concat([150])),e.ellipse(r-3,l-3,4)}}}},{key:"_generateFallbackTexture",value:function(e){e.background(200,200,200),e.stroke(150),e.strokeWeight(1);for(var t=0;t<this.size;t+=20)e.line(0,t,this.size,t),e.line(t,0,t,this.size);e.noStroke()}},{key:"_updateFallbackTexture",value:function(e){this._generateFallbackTexture(e)}},{key:"ensureP5Loaded",value:(n=xe(be().mark((function e(){var t=this;return be().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"==typeof p5){e.next=3;break}return this.isP5Loaded=!0,e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,new Promise((function(e,n){var i=document.createElement("script");i.src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js",i.onload=function(){t.isP5Loaded=!0,e()},i.onerror=function(e){n(e)},document.head.appendChild(i)}));case 6:return e.abrupt("return","undefined"!=typeof p5);case 9:return e.prev=9,e.t0=e.catch(3),console.error("Failed to load P5.js:",e.t0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return n.apply(this,arguments)})},{key:"createFallbackTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"honeycomb",t=document.createElement("canvas");t.width=this.size,t.height=this.size;var n=t.getContext("2d");if("fire"===e){var r=n.createLinearGradient(0,0,0,this.size);r.addColorStop(0,"#ffff00"),r.addColorStop(.5,"#ff6600"),r.addColorStop(1,"#660000"),n.fillStyle=r,n.fillRect(0,0,this.size,this.size)}else if("honey"===e){n.fillStyle="#FFCC66",n.fillRect(0,0,this.size,this.size);for(var a=0;a<50;a++){n.fillStyle="rgba(255, 200, 0, 0.2)";var o=Math.random()*this.size,s=Math.random()*this.size,l=20+40*Math.random();n.beginPath(),n.arc(o,s,l,0,2*Math.PI),n.fill()}}else if("cells"===e){n.fillStyle="#F0DCB4",n.fillRect(0,0,this.size,this.size);for(var c=0;c<this.size;c+=30)for(var h=0;h<this.size;h+=30){n.fillStyle="rgba(220, 180, 120, 0.5)";var u=20+10*Math.random();n.beginPath(),n.arc(h,c,u/2,0,2*Math.PI),n.fill()}}else{n.fillStyle="#FFCC66",n.fillRect(0,0,this.size,this.size),n.fillStyle="#FF8800";for(var p=0;p<this.size;p+=75)for(var d=0;d<this.size;d+=86.5){var m=Math.floor(p/75)%2*50*.865;n.beginPath();for(var y=0;y<6;y++){var f=Math.PI/3*y,v=d+m+50*Math.cos(f),g=p+50*Math.sin(f);0===y?n.moveTo(v,g):n.lineTo(v,g)}n.closePath(),n.fill()}}var b=new i.GOR(t);return b.wrapS=i.GJx,b.wrapT=i.GJx,b.repeat.set(3,3),b.needsUpdate=!0,this.textures[e]?this.textures[e].texture=b:this.textures[e]={texture:b,animating:!1},this.initialized=!0,this.fallbackMode=!0,b}},{key:"dispose",value:function(){var e=this;this.stopAnimation(),Object.keys(this.textures).forEach((function(t){e.textures[t].texture&&e.textures[t].texture.dispose()})),this.p5Instance&&this.p5Instance.remove();var t=document.getElementById("texture-container");t&&document.body.removeChild(t),this.initialized=!1,this.textures={}}}],t&&ke(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,a}();function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}(e,t)||Te(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ee(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Te(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Te(e,t){if(e){if("string"==typeof e)return Ae(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ae(e,t):void 0}}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){Oe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Oe(e,t,n){return(t=Ie(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function De(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Ie(i.key),i)}}function Ie(e){var t=function(e){if("object"!=Me(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Me(t)?t:t+""}var Be=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.colliders=[],this.debugMode=!1,this.debugHelpers=[],this.scene=t?t.scene:null,this.constants={slideFriction:.1,minSlideSpeed:.03,maximumPenetration:.2,responseMultiplier:.9,collisionBuffer:.05}},(t=[{key:"addCollider",value:function(e){if(e.type&&e.position)return e.id||(e.id="collider_"+this.colliders.length),this.colliders.push(e),this.debugMode&&this.createDebugHelper(e),e.id}},{key:"removeCollider",value:function(e){var t=this.colliders.findIndex((function(t){return t.id===e}));if(-1!==t&&(this.colliders.splice(t,1),this.debugMode)){var n=this.debugHelpers.findIndex((function(t){return t.userData.colliderId===e}));if(-1!==n){var i=this.debugHelpers[n];i.parent&&i.parent.remove(i),this.debugHelpers.splice(n,1)}}}},{key:"addColliders",value:function(e){var t=this;Array.isArray(e)&&e.forEach((function(e){if("sphere"===e.type&&void 0!==e.radius)t.addCollider(e);else if("cylinder"===e.type&&void 0!==e.radius){var n=Le(Le({},e),{},{height:e.height||140});t.addCollider(n)}else if("plane"===e.type){var r=Le(Le({},e),{},{normal:e.normal||new i.Pq0(0,1,0)});t.addCollider(r)}else if("ring"===e.type)t.addCollider(e);else if("platform"===e.type){var a=Le(Le({},e),{},{type:"plane",normal:e.normal||new i.Pq0(0,1,0),size:e.radius||10});t.addCollider(a)}else if("ramp"===e.type){t.addCollider(e);var o=(new i.Pq0).subVectors(e.end,e.start).normalize(),s=new i.Pq0(0,1,0);s.cross(new i.Pq0(o.z,0,-o.x));var l={type:"plane",position:(new i.Pq0).addVectors(e.start,e.end).multiplyScalar(.5),normal:s,size:e.width||5};t.addCollider(l)}}))}},{key:"checkCollisions",value:function(e,t){if(!e||!e.position||!e.velocity||0===this.colliders.length)return!1;var n,r=!1,a=e.position,o=e.velocity,s=this.colliders.filter((function(e){return"plane"===e.type&&e.normal&&e.normal.y>.9})),l=Ee(s);try{for(l.s();!(n=l.n()).done;){var c,h,u=n.value,p=new i.Pq0,d=Ce(this.planeCollision(a,t,u.position,u.normal),3);c=d[0],p=d[1],h=d[2],c&&(r=!0,this.handleCollisionResponse(e,p,h),Math.abs(o.y)<.01&&(a.y+=.01),u.onCollision&&"function"==typeof u.onCollision&&u.onCollision(e))}}catch(e){l.e(e)}finally{l.f()}var m,y=Ee(this.colliders);try{for(y.s();!(m=y.n()).done;){var f=m.value;if(!s.includes(f)&&!1!==f.active){var v=!1,g=new i.Pq0,b=0;switch(f.type){case"sphere":if(f.invertNormals){var w=a.distanceTo(f.position),x=f.radius-t-1;if(w>x){v=!0;var k=(new i.Pq0).subVectors(a,f.position).normalize();if(g=k.clone().negate(),a.y<5&&g.y<0&&(g.y=0,g.length()>.1?g.normalize():g.set(a.x,0,a.z).normalize()),b=w-x,b*=.1,b=Math.min(b,.5),w>f.radius+20){var S=f.position.clone().add(k.clone().multiplyScalar(.8*x));return S.y=a.y,a.copy(S),o.set(0,0,0),!0}}else v=!1}else{var P=Ce(this.sphereCollision(a,t,f.position,f.radius),3);v=P[0],g=P[1],b=P[2]}break;case"cylinder":var M=Ce(this.cylinderCollision(a,t,f.position,f.radius,f.height,f.invertNormals),3);v=M[0],g=M[1],b=M[2];break;case"ring":var C=Ce(this.ringCollision(a,t,f.position,f.innerRadius,f.outerRadius),3);v=C[0],g=C[1],b=C[2];break;case"plane":var E=Ce(this.planeCollision(a,t,f.position,f.normal),3);v=E[0],g=E[1],b=E[2];break;case"platform":var T=a.x-f.position.x,A=a.z-f.position.z;if(T*T+A*A<=Math.pow(f.radius,2)){var z=a.y-f.position.y;(z>=0&&z<=1.2*t||z>-.2&&z<.2)&&o.y<=.1&&(v=!0,g=new i.Pq0(0,1,0),(b=t-z)<.1&&(b=.1),b>t&&(b=t))}}v&&(r=!0,this.handleCollisionResponse(e,g,b),f.onCollision&&"function"==typeof f.onCollision&&f.onCollision(e))}}}catch(e){y.e(e)}finally{y.f()}return r}},{key:"meshCollision",value:function(e,t,n,r){if(e.distanceTo(n.position)>t+r)return[!1,new i.Pq0,0];var a=(new i.NRn).setFromObject(n),o=new i.Pq0;o.copy(e),a.clampPoint(e,o);var s=(new i.Pq0).subVectors(e,o),l=t-s.length();return l>0?[!0,s.normalize(),l]:[!1,new i.Pq0,0]}},{key:"handleCollisionResponse",value:function(e,t,n){var i=e.position,r=e.velocity;if(i.y<5&&t.y<-.5&&n>1)r.y=Math.max(r.y,1);else{if(n>this.constants.maximumPenetration){var a=Math.min(n-this.constants.maximumPenetration+this.constants.collisionBuffer,1);i.addScaledVector(t,a)}var o=r.dot(t);if(o<0){var s=r.clone().sub(t.clone().multiplyScalar(o));s.multiplyScalar(this.constants.responseMultiplier),s.length()>this.constants.minSlideSpeed&&s.multiplyScalar(1-this.constants.slideFriction),t.y>.7&&(s.y+=.1),r.copy(s)}}}},{key:"sphereCollision",value:function(e,t,n,r){var a=(new i.Pq0).subVectors(e,n),o=a.length(),s=t+r;return o<s?[!0,a.clone().normalize(),s-o]:[!1,new i.Pq0,0]}},{key:"planeCollision",value:function(e,t,n,r){var a=(new i.Pq0).subVectors(e,n).dot(r);return Math.abs(a)<t?[!0,a>0?r.clone():r.clone().negate(),t-Math.abs(a)]:[!1,new i.Pq0,0]}},{key:"cylinderCollision",value:function(e,t,n,r,a,o){var s=n.clone(),l=a/2,c=e.y-(s.y+l),h=s.y-l-e.y;if(c>t||h>t)return[!1,new i.Pq0,0];var u=e.x-s.x,p=e.z-s.z,d=u*u+p*p,m=Math.sqrt(d);if(c<=0&&c>-t&&m<r)return[!0,new i.Pq0(0,1,0),t-Math.abs(c)];if(h<=0&&h>-t&&m<r)return[!0,new i.Pq0(0,-1,0),t-Math.abs(h)];var y=new i.Pq0,f=0,v=!1;return o?m>r-t&&(v=!0,y.set(-u,0,-p),y.normalize(),f=m-(r-t)):m<r+t&&(v=!0,y.set(u,0,p),y.normalize(),f=r+t-m),v?[!0,y,f]:[!1,new i.Pq0,0]}},{key:"ringCollision",value:function(e,t,n,r,a){if(Math.abs(e.y-n.y)>t)return[!1,new i.Pq0,0];var o=e.x-n.x,s=e.z-n.z,l=Math.sqrt(o*o+s*s);if(l<r+t)return[!0,new i.Pq0(o,0,s).normalize(),r+t-l];if(l>a-t){var c=l-(a-t);return[!0,new i.Pq0(o,0,s).normalize().negate(),c]}return[!1,new i.Pq0,0]}},{key:"createDebugHelper",value:function(e){var t,n=new i.V9B({color:16711680,transparent:!0,opacity:.3,wireframe:!0});switch(e.type){case"sphere":(t=new i.eaF(new i.Gu$(e.radius,16,16),n)).position.copy(e.position),e.invertNormals&&(t.material=new i.V9B({color:65280,transparent:!0,opacity:.3,wireframe:!0}));break;case"plane":var r=new i.bdM(100,100);(t=new i.eaF(r,n)).position.copy(e.position),t.lookAt(e.position.clone().add(e.normal));break;case"cylinder":(t=new i.eaF(new i.Ho_(e.radius,e.radius,e.height,32),n)).position.copy(e.position);break;case"ring":var a=new i.ypk;a.absarc(0,0,e.outerRadius,0,2*Math.PI,!1);var o=new i.wAk;o.absarc(0,0,e.innerRadius,0,2*Math.PI,!0),a.holes.push(o);var s=new i.MSw(a);(t=new i.eaF(s,n)).rotation.x=-Math.PI/2,t.position.copy(e.position);break;case"platform":(t=new i.eaF(new i.tcD(e.radius,32),n)).rotation.x=-Math.PI/2,t.position.copy(e.position);break;case"ramp":var l=(new i.Pq0).subVectors(e.end,e.start).length();t=new i.eaF(new i.iNn(e.width||5,.5,l),n);var c=(new i.Pq0).addVectors(e.start,e.end).multiplyScalar(.5);t.position.copy(c);var h=(new i.Pq0).subVectors(e.end,e.start),u=Math.atan2(h.z,h.x);t.rotation.y=-u;var p=e.end.y-e.start.y,d=Math.sqrt(h.x*h.x+h.z*h.z),m=Math.atan2(p,d);t.rotation.x=m}t&&(t.userData.colliderId=e.id,this.game&&this.game.scene?this.game.scene.add(t):this.scene&&this.scene.add(t),this.debugHelpers.push(t))}},{key:"toggleDebug",value:function(){var e=this;return this.debugMode=!this.debugMode,this.debugMode?this.colliders.forEach((function(t){return e.createDebugHelper(t)})):(this.debugHelpers.forEach((function(e){e.parent&&e.parent.remove(e)})),this.debugHelpers=[]),this.debugMode}},{key:"destroy",value:function(){this.debugMode&&this.debugHelpers.forEach((function(e){e.parent&&e.parent.remove(e)})),this.debugHelpers=[],this.colliders=[]}},{key:"reset",value:function(){return this.colliders=[],this.debugHelpers.length>0&&(this.debugHelpers.forEach((function(e){e.parent&&e.parent.remove(e)})),this.debugHelpers=[]),this.collidersRegistered=!1,!0}}])&&De(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function He(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Fe(i.key),i)}}function Fe(e){var t=function(e){if("object"!=je(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==je(t)?t:t+""}var Ge=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.poolSize=t.poolSize||200,this.scene=t.scene,this.geometries={sphere:[new i.Gu$(.05,4,4),new i.Gu$(.1,6,4),new i.Gu$(.2,8,6)],spark:new i.iNn(.1,.1,.1)},this.materials={honey:new i.V9B({color:16763904,transparent:!0,opacity:.7}),explosion:new i.V9B({color:16733440,transparent:!0,opacity:.8}),spark:new i.V9B({color:16777130,transparent:!0,opacity:.9})},this.pools={honey:[],explosion:[],spark:[]},this.initializePools(),this.activeParticles=[]},t=[{key:"initializePools",value:function(){var e=this;Object.keys(this.pools).forEach((function(t){for(var n=0;n<e.poolSize;n++){var r=void 0;if("honey"===t){var a=Math.floor(Math.random()*e.geometries.sphere.length);r=new i.eaF(e.geometries.sphere[a],e.materials.honey.clone())}else if("explosion"===t){var o=Math.floor(Math.random()*e.geometries.sphere.length);r=new i.eaF(e.geometries.sphere[o],e.materials.explosion.clone())}else"spark"===t&&(r=new i.eaF(e.geometries.spark,e.materials.spark.clone()));r.visible=!1,r.userData={active:!1,type:t,velocity:new i.Pq0,acceleration:new i.Pq0,lifetime:0,maxLifetime:0,onUpdate:null},e.scene&&e.scene.add(r),e.pools[t].push(r)}}))}},{key:"getParticle",value:function(e){var t=this.pools[e];if(!t)return null;for(var n=0;n<t.length;n++)if(!t[n].userData.active)return t[n];if(this.activeParticles.length>0){var i=1/0,r=null;if(this.activeParticles.forEach((function(t){t.userData.type===e&&t.userData.lifetime<i&&(i=t.userData.lifetime,r=t)})),r)return r}return null}},{key:"createEffect",value:function(e){for(var t=e.type,n=e.position,r=e.count,a=void 0===r?10:r,o=e.spread,s=void 0===o?.5:o,l=e.velocity,c=void 0===l?.1:l,h=e.acceleration,u=void 0===h?new i.Pq0(0,-.001,0):h,p=e.maxLifetime,d=void 0===p?60:p,m=e.onUpdate,y=void 0===m?null:m,f=e.parent,v=void 0===f?null:f,g=[],b=0;b<a;b++){var w=this.getParticle(t);if(w){w.position.copy(n),s>0&&(w.position.x+=(Math.random()-.5)*s,w.position.y+=(Math.random()-.5)*s,w.position.z+=(Math.random()-.5)*s);var x=new i.Pq0((Math.random()-.5)*c,(Math.random()-.5)*c,(Math.random()-.5)*c);w.visible=!0,w.material.opacity=1,w.userData.active=!0,w.userData.velocity=x,w.userData.acceleration=u.clone(),w.userData.lifetime=0,w.userData.maxLifetime=d+Math.random()*d*.5,w.userData.onUpdate=y,v&&(w.originalParent=w.parent,v.add(w)),this.activeParticles.includes(w)||this.activeParticles.push(w),g.push(w)}}return g}},{key:"createHoneyDrip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.createEffect({type:"honey",position:e,count:t.count||1,spread:t.spread||.2,velocity:t.velocity||.05,acceleration:new i.Pq0(0,-.002,0),maxLifetime:t.lifetime||120,onUpdate:function(e){var t=e.userData.lifetime/e.userData.maxLifetime;e.scale.y=1+t,t>.7&&(e.material.opacity=1*(1-(t-.7)/.3))}})}},{key:"createExplosion",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.createEffect({type:"explosion",position:e,count:t.count||15,spread:t.spread||.5,velocity:t.velocity||.2,maxLifetime:t.lifetime||60,onUpdate:function(e){var t=e.userData.lifetime/e.userData.maxLifetime;e.material.opacity=1*(1-t),e.userData.velocity.multiplyScalar(.98)}})}},{key:"update",value:function(){for(var e=this.activeParticles.length-1;e>=0;e--){var t=this.activeParticles[e],n=t.userData;t.position.add(n.velocity),n.velocity.add(n.acceleration),n.lifetime++,n.onUpdate&&n.onUpdate(t),n.lifetime>n.maxLifetime&&(this.recycleParticle(t),this.activeParticles.splice(e,1))}}},{key:"recycleParticle",value:function(e){e.visible=!1,e.userData.active=!1,e.userData.lifetime=0,e.userData.onUpdate=null,e.scale.set(1,1,1),e.originalParent&&e.parent!==e.originalParent&&(e.parent.remove(e),e.originalParent&&e.originalParent.add(e))}},{key:"prewarm",value:function(){var e=this,t=new i.Pq0;Object.keys(this.pools).forEach((function(n){for(var i=0;i<10;i++)e.createEffect({type:n,position:t,count:5}).forEach((function(t){return e.recycleParticle(t)}))})),this.activeParticles=[]}},{key:"dispose",value:function(){var e=this;this.activeParticles.forEach((function(t){return e.recycleParticle(t)})),this.activeParticles=[],this.scene&&Object.values(this.pools).flat().forEach((function(t){e.scene.remove(t)})),Object.keys(this.geometries).forEach((function(t){Array.isArray(e.geometries[t])?e.geometries[t].forEach((function(e){return e.dispose()})):e.geometries[t].dispose()})),Object.values(this.materials).forEach((function(e){return e.dispose()})),this.pools={}}}],t&&He(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}function _e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Re(i.key),i)}}function Re(e){var t=function(e){if("object"!=qe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==qe(t)?t:t+""}var Ue=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scene=t.scene,this.currentZone="exterior",this.transitionProgress=0,this.exteriorSkybox=null,this.interiorHive=null,this.game.assetManager&&this.game.assetManager.isLoaded()?(this.exteriorSkybox=this.game.assetManager.getTexture("forestSkybox"),this.interiorHive=this.game.assetManager.getTexture("spaceSkybox"),this.updateEnvironment()):(this.loadExteriorSkybox(),this.loadHiveHDRI())},t=[{key:"loadExteriorSkybox",value:function(){var e=this;(new i.Tap).load("assets/textures/forest_mid.png",(function(t){t.mapping=i.wfO,t.colorSpace=i.er$,e.exteriorSkybox=t,e.updateEnvironment()}))}},{key:"loadHiveHDRI",value:function(){var e=this;(new i.Tap).load("assets/textures/space_hdri.jpg",(function(t){t.mapping=i.wfO,t.colorSpace=i.er$,e.interiorHive=t,e.updateEnvironment()}))}},{key:"updateEnvironment",value:function(){"exterior"===this.currentZone&&this.exteriorSkybox?(this.game.scene.background=this.exteriorSkybox,this.updateLighting("exterior"),this.game.combatArena&&(this.game.combatArena.arenaGroup.visible=!1)):"interior"===this.currentZone&&this.interiorHive&&(this.game.scene.background=this.interiorHive,this.updateLighting("interior"),this.game.combatArena&&(this.game.combatArena.arenaGroup.visible=!0,this.game.inCombat||(this.game.combatArena.initializeCombat(),this.game.inCombat=!0)))}},{key:"updateLighting",value:function(e){this.game.scene.traverse((function(t){t.isLight&&t.userData.environmentLight&&("exterior"===e?(t.intensity=t.userData.exteriorIntensity||1,t.color.set(t.userData.exteriorColor||16777215)):"interior"===e&&(t.intensity=t.userData.interiorIntensity||.7,t.color.set(t.userData.interiorColor||16759671)))}))}},{key:"updateZone",value:function(e){var t=e.length();t<15?"interior"!==this.currentZone&&(this.currentZone="interior","interior"!==this.game.currentEnvironment&&this.game.switchEnvironment("interior"),this.updateEnvironment()):t>20&&"exterior"!==this.currentZone&&(this.currentZone="exterior",this.updateEnvironment())}},{key:"update",value:function(e){if("transition"===this.currentZone)if(this.transitionProgress+=.001*e,this.transitionProgress>=1)this.currentZone="interior",this.updateEnvironment(),"interior"!==this.game.currentEnvironment&&this.game.switchEnvironment("interior");else{var t=this.transitionProgress,n=1-t,i=t;this.blendEnvironments(n,i)}}},{key:"blendEnvironments",value:function(e,t){if(this.game.scene.fog){var n=new i.Q1f(8900331),r=new i.Q1f(13016173),a=(new i.Q1f).copy(n).multiplyScalar(e).add(r.clone().multiplyScalar(t));this.game.scene.fog.color.copy(a),this.game.scene.fog.density=.001*e+.002*t}this.blendLighting(e,t)}},{key:"blendLighting",value:function(e,t){this.game.scene.traverse((function(n){if(n.isLight&&n.userData.environmentLight){var r=n.userData.exteriorIntensity||1,a=n.userData.interiorIntensity||.7,o=new i.Q1f(n.userData.exteriorColor||16777215),s=new i.Q1f(n.userData.interiorColor||16759671);n.intensity=r*e+a*t,n.color.copy(o).multiplyScalar(e).add(s.clone().multiplyScalar(t))}}))}}],t&&_e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function Ve(){Ve=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,i){var a=t&&t.prototype instanceof v?t:v,o=Object.create(a.prototype),s=new z(i||[]);return r(o,"_invoke",{value:C(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",d="suspendedYield",m="executing",y="completed",f={};function v(){}function g(){}function b(){}var w={};c(w,o,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(L([])));k&&k!==n&&i.call(k,o)&&(w=k);var S=b.prototype=v.prototype=Object.create(w);function P(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){function n(r,a,o,s){var l=u(e[r],e,a);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==Ne(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var a;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return a=a?a.then(r,r):r()}})}function C(t,n,i){var r=p;return function(a,o){if(r===m)throw Error("Generator is already running");if(r===y){if("throw"===a)throw o;return{value:e,done:!0}}for(i.method=a,i.arg=o;;){var s=i.delegate;if(s){var l=E(s,i);if(l){if(l===f)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===p)throw r=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var c=u(t,n,i);if("normal"===c.type){if(r=i.done?y:d,c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r=y,i.method="throw",i.arg=c.arg)}}}function E(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var a=u(r,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,f;var o=a.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,f):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function L(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(Ne(t)+" is not iterable")}return g.prototype=b,r(S,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},P(M.prototype),c(M.prototype,s,(function(){return this})),t.AsyncIterator=M,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new M(h(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},P(S),c(S,l,"Generator"),c(S,o,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=L,z.prototype={constructor:z,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;A(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:L(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}function We(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function Ye(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){We(a,i,r,o,s,"next",e)}function s(e){We(a,i,r,o,s,"throw",e)}o(void 0)}))}}function Xe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,$e(i.key),i)}}function $e(e){var t=function(e){if("object"!=Ne(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ne(t)?t:t+""}var Qe=[{name:"shoot",path:"assets/sounds/shoot.mp3"},{name:"pickup",path:"assets/sounds/pickup.mp3"},{name:"damage",path:"assets/sounds/damage.mp3"},{name:"main_track_1",path:"assets/sounds/vibe_Jam.mp3"},{name:"main_track_2",path:"assets/sounds/Buzz_Revolution.mp3"}],Je=["main_track_1","main_track_2"],Ze=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.assetManager=new m(this),this.soundManager=new x,this.loadingScreen=new s(this),this.setupRenderer(),this.setupScene(),this.setupCamera(),this.fpsCounter=new D({updateInterval:50,samples:20}),this.ui=new A(this),this.gameState="loading",this.currentEnvironment="exterior",this.isPointerLockPending=!1,this.inCombat=!1,this.playerHealth=100,this.isMobile=!1,this.initializeGame(),this.setupEventListeners(),this.animate()},t=[{key:"initializeGame",value:(r=Ye(Ve().mark((function e(){var t,n=this;return Ve().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.assetManager.init((function(e){n.loadingScreen&&n.loadingScreen.updateProgress(e.progress);var t=document.getElementById("loading-progress");t&&(t.style.width="".concat(e.progress,"%"))}));case 3:return this.player=new H(this),this.collisionSystem=new Be(this),this.treeHive=new M(this),this.treeHive.treeGroup&&(this.treeHive.treeGroup.visible=!1),this.skybox=new Ue(this),this.skybox.skyboxMesh&&(this.skybox.skyboxMesh.visible=!1),this.scene.background=new i.Q1f(0),this.particlePool=new Ge({scene:this.scene}),this.combatArena=new ye(this),this.combatArena.arenaGroup.visible=!1,e.next=15,this.initializeHoneycombTextures();case 15:return(t=e.sent)&&this.combatArena.updateTexture&&this.combatArena.updateTexture(t),e.next=19,this.soundManager.loadSounds(Qe);case 19:this.soundManager.playMusic(Je),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),console.error("Error initializing game:",e.t0),this.loadingScreen;case 26:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(){return r.apply(this,arguments)})},{key:"setupRenderer",value:function(){this.renderer=new i.JeP({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight);var e=this.isMobile?1:1.5;this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,e)),this.isMobile&&(this.renderer.antialias=!1),document.body.appendChild(this.renderer.domElement)}},{key:"setupScene",value:function(){this.scene=new i.Z58}},{key:"setupCamera",value:function(){this.camera=new i.ubm(75,window.innerWidth/window.innerHeight,1,this.isMobile?5e3:1e4),this.camera.position.set(0,5,15),this.cameraTarget=new i.Pq0(0,0,0),this.camera.lookAt(this.cameraTarget)}},{key:"initializeHoneycombTextures",value:(n=Ye(Ve().mark((function e(){var t,n,i,r;return Ve().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.honeycombTextures){e.next=11;break}if("function"!=typeof this.honeycombTextures.checkTextureStatus){e.next=11;break}if(!(t=this.honeycombTextures.checkTextureStatus()).hasTexture||t.fallbackMode){e.next=10;break}if(!((n=this.honeycombTextures.getTexture())&&this.combatArena&&this.combatArena.updateTexture)){e.next=8;break}return e.abrupt("return",this.combatArena.updateTexture(n));case 8:e.next=11;break;case 10:console.log("⚠️ Existing texture not valid, reinitializing");case 11:return i=this.isMobile?512:1024,this.honeycombTextures=new Pe(i),e.prev=13,e.next=16,this.honeycombTextures.initialize();case 16:if(r=e.sent){e.next=19;break}return e.abrupt("return",!1);case 19:return this.honeycombTextures.startAnimation(),this.combatArena&&this.combatArena.updateTexture&&this.combatArena.updateTexture(r),e.abrupt("return",r);case 24:return e.prev=24,e.t0=e.catch(13),e.abrupt("return",null);case 27:case"end":return e.stop()}}),e,this,[[13,24]])}))),function(){return n.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var e=this;window.addEventListener("resize",(function(){return e.onWindowResize()})),window.addEventListener("keydown",(function(t){return e.handleKeyDown(t)})),window.addEventListener("keyup",(function(t){return e.handleKeyUp(t)})),document.addEventListener("mousemove",(function(t){return e.handleMouseMove(t)})),document.addEventListener("mousedown",(function(t){"playing"===e.gameState&&e.isPointerLocked&&"interior"===e.currentEnvironment&&e.inCombat&&e.playerShoot()})),document.addEventListener("mouseup",(function(){e.player.moveUp=!1})),this.renderer.domElement.addEventListener("click",(function(){"playing"!==e.gameState||e.isPointerLocked||e.lockPointer()})),document.addEventListener("pointerlockchange",(function(){return e.handlePointerLockChange()})),document.addEventListener("pointerlockerror",(function(){return console.error("Pointer lock error")})),this.setupTouchControls()}},{key:"setupTouchControls",value:function(){var e=this;this.mobileControls=document.createElement("div"),this.mobileControls.id="mobile-controls",this.mobileControls.style.cssText="\n      position: fixed;\n      bottom: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      display: none;\n      z-index: 1000;\n      pointer-events: none;\n    ";var t=Math.min(window.innerWidth,window.innerHeight),n=Math.max(80,Math.floor(.15*t)),i=Math.max(20,Math.floor(.05*t));this.moveStick=document.createElement("div"),this.moveStick.id="move-stick",this.moveStick.style.cssText="\n      position: fixed;\n      bottom: ".concat(i,"px;\n      left: ").concat(i,"px;\n      width: ").concat(n,"px;\n      height: ").concat(n,"px;\n      background: rgba(255, 255, 255, 0.3);\n      border-radius: 50%;\n      border: 2px solid rgba(255, 255, 255, 0.5);\n      pointer-events: auto;\n      touch-action: none;\n    "),this.shootButton=document.createElement("div"),this.shootButton.id="shoot-button",this.shootButton.style.cssText="\n      position: fixed;\n      bottom: ".concat(3*i,"px;\n      right: ").concat(3*i,"px;\n      width: ").concat(.8*n,"px;\n      height: ").concat(.8*n,"px;\n      background: rgba(255, 0, 0, 0.4);\n      border-radius: 50%;\n      border: 3px solid rgba(255, 100, 100, 0.7);\n      pointer-events: auto;\n      touch-action: none;\n      display: none;\n    "),this.lookArea=document.createElement("div"),this.lookArea.id="look-area",this.lookArea.style.cssText="\n      position: fixed;\n      top: 0;\n      right: 0;\n      width: 50%;\n      height: 100%;\n      z-index: 999;\n      pointer-events: auto;\n      touch-action: none;\n    ",this.mobileControls.appendChild(this.moveStick),this.mobileControls.appendChild(this.lookArea),this.mobileControls.appendChild(this.shootButton),document.body.appendChild(this.mobileControls),this.setupJoystick(this.moveStick),this.setupShootButton(),this.setupLookArea(),this.checkMobileDevice(),window.addEventListener("resize",(function(){return e.updateMobileControlSizes()}))}},{key:"setupJoystick",value:function(e){var t=this;if(e){var n=!1,i=null;(i=document.createElement("div")).style.cssText="\n      position: absolute;\n      width: 40%;\n      height: 40%;\n      background: rgba(255, 255, 255, 0.6);\n      border-radius: 50%;\n      top: 30%;\n      left: 30%;\n      pointer-events: none;\n    ",e.appendChild(i);var r=function(n,r){var a,o,s,l,c=(a={clientX:n,clientY:r},s=(o=e.getBoundingClientRect()).left+o.width/2,l=o.top+o.height/2,{x:a.clientX-s,y:a.clientY-l}),h=.3*e.clientWidth,u=Math.min(Math.hypot(c.x,c.y),h),p=Math.atan2(c.y,c.x);if(i){var d=Math.cos(p)*u/(e.clientWidth/2),m=Math.sin(p)*u/(e.clientHeight/2);i.style.transform="translate(".concat(100*d,"%, ").concat(100*m,"%)")}var y=Math.cos(p)*(u/h),f=Math.sin(p)*(u/h);t.player&&(t.player.moveLeft=y<-.2,t.player.moveRight=y>.2,t.player.moveUp=f<-.2,t.player.moveDown=f>.2)};e.addEventListener("touchstart",(function(e){e.preventDefault(),n=!0;var t=e.touches[0];r(t.clientX,t.clientY)})),e.addEventListener("touchmove",(function(e){if(n){e.preventDefault();var t=e.touches[0];r(t.clientX,t.clientY)}}));var a=function(){n=!1,i&&(i.style.transform="translate(0, 0)"),t.player&&(t.player.moveLeft=!1,t.player.moveRight=!1,t.player.moveUp=!1,t.player.moveDown=!1)};e.addEventListener("touchend",a),e.addEventListener("touchcancel",a)}}},{key:"setupLookArea",value:function(){var e=this,t=null;this.lookArea.addEventListener("touchstart",(function(e){e.preventDefault(),t=e.touches[0]})),this.lookArea.addEventListener("touchmove",(function(n){if(n.preventDefault(),t){var i=n.touches[0],r=i.clientX-t.clientX,a=i.clientY-t.clientY;e.player&&"function"==typeof e.player.handleMobileRotation&&e.player.handleMobileRotation(r,a),t=i}})),this.lookArea.addEventListener("touchend",(function(){t=null}))}},{key:"setupShootButton",value:function(){var e=this;this.shootButton.addEventListener("touchstart",(function(t){t.preventDefault(),e.inCombat&&e.playerShoot()}))}},{key:"checkMobileDevice",value:function(){this.isMobile="ontouchstart"in window||navigator.maxTouchPoints>0||window.innerWidth<1024;var e=this.isMobile;if(this.mobileControls.style.display=e?"block":"none",e){var t=window.innerWidth/window.innerHeight;this.camera.fov=t<1?75:65,this.camera.updateProjectionMatrix(),this.isPointerLocked=!1,document.exitPointerLock&&document.exitPointerLock(),this.inCombat&&this.shootButton&&(this.shootButton.style.display="block")}}},{key:"updateMobileControlSizes",value:function(){if(this.mobileControls&&"none"!==this.mobileControls.style.display){var e=Math.min(window.innerWidth,window.innerHeight),t=Math.max(80,Math.floor(.15*e)),n=Math.max(20,Math.floor(.05*e));this.moveStick&&(this.moveStick.style.width="".concat(t,"px"),this.moveStick.style.height="".concat(t,"px"),this.moveStick.style.bottom="".concat(n,"px"),this.moveStick.style.left="".concat(n,"px")),this.shootButton&&(this.shootButton.style.width="".concat(.8*t,"px"),this.shootButton.style.height="".concat(.8*t,"px"),this.shootButton.style.bottom="".concat(3*n,"px"),this.shootButton.style.right="".concat(3*n,"px"))}}},{key:"handleMobileRotation",value:function(e,t){this.rotateX-=.05*t,this.rotateY-=.05*e,this.rotateX=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.rotateX))}},{key:"lockPointer",value:function(){if(!this.isPointerLockPending&&!this.isPointerLocked)try{this.isPointerLockPending=!0,this.renderer.domElement.requestPointerLock=this.renderer.domElement.requestPointerLock||this.renderer.domElement.mozRequestPointerLock||this.renderer.domElement.webkitRequestPointerLock,this.renderer.domElement.requestPointerLock()}catch(e){console.log("Pointer lock request failed:",e),this.isPointerLockPending=!1}}},{key:"handlePointerLockChange",value:function(){this.isPointerLocked=document.pointerLockElement===this.renderer.domElement||document.mozPointerLockElement===this.renderer.domElement||document.webkitPointerLockElement===this.renderer.domElement,this.isPointerLockPending=!1,this.isPointerLocked||"playing"!==this.gameState?this.hideClickToPlayOverlay():this.showClickToPlayOverlay()}},{key:"showClickToPlayOverlay",value:function(){var e=this;this.clickToPlayOverlay?this.clickToPlayOverlay.style.display="flex":(this.clickToPlayOverlay=document.createElement("div"),this.clickToPlayOverlay.style.position="absolute",this.clickToPlayOverlay.style.top="0",this.clickToPlayOverlay.style.left="0",this.clickToPlayOverlay.style.width="100%",this.clickToPlayOverlay.style.height="100%",this.clickToPlayOverlay.style.display="flex",this.clickToPlayOverlay.style.alignItems="center",this.clickToPlayOverlay.style.justifyContent="center",this.clickToPlayOverlay.style.backgroundColor="rgba(0, 0, 0, 0.4)",this.clickToPlayOverlay.style.color="white",this.clickToPlayOverlay.style.fontSize="24px",this.clickToPlayOverlay.style.cursor="pointer",this.clickToPlayOverlay.style.zIndex="100",this.clickToPlayOverlay.innerHTML="Click to control bee",this.clickToPlayOverlay.addEventListener("click",(function(){e.lockPointer(),e.hideClickToPlayOverlay()})),document.body.appendChild(this.clickToPlayOverlay))}},{key:"hideClickToPlayOverlay",value:function(){this.clickToPlayOverlay&&(this.clickToPlayOverlay.style.display="none")}},{key:"handleMouseMove",value:function(e){if("playing"===this.gameState)if(this.isPointerLocked){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;this.lastMouseX=t,this.lastMouseY=n,this.player.handleMouseMove(t,n)}else{var i=window.innerWidth/2,r=window.innerHeight/2,a=.05*(e.clientX-i),o=.05*(e.clientY-r);this.player.handleMouseMove(a,o)}}},{key:"handleKeyDown",value:function(e){if("menu"!==this.gameState&&"gameover"!==this.gameState&&"victory"!==this.gameState)switch(e.code){case"KeyW":case"ArrowUp":this.player.moveUp=!0;break;case"KeyS":case"ArrowDown":this.player.moveDown=!0;break;case"KeyA":case"ArrowLeft":this.player.moveLeft=!0;break;case"KeyD":case"ArrowRight":this.player.moveRight=!0;break;case"Space":this.player.boost();break;case"KeyB":if(this.collisionSystem){var t=this.collisionSystem.toggleDebug();console.log("Collision debug visualization: ".concat(t?"ON":"OFF"))}break;case"Escape":"playing"!==this.gameState&&"paused"!==this.gameState||(this.escapeKeyPressed=!0,this.togglePause())}else"Space"!==e.code&&"Enter"!==e.code||this.startGame()}},{key:"handleKeyUp",value:function(e){switch(e.code){case"KeyW":case"ArrowUp":this.player.moveUp=!1;break;case"KeyS":case"ArrowDown":this.player.moveDown=!1;break;case"KeyA":case"ArrowLeft":this.player.moveLeft=!1;break;case"KeyD":case"ArrowRight":this.player.moveRight=!1}}},{key:"startGame",value:function(){this.soundManager&&this.soundManager.resumeContext(),this.resetGameElements(),this.gameState="playing",this.startTime=performance.now(),this.lastFrameTime=performance.now(),this.elapsedTime=0,this.ui.updateGameState(this.gameState),this.lockPointer(),this.switchEnvironment("exterior"),this.treeHive&&this.treeHive.treeGroup&&(this.treeHive.treeGroup.visible=!0),this.touchRotationArea&&(this.touchRotationArea.style.display="block")}},{key:"resetGameElements",value:function(){this.maze&&this.maze.reset(),this.combatArena&&this.combatArena.reset(),this.player&&this.player.reset(),this.collisionSystem&&(this.collisionSystem.reset(),this.collidersRegistered=!1,this.mazeCollidersRegistered=!1),this.playerHealth=100,this.inCombat=!1}},{key:"switchEnvironment",value:function(e){var t=this;if(this.currentEnvironment!==e)return this.player&&this.player.switchMovementProfile(e),"interior"===e?(this.currentEnvironment="interior",this.treeHive&&(this.treeHive.treeGroup.visible=!1,this.treeHive.backgroundPlane&&(this.treeHive.backgroundPlane.visible=!1)),this.skybox&&(this.skybox.currentZone="interior",this.skybox.interiorHive?(this.scene.background=this.skybox.interiorHive,this.scene.environment=null):this.scene.background=new i.Q1f(13016173)),this.renderer&&(this.renderer.autoClear=!0,this.renderer.sortObjects=!0),this.combatArena&&(this.combatArena.arenaGroup.visible=!0,setTimeout((function(){t.combatArena.initializeCombat(),t.inCombat=!0}),1e3)),void(this.player&&(this.player.position.set(0,50,30),this.player.velocity.set(0,0,0)))):void 0}},{key:"playerShoot",value:function(){if(this.inCombat&&"interior"===this.currentEnvironment){var e=this.player.position.clone(),t=new i.Pq0(0,0,-1).applyQuaternion(this.player.currentRotation),n=e.clone().add(t.clone().multiplyScalar(1.5));this.combatArena&&this.combatArena.bulletManager&&(this.combatArena.bulletManager.createBullet(n,t,!0),this.soundManager.playSound("shoot"))}}},{key:"handlePlayerHit",value:function(){if(this.playerHealth-=10,this.soundManager.playSound("damage"),this.particlePool&&this.player){var e=this.isMobile?8:15;this.particlePool.createEffect({type:"spark",position:this.player.position.clone(),count:e,spread:1,velocity:.3,maxLifetime:30,acceleration:new i.Pq0(0,0,0),onUpdate:function(e){e.material&&e.material.color.setRGB(1,.3,.3),e.material.opacity-=.05}})}this.playerHealth<=0&&this.endGame(!1)}},{key:"endGame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.gameState=e?"victory":"gameover",this.ui.updateGameState(this.gameState,this.elapsedTime),document.exitPointerLock&&document.exitPointerLock(),this.touchRotationArea&&(this.touchRotationArea.style.display="none")}},{key:"togglePause",value:function(){"playing"===this.gameState?this.gameState="paused":"paused"===this.gameState&&(this.gameState="playing"),this.ui.updateGameState(this.gameState)}},{key:"onWindowResize",value:function(){this.checkMobileDevice(),this.renderer.setSize(window.innerWidth,window.innerHeight);var e=this.isMobile?1:1.5;this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,e)),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.far=this.isMobile?5e3:1e4,this.camera.updateProjectionMatrix(),this.updateMobileControlSizes()}},{key:"createHoneyParticles",value:function(){var e=this.isMobile?.03:.1;if(!(Math.random()>e)&&this.particlePool){var t=this.isMobile?0:1;if(0===t)return;var n=new i.Pq0(6*(Math.random()-.5),6*(Math.random()-.5),15-5*Math.random());this.particlePool.createHoneyDrip(n,{count:t,velocity:.03,lifetime:100+Math.floor(50*Math.random())})}}},{key:"startCombat",value:function(){this.inCombat=!1,this.combatArena&&(this.combatArena.initializeCombat(),this.combatArena.arenaGroup.visible=!0,this.maze&&(this.maze.mazeGroup.visible=!1))}},{key:"checkEnvironmentCollisions",value:function(){"interior"===this.currentEnvironment&&this.inCombat&&this.combatArena&&this.collisionSystem&&this.collisionSystem.checkCollisions(this.player,this.player.radius)}},{key:"update",value:function(){if("playing"===this.gameState){var e=performance.now(),t=e-this.lastFrameTime;if(this.lastFrameTime=e,this.elapsedTime=(e-this.startTime)/1e3,this.player&&this.player.update(t),this.particlePool&&this.particlePool.update(),this.player&&this.player.position){var n=this.player.position.x,i=this.player.position.y,r=this.player.position.z,a=n*n+i*i+r*r;a<225&&"interior"!==this.currentEnvironment&&this.switchEnvironment("interior"),Math.sqrt(a)}"interior"===this.currentEnvironment&&(this.inCombat&&this.combatArena?this.combatArena.update(t):this.maze&&this.maze.update(t),this.skybox&&this.skybox.update(t)),this.checkEnvironmentCollisions(),this.treeHive&&this.treeHive.update()}}},{key:"animate",value:function(){var e=this;requestAnimationFrame((function(){return e.animate()}));var t=performance.now(),n=t-this.lastFrameTime;if(n>200)this.lastFrameTime=t;else{if(this.fpsCounter&&this.fpsCounter.update(),"menu"===this.gameState&&this.treeHive){if(this.treeHive.treeGroup.visible=!0,this.skybox&&this.skybox.skyboxMesh&&(this.skybox.skyboxMesh.visible=!1),this.treeHive.backgroundPlane){var i=this.camera.position.clone();this.treeHive.backgroundPlane.position.set(0,0,-500),this.treeHive.backgroundPlane.lookAt(i)}this.treeHive.backgroundTexture&&(this.treeHive.backgroundTexture.needsUpdate=!0)}"paused"!==this.gameState&&(this.update(n),"interior"===this.currentEnvironment&&this.renderer?this.renderer.sortObjects=!0:this.renderer&&(this.renderer.sortObjects=!1),this.renderer.render(this.scene,this.camera)),this.lastFrameTime=t}}}],t&&Xe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();const Ke=Ze}}]);