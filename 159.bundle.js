/*! For license information please see 159.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkbeehives_fun=self.webpackChunkbeehives_fun||[]).push([[159],{397:(e,t,n)=>{n.r(t),n.d(t,{BeeGame:()=>Xe,default:()=>$e});var i=n(437);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}var s=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.overlay=null,this.loadingProgress=null,this.menuButtons=[],this.isLoading=!0,this.isMenuActive=!1,this.createOverlay()},(t=[{key:"createOverlay",value:function(){var e=this,t=document.getElementById("loading-screen");t&&(t.style.display="none"),this.overlay=document.createElement("div"),this.overlay.id="vibejam-overlay",this.overlay.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: #000;\n        color: white;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        z-index: 2000;\n        font-family: Arial, sans-serif;\n      ";var n=document.createElement("h1");n.textContent="#vibeJam",n.style.cssText="\n        font-size: 48px;\n        color: #ffd700;\n        margin-bottom: 40px;\n        letter-spacing: 2px;\n        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);\n      ";var i=document.createElement("h2");i.textContent="The never ending Battle",i.style.cssText="\n        font-size: 12px;\n        color: #ffd700;\n        margin-bottom: 20px;\n      ";var o=document.createElement("div");o.className="loading-content",o.style.cssText="\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        transition: opacity 0.5s;\n      ";var r=document.createElement("p");r.textContent="Loading game...",r.style.cssText="\n        font-size: 18px;\n        margin-bottom: 10px;\n      ";var a=document.createElement("div");a.style.cssText="\n        width: 300px;\n        height: 10px;\n        background-color: #333;\n        border-radius: 5px;\n        margin: 20px 0;\n        overflow: hidden;\n      ",this.loadingProgress=document.createElement("div"),this.loadingProgress.style.cssText="\n        height: 100%;\n        width: 0%;\n        background-color: #ffd700;\n        transition: width 0.3s;\n      ",a.appendChild(this.loadingProgress),o.appendChild(r),o.appendChild(a);var s=document.createElement("div");s.className="menu-content",s.style.cssText="\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        opacity: 0;\n        transform: translateY(20px);\n        transition: opacity 0.5s, transform 0.5s;\n        pointer-events: none;\n      ";var l=document.createElement("p");l.textContent="play until you win",l.style.cssText="\n        font-size: 18px;\n        margin-bottom: 30px;\n        max-width: 600px;\n        text-align: center;\n      ",s.appendChild(l);var c=this.createButton("Start Game",(function(){e.game.startGame(),e.hideOverlay()}));s.appendChild(c),this.menuButtons.push(c);var h=this.createButton("Controls",(function(){e.game.ui&&"function"==typeof e.game.ui.toggleControlsHelp&&e.game.ui.toggleControlsHelp()}));s.appendChild(h),this.menuButtons.push(h);var u=document.createElement("div");u.style.cssText="\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        z-index: -1;\n      ";for(var m=0;m<20;m++){var p=document.createElement("div"),d=50+100*Math.random(),y=100*Math.random(),f=100*Math.random(),v=5*Math.random(),g=5+10*Math.random();p.style.cssText="\n          position: absolute;\n          width: ".concat(d,"px;\n          height: ").concat(d,"px;\n          left: ").concat(y,"vw;\n          top: ").concat(f,"vh;\n          background-color: rgba(255, 215, 0, 0.1);\n          clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);\n          animation: float").concat(m," ").concat(g,"s ease-in-out ").concat(v,"s infinite alternate;\n        ");var b=document.createElement("style");b.textContent="\n          @keyframes float".concat(m," {\n            0% { transform: translateY(0) rotate(0deg); opacity: 0.1; }\n            100% { transform: translateY(-").concat(20+30*Math.random(),"px) rotate(").concat(20*Math.random(),"deg); opacity: 0.2; }\n          }\n        "),document.head.appendChild(b),u.appendChild(p)}this.overlay.appendChild(u),this.overlay.appendChild(n),this.overlay.appendChild(i),this.overlay.appendChild(o),this.overlay.appendChild(s),document.body.appendChild(this.overlay),this.loadingContainer=o,this.menuContainer=s}},{key:"createButton",value:function(e,t){var n=document.createElement("button");return n.textContent=e,n.className="menu-button",n.style.cssText="\n        padding: 12px 24px;\n        margin: 10px 0;\n        font-size: 18px;\n        background-color: #ffc107;\n        color: #333;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n        transition: background-color 0.2s;\n        min-width: 180px;\n      ",n.addEventListener("mouseover",(function(){n.style.backgroundColor="#ffda44"})),n.addEventListener("mouseout",(function(){n.style.backgroundColor="#ffc107"})),n.addEventListener("click",t),n}},{key:"updateProgress",value:function(e){var t=this;this.loadingProgress&&(this.loadingProgress.style.width="".concat(e,"%")),e>=100&&this.isLoading&&(this.isLoading=!1,setTimeout((function(){return t.showMenu()}),500))}},{key:"showMenu",value:function(){this.isMenuActive||(this.isMenuActive=!0,this.loadingContainer&&(this.loadingContainer.style.opacity="0",this.loadingContainer.style.pointerEvents="none"),this.menuContainer&&(this.menuContainer.style.opacity="1",this.menuContainer.style.transform="translateY(0)",this.menuContainer.style.pointerEvents="auto"))}},{key:"hideOverlay",value:function(){var e=this;this.overlay&&(this.overlay.style.transition="opacity 0.5s",this.overlay.style.opacity="0",setTimeout((function(){e.overlay&&e.overlay.parentNode&&(e.overlay.parentNode.removeChild(e.overlay),e.overlay=null)}),500))}}])&&r(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),l=n(92);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,a,s=[],l=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function p(e){var t=function(e){if("object"!=c(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:t+""}var d=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.models={},this.textures={},this.sounds={},this.animations={},this.totalAssets=0,this.loadedAssets=0,this.loadingErrors=0,this.gltfLoader=new l.B,this.textureLoader=new i.Tap,this.audioLoader=new i.Am1,this.onProgressCallback=null,this.loadingQueue=[],this.isProcessingQueue=!1,this.assetPaths={models:{beePlayer:"assets/models/bee_player.glb",bee:"assets/models/bee.glb",ant:"assets/models/ant_enemy.glb",spider:"assets/models/bee.glb",Cybernetic_Wasp:"assets/models/Cybernetic_Wasp.glb"},textures:{spaceSkybox:"assets/textures/dark_forest_high.png"},sounds:{}}},t=[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.onProgressCallback=e,this.totalAssets=Object.keys(this.assetPaths.models).length+Object.keys(this.assetPaths.textures).length+Object.keys(this.assetPaths.sounds).length,this.loadedAssets=0,this.loadingErrors=0,this.queueModelLoads(),this.queueTextureLoads(),this.processQueue()}},{key:"queueModelLoads",value:function(){for(var e=this,t=this.assetPaths.models,n=function(){var t=h(o[i],2),n=t[0],r=t[1];e.loadingQueue.push((function(){return e.loadModel(n,r)}))},i=0,o=Object.entries(t);i<o.length;i++)n()}},{key:"queueTextureLoads",value:function(){for(var e=this,t=this.assetPaths.textures,n=function(){var t=h(o[i],2),n=t[0],r=t[1];e.loadingQueue.push((function(){return e.loadTexture(n,r)}))},i=0,o=Object.entries(t);i<o.length;i++)n()}},{key:"processQueue",value:function(){var e=this;return this.isProcessingQueue?Promise.resolve():(this.isProcessingQueue=!0,new Promise((function(t){var n=function(){if(0===e.loadingQueue.length)return e.isProcessingQueue=!1,void t();e.loadingQueue.shift()().catch((function(t){console.error("Error loading asset:",t),e.loadingErrors++,e.updateProgress()})).finally((function(){setTimeout(n,10)}))};n()})))}},{key:"loadModel",value:function(e,t){var n=this;return new Promise((function(i,o){n.gltfLoader.load(t,(function(t){n.models[e]={scene:t.scene,animations:t.animations},t.animations&&t.animations.length>0&&(n.animations[e]=t.animations),t.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),n.loadedAssets++,n.updateProgress(),i(t)}),(function(e){}),(function(t){console.error("Error loading model ".concat(e,":"),t),n.createFallbackModel(e),o(t)}))}))}},{key:"loadTexture",value:function(e,t){var n=this;return new Promise((function(o,r){n.textureLoader.load(t,(function(t){t.colorSpace=i.er$,e.includes("Skybox")&&(t.mapping=i.wfO),n.textures[e]=t,n.loadedAssets++,n.updateProgress(),o(t)}),void 0,(function(t){console.error("Error loading texture ".concat(e,":"),t),n.createFallbackTexture(e),r(t)}))}))}},{key:"createFallbackModel",value:function(e){var t,n;if("bee"===e){var o=new i.YJl;t=new i.Gu$(1,16,16),n=new i.tXL({color:16763904});var r=new i.eaF(t,n);r.scale.set(1,.8,1.2),o.add(r);var a=new i.tcD(.5,16),s=new i.tXL({color:16777215,transparent:!0,opacity:.4,side:i.$EB}),l=new i.eaF(a,s);l.position.set(-.5,.2,.5),l.rotation.z=Math.PI/6,l.rotation.y=Math.PI/8,l.scale.set(.5,.5,.5),l.name="leftWing",o.add(l);var c=new i.eaF(a,s);c.position.set(.5,.2,.5),c.rotation.z=-Math.PI/6,c.rotation.y=-Math.PI/8,c.scale.set(.5,.5,.5),c.name="rightWing",o.add(c),this.models[e]={scene:o,animations:[]}}else if("ant"===e){var h=new i.YJl;n=new i.tXL({color:16724736}),t=new i.Gu$(.5,16,16);var u=new i.eaF(t,n);u.position.set(0,0,.8),h.add(u),t=new i.Gu$(.4,16,16);var m=new i.eaF(t,n);m.position.set(0,0,0),h.add(m),t=new i.Gu$(.7,16,16);var p=new i.eaF(t,n);p.position.set(0,0,-.9),h.add(p),t=new i.Ho_(.05,.05,1,8);for(var d=0;d<6;d++){var y=new i.eaF(t,n),f=d%2==0?1:-1,v=Math.floor(d/2)-1;y.position.set(.5*f,0,.5*v),y.rotation.z=f*Math.PI/4,y.rotation.y=.3*v,h.add(y)}this.models[e]={scene:h,animations:[]}}else{t=new i.iNn(1,1,1),n=new i.qBx;var g=new i.eaF(t,n),b=new i.YJl;b.add(g),this.models[e]={scene:b,animations:[]}}this.loadedAssets++,this.updateProgress()}},{key:"createFallbackTexture",value:function(e){var t=document.createElement("canvas");t.width=512,t.height=512;var n=t.getContext("2d");if("honeycomb"===e){n.fillStyle="#FFCC66",n.fillRect(0,0,t.width,t.height),n.fillStyle="#FF8800";for(var o=0;o<t.height;o+=75)for(var r=0;r<t.width;r+=86.5){var a=Math.floor(o/75)%2*50*.865;n.beginPath();for(var s=0;s<6;s++){var l=Math.PI/3*s,c=r+a+50*Math.cos(l),h=o+50*Math.sin(l);0===s?n.moveTo(c,h):n.lineTo(c,h)}n.closePath(),n.fill()}}else if(e.includes("Skybox")){var u=n.createLinearGradient(0,0,0,t.height);if("forestSkybox"===e?(u.addColorStop(0,"#87CEEB"),u.addColorStop(1,"#E0F7FA")):(u.addColorStop(0,"#000000"),u.addColorStop(.5,"#0B3D91"),u.addColorStop(1,"#111111")),n.fillStyle=u,n.fillRect(0,0,t.width,t.height),"spaceSkybox"===e){n.fillStyle="#FFFFFF";for(var m=0;m<100;m++){var p=Math.random()*t.width,d=Math.random()*t.height,y=2*Math.random();n.beginPath(),n.arc(p,d,y,0,2*Math.PI),n.fill()}}}else for(var f=64,v=0;v<t.height;v+=f)for(var g=0;g<t.width;g+=f){var b=(g/f+v/f)%2==0;n.fillStyle=b?"#A5A5A5":"#FFFFFF",n.fillRect(g,v,f,f)}var w=new i.GOR(t);w.colorSpace=i.er$,e.includes("Skybox")&&(w.mapping=i.wfO),this.textures[e]=w,this.loadedAssets++,this.updateProgress()}},{key:"getModel",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.models[e]?t?this.models[e].scene.clone():this.models[e].scene:(console.warn("Model '".concat(e,"' not found in AssetManager")),null)}},{key:"getAnimations",value:function(e){return this.animations[e]||null}},{key:"getTexture",value:function(e){return this.textures[e]?this.textures[e]:null}},{key:"updateProgress",value:function(){var e=this.totalAssets>0?this.loadedAssets/this.totalAssets*100:100;this.onProgressCallback&&this.onProgressCallback({loaded:this.loadedAssets,total:this.totalAssets,progress:e,errors:this.loadingErrors})}},{key:"getProgress",value:function(){return{loaded:this.loadedAssets,total:this.totalAssets,progress:this.totalAssets>0?this.loadedAssets/this.totalAssets*100:100,errors:this.loadingErrors,isComplete:this.loadedAssets>=this.totalAssets}}},{key:"isLoaded",value:function(){return this.loadedAssets>=this.totalAssets}},{key:"handleVisibilityChange",value:function(){document.hidden}},{key:"dispose",value:function(){var e=this;Object.values(this.models).forEach((function(t){t.scene&&t.scene.traverse((function(t){t.isMesh&&(t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach((function(t){return e.disposeMaterial(t)})):e.disposeMaterial(t.material)))}))})),Object.values(this.textures).forEach((function(e){e&&"function"==typeof e.dispose&&e.dispose()})),this.models={},this.textures={},this.animations={},this.totalAssets=0,this.loadedAssets=0,this.loadingErrors=0}},{key:"disposeMaterial",value:function(e){e&&(Object.values(e).forEach((function(e){e&&e.isTexture&&e.dispose()})),e.dispose())}}],t&&m(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function f(){f=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,i){var r=t&&t.prototype instanceof b?t:b,a=Object.create(r.prototype),s=new z(i||[]);return o(a,"_invoke",{value:T(e,n,s)}),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var m="suspendedStart",p="suspendedYield",d="executing",v="completed",g={};function b(){}function w(){}function x(){}var k={};c(k,a,(function(){return this}));var S=Object.getPrototypeOf,P=S&&S(S(D([])));P&&P!==n&&i.call(P,a)&&(k=P);var M=x.prototype=b.prototype=Object.create(k);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(o,r,a,s){var l=u(e[o],e,r);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==y(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var r;o(this,"_invoke",{value:function(e,i){function o(){return new t((function(t,o){n(e,i,t,o)}))}return r=r?r.then(o,o):o()}})}function T(t,n,i){var o=m;return function(r,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===r)throw a;return{value:e,done:!0}}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var l=A(s,i);if(l){if(l===g)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===m)throw o=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=d;var c=u(t,n,i);if("normal"===c.type){if(o=i.done?v:p,c.arg===g)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(o=v,i.method="throw",i.arg=c.arg)}}}function A(t,n){var i=n.method,o=t.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var r=u(o,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;var a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function D(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,r=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(y(t)+" is not iterable")}return w.prototype=x,o(M,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=c(x,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c(e,l,"GeneratorFunction")),e.prototype=Object.create(M),e},t.awrap=function(e){return{__await:e}},C(E.prototype),c(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new E(h(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(M),c(M,l,"Generator"),c(M,a,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=D,z.prototype={constructor:z,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(i,o){return s.type="throw",s.arg=t,n.next=i,o&&(n.method="next",n.arg=e),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;B(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:D(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),g}},t}function v(e,t,n,i,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){v(r,i,o,a,s,"next",e)}function s(e){v(r,i,o,a,s,"throw",e)}a(void 0)}))}}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,w(i.key),i)}}function w(e){var t=function(e){if("object"!=y(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==y(t)?t:t+""}var x=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.buffers=new Map,this.currentMusicSource=null,this.isMuted=!1,this.volume=.2,this.masterGain=this.audioContext.createGain(),this.masterGain.gain.setValueAtTime(this.volume,this.audioContext.currentTime),this.masterGain.connect(this.audioContext.destination)}catch(e){this.audioContext=null}},t=[{key:"resumeContext",value:function(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().then((function(){})).catch((function(e){return console.error("Error resuming AudioContext:",e)}))}},{key:"loadSounds",value:(n=g(f().mark((function e(t){var n,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioContext){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t.map(function(){var e=g(f().mark((function e(t){var n,o,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t.path);case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("HTTP error! status: ".concat(n.status," for ").concat(t.path));case 6:return e.next=8,n.arrayBuffer();case 8:return o=e.sent,e.next=11,i.audioContext.decodeAudioData(o);case 11:r=e.sent,i.buffers.set(t.name,r),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),i.buffers.set(t.name,null);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}()),e.next=5,Promise.all(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"playSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!this.audioContext)return null;var i=this.buffers.get(e);if(!i)return null;var o=this.audioContext.createBufferSource();o.buffer=i,o.loop=t;var r=this.audioContext.createGain();return r.gain.setValueAtTime(n,this.audioContext.currentTime),o.connect(r),r.connect(this.masterGain),o.start(0),o}},{key:"stopMusic",value:function(){if(this.currentMusicSource){try{this.currentMusicSource.stop(),this.currentMusicSource.disconnect()}catch(e){}this.currentMusicSource=null}}},{key:"playMusic",value:function(e){if(this.audioContext&&e&&0!==e.length){this.stopMusic();var t=e[Math.floor(Math.random()*e.length)];this.currentMusicSource=this.playSound(t,!0),this.currentMusicSource?this.currentMusicSource.onended=function(){}:console.error("Failed to play music track: ".concat(t))}}},{key:"setVolume",value:function(e){this.audioContext&&this.masterGain&&(this.volume=Math.max(0,Math.min(1,e)),this.isMuted||this.masterGain.gain.setValueAtTime(this.volume,this.audioContext.currentTime))}},{key:"toggleMute",value:function(){return this.audioContext&&this.masterGain?(this.isMuted=!this.isMuted,this.isMuted?this.masterGain.gain.setValueAtTime(0,this.audioContext.currentTime):this.masterGain.gain.setValueAtTime(this.volume,this.audioContext.currentTime),this.isMuted):this.isMuted}},{key:"getMuteState",value:function(){return this.isMuted}},{key:"pauseAll",value:function(){this.audioContext&&"running"===this.audioContext.state&&this.audioContext.suspend().then((function(){})).catch((function(e){return console.error("Error suspending AudioContext:",e)}))}},{key:"resumeAll",value:function(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().then((function(){})).catch((function(e){return console.error("Error resuming AudioContext:",e)}))}}],t&&b(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,P(i.key),i)}}function P(e){var t=function(e){if("object"!=k(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==k(t)?t:t+""}var M=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scene=t.scene,this.treeGroup=new i.YJl,this.scene.add(this.treeGroup),this.createBackgroundPlane(),this.p5Instance=null,this.animationStarted=!1,this.transitionTriggered=!1,this.transitionProgress=0,this.autoTransitionEnabled=!0,this.initP5Animation()},(t=[{key:"createBackgroundPlane",value:function(){var e=new i.bdM(2e3,1e3);this.backgroundCanvas=document.createElement("canvas"),this.backgroundCanvas.width=1024,this.backgroundCanvas.height=512,this.backgroundTexture=new i.GOR(this.backgroundCanvas),this.backgroundTexture.minFilter=i.k6q;var t=new i.V9B({map:this.backgroundTexture,transparent:!0,side:i.$EB});this.backgroundPlane=new i.eaF(e,t),this.backgroundPlane.position.set(0,0,-500),this.treeGroup.add(this.backgroundPlane)}},{key:"initP5Animation",value:function(){var e=this,t=document.getElementById("tree-hive-container");if(t||((t=document.createElement("div")).id="tree-hive-container",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.opacity="0",t.style.pointerEvents="none",t.style.zIndex="-9999",document.body.appendChild(t)),"undefined"!=typeof p5)this.createP5Sketch(t);else{var n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js",n.onload=function(){e.createP5Sketch(t)},n.onerror=function(){console.warn("Failed to load p5.js, falling back to simple animation"),e.createFallbackAnimation()},document.head.appendChild(n)}}},{key:"createP5Sketch",value:function(e){var t=this;this.p5Instance=new p5((function(e){var n=t.backgroundCanvas,i=n.getContext("2d"),o=[],r=[],a=[],s={background:[255,248,220],honeycomb:[255,204,50],hiveOutline:[165,115,30],honeyDrop:[255,204,0],bee:[0,0,0]};e.setup=function(){e.noCanvas();for(var i=-2;i<n.height/60+2;i++)for(var s=-2;s<n.width/69.2+2;s++){var l=40*s*1.73+i%2*40*.865,c=40*i*1.5,h=.2+.8*Math.random();o.push({x:l,y:c,size:40*h,z:h,honey:Math.random()>.3,honeyLevel:.1+.7*Math.random(),pulse:Math.random()*Math.PI*2})}for(var u=0;u<10;u++)t.addHoneyDrop(r,n);for(var m=0;m<8;m++)a.push({x:Math.random()*n.width,y:Math.random()*n.height,size:5+5*Math.random(),speedX:2*(Math.random()-.5),speedY:2*(Math.random()-.5),wingPhase:Math.random()*Math.PI*2,wingSpeed:.2+.2*Math.random()});t.animationStarted=!0},e.draw=function(){if(t.animationStarted){i.fillStyle="rgb(".concat(s.background.join(","),")"),i.fillRect(0,0,n.width,n.height),i.fillStyle="rgb(".concat(s.hiveOutline.join(","),")"),i.beginPath(),i.ellipse(n.width/2,n.height+100,n.width/1.5,200,0,Math.PI,!1),i.fill();var l=n.width/2,c=n.height/2,h=i.createRadialGradient(l,c,40,l,c,160);h.addColorStop(0,"rgba(255, 204, 50, 0.6)"),h.addColorStop(1,"rgba(255, 204, 50, 0)"),i.fillStyle=h,i.beginPath(),i.arc(l,c,160,0,2*Math.PI),i.fill(),i.fillStyle="rgba(40, 26, 13, 0.8)",i.beginPath(),i.arc(l,c,80,0,2*Math.PI),i.fill(),t.drawHoneycomb(i,o,s,e),t.updateHoneyDrops(i,r,n,s),t.updateBees(i,a,n,s,e),t.transitionTriggered?t.updateTransitionEffect(i,l,c,80,n):t.autoTransitionEnabled&&"playing"===t.game.gameState&&(setTimeout((function(){"playing"===t.game.gameState&&t.triggerTransition()}),2e3),t.autoTransitionEnabled=!1),t.backgroundTexture.needsUpdate=!0}}}),e)}},{key:"drawHoneycomb",value:function(e,t,n,i){var o=i?i.millis()/1e3:performance.now()/1e3,r=function(t,n,i){e.beginPath();for(var o=0;o<6;o++){var r=Math.PI/3*o-Math.PI/6,a=t+i*Math.cos(r),s=n+i*Math.sin(r);0===o?e.moveTo(a,s):e.lineTo(a,s)}e.closePath()};t.forEach((function(t){var i=1+.05*Math.sin(.5*o+t.pulse),a=t.size*i;if(e.fillStyle="rgba(".concat(n.hiveOutline.join(","),", 0.8)"),r(t.x,t.y,1.05*a),e.fill(),e.fillStyle="rgba(".concat(n.honeycomb.join(","),", ").concat(.4+.6*t.z,")"),r(t.x,t.y,a),e.fill(),t.honey){var s=.95+.05*Math.sin(.8*o+.01*t.x+.01*t.y);e.fillStyle="rgba(".concat(n.honeyDrop.join(","),", 0.7)"),r(t.x,t.y,a*t.honeyLevel*s),e.fill();var l=t.x-.2*a,c=t.y-.2*a,h=.3*a;e.fillStyle="rgba(255, 255, 255, 0.4)",e.beginPath(),e.arc(l,c,h,0,2*Math.PI),e.fill()}}))}},{key:"addHoneyDrop",value:function(e,t){e.push({x:Math.random()*t.width,y:-20,size:5+10*Math.random(),speed:.5+1.5*Math.random(),lifetime:0,maxLifetime:100+100*Math.random()})}},{key:"updateHoneyDrops",value:function(e,t,n,i){for(var o=t.length-1;o>=0;o--){var r=t[o];r.y+=r.speed,r.lifetime++,e.fillStyle="rgba(".concat(i.honeyDrop.join(","),", 0.8)"),e.beginPath(),e.arc(r.x,r.y,r.size,0,2*Math.PI),e.fill(),e.fillStyle="rgba(".concat(i.honeyDrop.join(","),", 0.4)");for(var a=1;a<=5;a++){var s=r.y-2*a*r.speed,l=r.size*(1-.15*a);e.beginPath(),e.arc(r.x,s,l,0,2*Math.PI),e.fill()}(r.y>n.height+20||r.lifetime>r.maxLifetime)&&(t.splice(o,1),this.addHoneyDrop(t,n))}}},{key:"updateBees",value:function(e,t,n,i,o){var r=o?o.millis()/1e3:performance.now()/1e3;t.forEach((function(t){t.x+=t.speedX,t.y+=t.speedY,(t.x<0||t.x>n.width)&&(t.speedX*=-1),(t.y<0||t.y>n.height)&&(t.speedY*=-1),e.fillStyle="rgb(".concat(i.bee.join(","),")"),e.beginPath(),e.ellipse(t.x,t.y,t.size,1.5*t.size,Math.atan2(t.speedY,t.speedX),0,2*Math.PI),e.fill(),e.fillStyle="rgb(".concat(i.honeycomb.join(","),")"),e.beginPath(),e.ellipse(t.x-t.speedX*t.size*.2,t.y-t.speedY*t.size*.2,.8*t.size,.8*t.size,Math.atan2(t.speedY,t.speedX),0,2*Math.PI),e.fill();var o=.5*Math.sin(r*t.wingSpeed*10+t.wingPhase);e.fillStyle="rgba(255, 255, 255, 0.7)",e.save(),e.translate(t.x,t.y),e.rotate(Math.atan2(t.speedY,t.speedX)+Math.PI/2+o),e.beginPath(),e.ellipse(.8*-t.size,0,.5*t.size,t.size,0,0,2*Math.PI),e.fill(),e.restore(),e.save(),e.translate(t.x,t.y),e.rotate(Math.atan2(t.speedY,t.speedX)+Math.PI/2-o),e.beginPath(),e.ellipse(.8*t.size,0,.5*t.size,t.size,0,0,2*Math.PI),e.fill(),e.restore()}))}},{key:"updateTransitionEffect",value:function(e,t,n,i,o){this.transitionProgress+=.02,e.fillStyle="rgba(0, 0, 0, ".concat(.5*this.transitionProgress,")"),e.fillRect(0,0,o.width,o.height);var r=i*(1+10*this.transitionProgress);e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.fill();for(var a=0;a<5;a++){var s=Math.random()*Math.PI*2,l=.8*r*Math.random(),c=2+8*Math.random();e.fillStyle="rgba(255, 204, 0, 0.7)",e.beginPath(),e.arc(t+Math.cos(s)*l,n+Math.sin(s)*l,c,0,2*Math.PI),e.fill()}this.transitionProgress>=1&&this.completeTransition()}},{key:"createFallbackAnimation",value:function(){var e=this,t=this.backgroundCanvas.getContext("2d"),n=function(){e.animationStarted||(e.animationStarted=!0),t.fillStyle="#FFF8DC",t.fillRect(0,0,e.backgroundCanvas.width,e.backgroundCanvas.height);var i=e.backgroundCanvas.width/2,o=e.backgroundCanvas.height/2,r=t.createRadialGradient(i,o,40,i,o,160);r.addColorStop(0,"rgba(255, 204, 50, 0.6)"),r.addColorStop(1,"rgba(255, 204, 50, 0)"),t.fillStyle=r,t.beginPath(),t.arc(i,o,160,0,2*Math.PI),t.fill(),t.fillStyle="rgba(40, 26, 13, 0.8)",t.beginPath(),t.arc(i,o,80,0,2*Math.PI),t.fill(),e.backgroundTexture.needsUpdate=!0,e.transitionTriggered?e.updateTransitionEffect(t,i,o,80,e.backgroundCanvas):e.autoTransitionEnabled&&"playing"===e.game.gameState&&(setTimeout((function(){"playing"===e.game.gameState&&e.triggerTransition()}),2e3),e.autoTransitionEnabled=!1),e.animationStarted&&requestAnimationFrame(n)};n()}},{key:"triggerTransition",value:function(){this.transitionTriggered=!0,this.transitionProgress=0}},{key:"completeTransition",value:function(){this.game&&"function"==typeof this.game.switchEnvironment&&this.game.switchEnvironment("interior"),this.transitionTriggered=!1,this.transitionProgress=0}},{key:"update",value:function(){if(this.backgroundPlane&&this.game.camera){var e=this.game.camera.position.clone();if("exterior"===this.game.currentEnvironment){var t=new i.Pq0(0,0,-1).applyQuaternion(this.game.camera.quaternion),n=e.clone().add(t.multiplyScalar(500));this.backgroundPlane.position.copy(n),this.backgroundPlane.lookAt(e)}}}},{key:"checkEntranceCollision",value:function(e,t){return!1}}])&&S(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,T(i.key),i)}}function T(e){var t=function(e){if("object"!=C(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==C(t)?t:t+""}var A=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.createMenuScreen(),this.createGameOverScreen(),this.createVictoryScreen(),this.createControlsHelp(),this.createVolumeControl(),this.createPauseScreen(),this.updateGameState("menu")},t=[{key:"createMenuScreen",value:function(){var e=this;this.menuScreen=document.createElement("div"),this.menuScreen.style.position="absolute",this.menuScreen.style.top="0",this.menuScreen.style.left="0",this.menuScreen.style.width="100%",this.menuScreen.style.height="100%",this.menuScreen.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.menuScreen.style.display="flex",this.menuScreen.style.flexDirection="column",this.menuScreen.style.alignItems="center",this.menuScreen.style.justifyContent="center",this.menuScreen.style.color="white",this.menuScreen.style.fontFamily="Arial, sans-serif";var t=document.createElement("h1");t.textContent="Get the Queen",t.style.fontSize="48px",t.style.marginBottom="20px",t.style.color="#ffd700",this.menuScreen.appendChild(t);var n=document.createElement("h2");n.textContent="Fight Till You Die",n.style.fontSize="24px",n.style.marginBottom="40px",n.style.maxWidth="600px",n.style.textAlign="center",this.menuScreen.appendChild(n);var i=this.createButton("Start Game",(function(){return e.game.startGame()}));i.style.marginBottom="20px",this.menuScreen.appendChild(i),document.body.appendChild(this.menuScreen)}},{key:"createGameOverScreen",value:function(){var e=this;this.gameOverScreen=document.createElement("div"),this.gameOverScreen.style.position="absolute",this.gameOverScreen.style.top="0",this.gameOverScreen.style.left="0",this.gameOverScreen.style.width="100%",this.gameOverScreen.style.height="100%",this.gameOverScreen.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.gameOverScreen.style.display="none",this.gameOverScreen.style.flexDirection="column",this.gameOverScreen.style.alignItems="center",this.gameOverScreen.style.justifyContent="center",this.gameOverScreen.style.color="white",this.gameOverScreen.style.fontFamily="Arial, sans-serif";var t=document.createElement("h1");t.textContent="Game Over",t.style.fontSize="48px",t.style.marginBottom="20px",t.style.color="#ff4444",this.gameOverScreen.appendChild(t);var n=document.createElement("p");n.textContent="damnnn!!!",n.style.fontSize="24px",n.style.marginBottom="20px",this.gameOverScreen.appendChild(n),this.gameOverTimeDisplay=document.createElement("p"),this.gameOverTimeDisplay.style.fontSize="20px",this.gameOverTimeDisplay.style.marginBottom="30px",this.gameOverScreen.appendChild(this.gameOverTimeDisplay);var i=this.createButton("Try Again",(function(){return e.game.startGame()}));i.style.marginBottom="20px",this.gameOverScreen.appendChild(i),document.body.appendChild(this.gameOverScreen)}},{key:"createVictoryScreen",value:function(){var e=this;this.victoryScreen=document.createElement("div"),this.victoryScreen.style.position="absolute",this.victoryScreen.style.top="0",this.victoryScreen.style.left="0",this.victoryScreen.style.width="100%",this.victoryScreen.style.height="100%",this.victoryScreen.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.victoryScreen.style.display="none",this.victoryScreen.style.flexDirection="column",this.victoryScreen.style.alignItems="center",this.victoryScreen.style.justifyContent="center",this.victoryScreen.style.color="white",this.victoryScreen.style.fontFamily="Arial, sans-serif";var t=document.createElement("h1");t.textContent="Victory!",t.style.fontSize="48px",t.style.marginBottom="20px",t.style.color="#ffd700",this.victoryScreen.appendChild(t);var n=document.createElement("p");n.textContent="Congratulations, You Won",n.style.fontSize="24px",n.style.marginBottom="20px",this.victoryScreen.appendChild(n),this.victoryTimeDisplay=document.createElement("p"),this.victoryTimeDisplay.style.fontSize="20px",this.victoryTimeDisplay.style.marginBottom="30px",this.victoryScreen.appendChild(this.victoryTimeDisplay);var i=this.createButton("Play Again",(function(){return e.game.startGame()}));i.style.marginBottom="20px",this.victoryScreen.appendChild(i),document.body.appendChild(this.victoryScreen)}},{key:"createControlsHelp",value:function(){var e=this;this.controlsHelp&&document.body.removeChild(this.controlsHelp),this.controlsHelp=document.createElement("div"),this.controlsHelp.style.position="absolute",this.controlsHelp.style.top="50%",this.controlsHelp.style.left="50%",this.controlsHelp.style.transform="translate(-50%, -50%)",this.controlsHelp.style.width="400px",this.controlsHelp.style.padding="20px",this.controlsHelp.style.backgroundColor="rgba(0, 0, 0, 0.9)",this.controlsHelp.style.borderRadius="10px",this.controlsHelp.style.color="white",this.controlsHelp.style.fontFamily="Arial, sans-serif",this.controlsHelp.style.display="none",this.controlsHelp.style.zIndex="2000",this.controlsHelp.style.boxShadow="0 0 20px rgba(0,0,0,0.5)",this.controlsHelp.style.border="2px solid #ffc107";var t=document.createElement("h2");t.textContent="Controls",t.style.fontSize="24px",t.style.marginBottom="15px",t.style.textAlign="center",this.controlsHelp.appendChild(t);var n=document.createElement("ul");n.style.listStyleType="none",n.style.padding="0",n.style.marginBottom="20px",[{key:"W / Arrow Up",action:"move forward"},{key:"S / Arrow Down",action:"move backward"},{key:"A / Arrow Left",action:" move left"},{key:"D / Arrow Right",action:" move right"},{key:"Space",action:"Boost Speed (temporary)"},{key:"pause",action:"mobile sensitivity setting"},{key:"P",action:"Pause Game"}].forEach((function(e){var t=document.createElement("li");t.style.margin="10px 0";var i=document.createElement("span");i.textContent=e.key,i.style.display="inline-block",i.style.width="150px",i.style.backgroundColor="#333",i.style.padding="3px 8px",i.style.borderRadius="4px",i.style.marginRight="10px",i.style.textAlign="center";var o=document.createElement("span");o.textContent=e.action,t.appendChild(i),t.appendChild(o),n.appendChild(t)})),this.controlsHelp.appendChild(n);var i=this.createButton("Close",(function(){return e.toggleControlsHelp()}));i.style.margin="0 auto",i.style.display="block",this.controlsHelp.appendChild(i),document.body.appendChild(this.controlsHelp)}},{key:"createButton",value:function(e,t){var n=document.createElement("button");return n.textContent=e,n.style.padding="12px 24px",n.style.fontSize="18px",n.style.backgroundColor="#ffc107",n.style.color="#333",n.style.border="none",n.style.borderRadius="5px",n.style.cursor="pointer",n.style.textAlign="center",n.style.transition="background-color 0.2s",n.addEventListener("mouseover",(function(){n.style.backgroundColor="#ffda44"})),n.addEventListener("mouseout",(function(){n.style.backgroundColor="#ffc107"})),n.addEventListener("click",t),n}},{key:"createPauseScreen",value:function(){var e=this;this.pauseScreen&&document.body.removeChild(this.pauseScreen),this.pauseScreen=document.createElement("div"),this.pauseScreen.style.position="absolute",this.pauseScreen.style.top="0",this.pauseScreen.style.left="0",this.pauseScreen.style.width="100%",this.pauseScreen.style.height="100%",this.pauseScreen.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.pauseScreen.style.display="none",this.pauseScreen.style.flexDirection="column",this.pauseScreen.style.alignItems="center",this.pauseScreen.style.justifyContent="center",this.pauseScreen.style.color="white",this.pauseScreen.style.fontFamily="Arial, sans-serif",this.pauseScreen.style.zIndex="999";var t=document.createElement("h1");if(t.textContent="GAME PAUSED",t.style.fontSize="48px",t.style.marginBottom="40px",t.style.color="#ffd700",this.pauseScreen.appendChild(t),!this.checkIfMobile()){var n=document.createElement("div");n.id="pc-sensitivity-container",n.style.backgroundColor="rgba(0, 0, 0, 0.5)",n.style.padding="20px",n.style.borderRadius="10px",n.style.marginBottom="40px",n.style.minWidth="300px",n.style.textAlign="center";var i=document.createElement("div");i.textContent="Mouse Sensitivity",i.style.fontSize="24px",i.style.marginBottom="15px",n.appendChild(i);var o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center";var r=document.createElement("input");r.type="range",r.min="0.2",r.max="3.0",r.step="0.1",r.value=this.game.player?this.game.player.mouseSensitivity:"2.0",r.style.width="200px",r.style.height="25px",r.style.accentColor="#ffd700",r.addEventListener("input",(function(){var t=parseFloat(r.value);e.game.player&&(e.game.player.mouseSensitivity=t),a.textContent=t.toFixed(1)+"x"})),o.appendChild(r);var a=document.createElement("span");a.textContent=r.value+"x",a.style.marginLeft="15px",a.style.fontSize="20px",a.style.minWidth="50px",o.appendChild(a),n.appendChild(o),this.pauseScreen.appendChild(n)}document.body.appendChild(this.pauseScreen)}},{key:"checkIfMobile",value:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0||this.game&&this.game.isMobile||this.game&&this.game.mobileManager&&this.game.mobileManager.isMobile}},{key:"toggleControlsHelp",value:function(){"none"!==this.controlsHelp.style.display&&this.controlsHelp.style.display?this.controlsHelp.style.display="none":this.controlsHelp.style.display="block"}},{key:"updateGameState",value:function(e,t){switch(this.menuScreen.style.display="none",this.gameOverScreen.style.display="none",this.victoryScreen.style.display="none",this.pauseScreen.style.display="none",e){case"menu":this.menuScreen.style.display="flex";break;case"playing":break;case"paused":this.pauseScreen.style.display="flex";break;case"gameover":this.gameOverScreen.style.display="flex",t&&(this.gameOverTimeDisplay.textContent="Time: ".concat(this.formatTime(t)));break;case"victory":this.victoryScreen.style.display="flex",t&&(this.victoryTimeDisplay.textContent="You found the queen in: ".concat(this.formatTime(t)))}}},{key:"formatTime",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))}},{key:"createVolumeControl",value:function(){var e=this;if(this.volumeControlContainer=document.createElement("div"),this.volumeControlContainer.style.position="absolute",this.volumeControlContainer.style.top="10px",this.volumeControlContainer.style.left="10px",this.volumeControlContainer.style.display="flex",this.volumeControlContainer.style.alignItems="center",this.volumeControlContainer.style.backgroundColor="rgba(0, 0, 0, 0.5)",this.volumeControlContainer.style.padding="5px 8px",this.volumeControlContainer.style.borderRadius="4px",this.volumeControlContainer.style.zIndex="1001",this.volumeControlContainer.style.userSelect="none",this.volumeControlContainer.style.fontFamily="monospace",this.volumeControlContainer.style.fontSize="14px",this.volumeControlContainer.style.transition="opacity 0.3s",this.volumeControlContainer.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",this.volumeIcon=document.createElement("div"),this.volumeIcon.style.fontSize="18px",this.volumeIcon.style.cursor="pointer",this.volumeIcon.style.marginRight="8px",this.volumeIcon.style.width="18px",this.volumeIcon.style.textAlign="center",this.volumeIcon.textContent="🔊",this.volumeIcon.addEventListener("click",(function(){if(e.game.soundManager){var t=e.game.soundManager.toggleMute();e.updateVolumeIcon(t)}})),this.volumeControlContainer.appendChild(this.volumeIcon),this.volumeSlider=document.createElement("input"),this.volumeSlider.type="range",this.volumeSlider.min="0",this.volumeSlider.max="1",this.volumeSlider.step="0.05",this.volumeSlider.value=this.game.soundManager?this.game.soundManager.volume:"1",this.volumeSlider.style.width="60px",this.volumeSlider.style.height="4px",this.volumeSlider.style.cursor="pointer",this.volumeSlider.style.accentColor="#ffd700",this.volumeSlider.style.webkitAppearance="none",this.volumeSlider.style.outline="none",this.volumeSlider.style.background="rgba(255, 255, 255, 0.2)",this.volumeSlider.style.borderRadius="2px",this.volumeControlContainer.style.opacity="0.7",this.volumeControlContainer.addEventListener("mouseenter",(function(){e.volumeControlContainer.style.opacity="1"})),this.volumeControlContainer.addEventListener("mouseleave",(function(){e.volumeControlContainer.style.opacity="0.7"})),this.volumeSlider.addEventListener("input",(function(t){var n=parseFloat(t.target.value);e.game.soundManager&&(e.game.soundManager.setVolume(n),e.updateVolumeIcon(0===n||e.game.soundManager.getMuteState()))})),this.volumeControlContainer.appendChild(this.volumeSlider),document.body.appendChild(this.volumeControlContainer),this.game.soundManager){var t=this.game.soundManager.getMuteState()||"0"===this.volumeSlider.value;this.updateVolumeIcon(t)}setTimeout((function(){e.volumeControlContainer&&(e.volumeControlContainer.style.opacity="0.4")}),3e3)}},{key:"updateVolumeIcon",value:function(e){this.volumeIcon&&(this.volumeIcon.textContent=e?"🔇":"🔊")}},{key:"showNotification",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;this.notification||(this.notification=document.createElement("div"),this.notification.style.position="absolute",this.notification.style.top="100px",this.notification.style.left="50%",this.notification.style.transform="translateX(-50%)",this.notification.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.notification.style.color="#FFFFFF",this.notification.style.padding="10px 20px",this.notification.style.borderRadius="8px",this.notification.style.fontSize="18px",this.notification.style.fontWeight="bold",this.notification.style.textAlign="center",this.notification.style.zIndex="1000",this.notification.style.transition="opacity 0.3s ease-in-out",this.notification.style.opacity="0",document.body.appendChild(this.notification)),this.notificationTimeout&&clearTimeout(this.notificationTimeout),this.notification.textContent=e,this.notification.style.opacity="1",this.notificationTimeout=setTimeout((function(){t.notification.style.opacity="0"}),n)}}],t&&E(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function B(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,z(i.key),i)}}function z(e){var t=function(e){if("object"!=L(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==L(t)?t:t+""}var D=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.updateInterval=t.updateInterval||500,this.avgSamples=t.samples||20,this.frames=0,this.lastTime=performance.now(),this.fps=0,this.fpsHistory=[],this.lastUpdate=0,this.createDisplay(t)},t=[{key:"createDisplay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.top=e.top||"10px",this.container.style.right=e.right||"10px",this.container.style.backgroundColor=e.bgColor||"rgba(0, 0, 0, 0.5)",this.container.style.color=e.textColor||"#ffffff",this.container.style.padding="6px 10px",this.container.style.borderRadius="4px",this.container.style.fontFamily="monospace",this.container.style.fontSize="14px",this.container.style.zIndex="1000",this.container.style.userSelect="none",this.container.style.transition="background-color 0.3s",document.body.appendChild(this.container),this.container.textContent="FPS: --"}},{key:"update",value:function(){var e=performance.now();if(this.frames++,e-this.lastUpdate>=this.updateInterval){var t=e-this.lastTime,n=1e3*this.frames/t;this.fpsHistory.push(n),this.fpsHistory.length>this.avgSamples&&this.fpsHistory.shift(),this.fps=this.fpsHistory.reduce((function(e,t){return e+t}),0)/this.fpsHistory.length,this.container.textContent="FPS: ".concat(Math.round(this.fps)),this.fps<30?this.container.style.backgroundColor="rgba(255, 0, 0, 0.5)":this.fps<50?this.container.style.backgroundColor="rgba(255, 165, 0, 0.5)":this.container.style.backgroundColor="rgba(0, 128, 0, 0.5)",this.frames=0,this.lastTime=e,this.lastUpdate=e}}},{key:"toggle",value:function(){this.container.style.display="none"===this.container.style.display?"block":"none"}},{key:"show",value:function(){this.container.style.display="block"}},{key:"hide",value:function(){this.container.style.display="none"}},{key:"destroy",value:function(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}}],t&&B(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,j(i.key),i)}}function j(e){var t=function(e){if("object"!=F(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==F(t)?t:t+""}var I=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scene=t.scene,this.isMobile=t.isMobile||!1,this.position=new i.Pq0(0,0,0),this.velocity=new i.Pq0(0,0,0),this.direction=new i.Pq0(0,0,-1),this.accelerate=!1,this.brake=!1,this.moveUp=!1,this.moveDown=!1,this.movementProfiles={exterior:{maxSpeed:.3,moveSpeed:.2,acceleration:.005,deceleration:.01,damping:.98,boostFactor:1,boostDuration:1e3,cameraDistance:8,cameraHeight:3},interior:{maxSpeed:this.isMobile?4.5:3,moveSpeed:this.isMobile?.9:.6,acceleration:this.isMobile?1.2:.8,deceleration:.015,damping:.99,boostFactor:5,boostDuration:1500,cameraDistance:24,cameraHeight:12}},this.currentProfile=this.movementProfiles.exterior,this.speed=0,this.boostActive=!1,this.boostTime=0,this.boostCooldown=3e3,this.lastBoostTime=0,this.verticalSpeed=0,this.maxVerticalSpeed=.3,this.verticalAcceleration=.003,this.verticalDamping=.95,this.yaw=0,this.pitch=0,this.mouseSensitivity=2,this.maxPitchAngle=Math.PI/2.5,this.accelerateWithMouse=!1,this.verticalSpeed=0,this.maxVerticalSpeed=.3,this.verticalAcceleration=.003,this.verticalDamping=.95,this.radius=5.5,this.collisionRecoveryTime=0,this.cameraOffset=new i.Pq0(0,2,5),this.distanceScalingFactor=1,this.targetRotation=new i.PTz,this.currentRotation=new i.PTz,this.applyMovementProfile(),this.createBeeModel()},(t=[{key:"applyMovementProfile",value:function(){this.maxSpeed=this.currentProfile.maxSpeed,this.moveSpeed=this.currentProfile.moveSpeed,this.acceleration=this.currentProfile.acceleration,this.deceleration=this.currentProfile.deceleration,this.damping=this.currentProfile.damping,this.boostFactor=this.currentProfile.boostFactor,this.boostDuration=this.currentProfile.boostDuration}},{key:"switchMovementProfile",value:function(e){this.movementProfiles[e]&&(this.currentProfile=this.movementProfiles[e],this.applyMovementProfile())}},{key:"createBeeModel",value:function(){if(this.model=new i.YJl,this.game.assetManager){var e=this.game.assetManager.getModel("beePlayer");e?(this.model.add(e),e.rotation.y=Math.PI,this.model.scale.set(3,3,3)):this.createFallbackBeeModel()}else this.createFallbackBeeModel();this.scene.add(this.model),this.reset()}},{key:"createFallbackBeeModel",value:function(){var e=new i.Gu$(1,16,16),t=new i.tXL({color:16763904}),n=new i.eaF(e,t);n.scale.set(1,.8,1.2),this.model.add(n);var o=new i.iNn(1.1,.3,.7),r=new i.tXL({color:0}),a=new i.eaF(o,r);a.position.z=.2,this.model.add(a);var s=new i.eaF(o,r);s.position.z=-.2,this.model.add(s)}},{key:"update",value:function(){var e=performance.now();this.boostActive&&e-this.boostTime>this.boostDuration&&(this.boostActive=!1);var t=new i.Pq0(0,0,0),n=this.currentRotation,o=new i.Pq0(0,0,-1).applyQuaternion(n);o.normalize();var r=new i.Pq0(1,0,0).applyQuaternion(n);if(r.y=0,r.normalize(),this.accelerate&&t.add(o),this.brake&&t.sub(o),this.moveLeft&&t.sub(r),this.moveRight&&t.add(r),t.lengthSq()>0){t.normalize();var a=t.multiplyScalar(this.boostActive?this.maxSpeed*this.boostFactor:this.maxSpeed);this.velocity.lerp(a,.2)}else this.velocity.multiplyScalar(this.damping),this.velocity.length()<.01&&this.velocity.set(0,0,0);if(this.position.add(this.velocity),this.model.position.copy(this.position),this.model.quaternion.copy(this.currentRotation),this.moveLeft||this.moveRight){var s=Math.PI/12,l=(new i.PTz).setFromAxisAngle(new i.Pq0(0,0,1),(this.moveRight?-1:1)*s);this.model.quaternion.multiply(l)}this.updateRotation(),this.updateCamera(),this.velocity.lengthSq()>.01&&this.createTrailEffect(),this.boostActive&&this.enforceBoundaries()}},{key:"getCameraDirection",value:function(){var e=new i.Pq0(0,0,-1);return e.applyQuaternion(this.game.camera.quaternion),e.normalize()}},{key:"createTrailEffect",value:function(){if(this.game&&this.game.particlePool){var e=performance.now(),t=this.isMobile?.15:.3;if(!(Math.random()>t||this.velocity.lengthSq()<.01)){var n=this._getBackwardVector(),i=this._getTrailPosition(n),o=this.velocity.length(),r=this.boostActive;try{var a=this.isMobile?Math.max(1,Math.floor(o)):1+Math.floor(2*o);this.game.particlePool.createEffect({type:"honey",position:i,count:a,spread:.15,velocity:.02,maxLifetime:r?25:15,onUpdate:function(t){if(t.material){r?t.material.color.setRGB(1,.8,0):t.material.color.setRGB(.8,.8,.2);var n=.1*Math.sin(.01*e)+.9;t.scale.multiplyScalar(n),t.material.opacity-=.04}}})}catch(e){console.error("Error creating trail effect:",e)}}}}},{key:"_getBackwardVector",value:function(){return this._backwardVector||(this._backwardVector=new i.Pq0),this._backwardVector.set(0,0,1).applyQuaternion(this.currentRotation)}},{key:"_getTrailPosition",value:function(e){return this._trailPosition||(this._trailPosition=new i.Pq0),this._trailPosition.copy(this.position).addScaledVector(e,1.5)}},{key:"updateRotation",value:function(){this._yawQ||(this._yawQ=new i.PTz),this._pitchQ||(this._pitchQ=new i.PTz),this._yawQ.setFromAxisAngle(this._yAxis||(this._yAxis=new i.Pq0(0,1,0)),this.yaw),this._pitchQ.setFromAxisAngle(this._xAxis||(this._xAxis=new i.Pq0(1,0,0)),this.pitch),this.targetRotation.copy(this._yawQ).multiply(this._pitchQ),this.currentRotation.slerp(this.targetRotation,.15)}},{key:"handleBoundaryCollision",value:function(e){this.velocity.copy(e)}},{key:"handleMouseMove",value:function(e,t){var n=.002*this.mouseSensitivity;this.yaw-=e*n,this.pitch-=t*n,(this.yaw>2*Math.PI||this.yaw<0)&&(this.yaw=this.yaw%(2*Math.PI),this.yaw<0&&(this.yaw+=2*Math.PI));var i=.47*Math.PI;this.pitch>i?this.pitch=i:this.pitch<-i&&(this.pitch=-i)}},{key:"updateCamera",value:function(){var e=this.currentProfile.cameraDistance,t=this.currentProfile.cameraHeight;this._idealPosition||(this._idealPosition=new i.Pq0);var n=this._idealPosition;n.copy(this.position);var o=this._getBackwardVector();n.addScaledVector(o,e),n.y+=t;var r=300;this.game&&this.game.combatArena&&this.game.combatArena.environment&&(r=300*this.game.combatArena.environment.scale),n.y>r-5&&(n.y=r-5),n.y<10&&(n.y=10);var a=this.moveLeft||this.moveRight,s=a?.2*1.5:.2;this.game.camera.position.lerp(n,s),this._lookTarget||(this._lookTarget=new i.Pq0);var l=this._lookTarget.copy(this.position);if(a){var c=new i.Pq0(0,0,-1).applyQuaternion(this.currentRotation);l.addScaledVector(c,5)}this.game.camera.lookAt(l)}},{key:"boost",value:function(){var e=performance.now();!this.boostActive&&e-this.lastBoostTime>this.boostCooldown&&(this.boostActive=!0,this.boostTime=e,this.lastBoostTime=e,this.createBoostEffect())}},{key:"createBoostEffect",value:function(){if(this.game.particlePool){var e=this._getBackwardVector();this._boostPosition||(this._boostPosition=new i.Pq0);var t=this._boostPosition.copy(this.position).addScaledVector(e,.6),n=this.isMobile?10:20;this.game.particlePool.createEffect({type:"spark",position:t,count:n,spread:.3,velocity:.2,acceleration:new i.Pq0(0,0,0),maxLifetime:30,parent:this.model,onUpdate:function(t){t.position.addScaledVector(e,.1),t.material.opacity-=.05}})}}},{key:"reset",value:function(){this.position.set(0,300,50),this.velocity.set(0,0,0),this.direction.set(0,0,0),this.accelerate=!1,this.brake=!1,this.moveLeft=!1,this.moveRight=!1,this.boostActive=!1,this.lastBoostTime=0,this.yaw=0,this.pitch=0,this.currentRotation=new i.PTz,this.targetRotation=new i.PTz,this.model.position.copy(this.position),this.model.quaternion.copy(this.currentRotation),this.model.rotation.set(0,0,0),this.updateCamera()}},{key:"enforceBoundaries",value:function(){var e=300;this.game&&this.game.combatArena&&this.game.combatArena.environment&&(e=300*this.game.combatArena.environment.scale),this.position.y<0?(this.position.y=0,this.velocity.y=0):this.position.y>e&&(this.position.y=e,this.velocity.y=0)}}])&&O(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function G(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return q(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_(i.key),i)}}function _(e){var t=function(e){if("object"!=H(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=H(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==H(t)?t:t+""}var V=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.parent=n,this.config={playerCooldown:150,maxPlayerBullets:30,maxEnemyBullets:20,bulletSpeed:5,bulletLifetime:800,bulletPoolSize:100,impactParticleCount:6},this.activeBullets=[],this.lastPlayerShotTime=0,this.initBulletPool()},t=[{key:"initBulletPool",value:function(){this.bulletPool=[],this.bulletGeometries={player:new i.Gu$(.4,6,6),enemy:new i.Gu$(.4,6,6)},this.bulletMaterials={player:new i.V9B({color:65535,transparent:!0,opacity:.8}),enemy:new i.V9B({color:16711680,transparent:!0,opacity:.8})};for(var e=0;e<this.config.bulletPoolSize;e++){var t=new i.eaF(this.bulletGeometries.player,this.bulletMaterials.player);t.visible=!1,t.userData={active:!1,isPlayerBullet:!0,direction:new i.Pq0,lifetime:0},this.parent.add(t),this.bulletPool.push(t);var n=new i.eaF(this.bulletGeometries.enemy,this.bulletMaterials.enemy);n.visible=!1,n.userData={active:!1,isPlayerBullet:!1,direction:new i.Pq0,lifetime:0},this.parent.add(n),this.bulletPool.push(n)}this.bulletLights={player:[],enemy:[]};for(var o=0;o<3;o++){var r=new i.HiM(65535,.8,5);r.visible=!1,this.parent.add(r),this.bulletLights.player.push(r)}for(var a=0;a<3;a++){var s=new i.HiM(16711680,.8,5);s.visible=!1,this.parent.add(s),this.bulletLights.enemy.push(s)}this.impactPool={geometries:[new i.Gu$(.05,4,4),new i.Gu$(.04,4,4),new i.Gu$(.03,4,4)],materials:{player:new i.V9B({color:65535,transparent:!0,opacity:.8}),enemy:new i.V9B({color:16711680,transparent:!0,opacity:.8})}}}},{key:"getBulletFromPool",value:function(e){var t,n=0,i=0,o=G(this.activeBullets);try{for(o.s();!(t=o.n()).done;)t.value.userData.isPlayerBullet?n++:i++}catch(e){o.e(e)}finally{o.f()}if(e&&n>=this.config.maxPlayerBullets){var r,a=G(this.activeBullets);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.userData.isPlayerBullet)return s}}catch(e){a.e(e)}finally{a.f()}}else if(!e&&i>=this.config.maxEnemyBullets){var l,c=G(this.activeBullets);try{for(c.s();!(l=c.n()).done;){var h=l.value;if(!h.userData.isPlayerBullet)return h}}catch(e){c.e(e)}finally{c.f()}}var u,m=G(this.bulletPool);try{for(m.s();!(u=m.n()).done;){var p=u.value;if(!p.userData.active&&p.userData.isPlayerBullet===e)return p}}catch(e){m.e(e)}finally{m.f()}var d,y=G(this.bulletPool);try{for(y.s();!(d=y.n()).done;){var f=d.value;if(!f.userData.active)return f.material=e?this.bulletMaterials.player:this.bulletMaterials.enemy,f.userData.isPlayerBullet=e,f}}catch(e){y.e(e)}finally{y.f()}if(this.activeBullets.length>0){var v=this.activeBullets[0];return v.userData.isPlayerBullet!==e&&(v.material=e?this.bulletMaterials.player:this.bulletMaterials.enemy,v.userData.isPlayerBullet=e),v}return console.warn("Could not find bullet in pool"),null}},{key:"prewarmSystem",value:function(){for(var e=new i.Pq0(0,0,0),t=new i.Pq0(0,1,0),n=0;n<20;n++){var o=this.createBullet(e,t,!0);o&&this.recycleBullet(o)}for(var r=0;r<20;r++){var a=this.createBullet(e,t,!1);a&&this.recycleBullet(a)}}},{key:"createBullet",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){var o=performance.now();if(o-this.lastPlayerShotTime<this.config.playerCooldown)return null;this.lastPlayerShotTime=o}var r=this.getBulletFromPool(n);return r?(r.position.copy(e),r.userData.direction=(new i.Pq0).copy(t).normalize(),r.userData.lifetime=0,r.userData.active=!0,r.visible=!0,this.activeBullets.includes(r)||this.activeBullets.push(r),r):null}},{key:"recycleBullet",value:function(e){if(e){var t=this.activeBullets.indexOf(e);-1!==t&&this.activeBullets.splice(t,1),e.visible=!1,e.userData.active=!1,e.userData.lifetime=0}}},{key:"update",value:function(e,t){if(0!==this.activeBullets.length)for(var n=this.activeBullets.length-1;n>=0;n--){var i=this.activeBullets[n],o=i.userData.direction.clone().multiplyScalar(this.config.bulletSpeed);if(i.position.add(o),i.userData.lifetime++,i.userData.lifetime>this.config.bulletLifetime)this.recycleBullet(i);else{if(!i.userData.isPlayerBullet&&this.game.player&&i.position.distanceTo(this.game.player.position)<2){this.game.handlePlayerHit?this.game.handlePlayerHit():void 0!==this.game.playerHealth&&(this.game.playerHealth-=10,console.log("Player health reduced to:",this.game.playerHealth),this.game.playerHealth<=0&&this.game.endGame(!1)),this.recycleBullet(i);continue}(i.userData.isPlayerBullet&&t&&t.checkBulletEnemyCollisions(i)||e&&e(i.position,.2))&&this.recycleBullet(i)}}}},{key:"checkBulletEnemyCollisions",value:function(e){if(!e||!e.userData||!e.userData.isPlayerBullet)return!1;if(this.parent&&this.parent.enemyManager&&this.parent.enemyManager.bossEnemy){var t=this.parent.enemyManager.bossEnemy;if(e.position.distanceTo(t.position)<5){var n=e.userData.damage||25;return this.parent.enemyManager.handleEnemyHit(t,n),!0}}if(this.parent&&this.parent.enemyManager&&this.parent.enemyManager.enemies)for(var i=this.parent.enemyManager.enemies,o=0;o<i.length;o++){var r=i[o];if(r.active&&e.position.distanceTo(r.position)<2.5){var a=e.userData.damage||25;return this.parent.enemyManager.handleEnemyHit(r,a),!0}}return!1}},{key:"reset",value:function(){for(;this.activeBullets.length>0;)this.recycleBullet(this.activeBullets[0]);return this.bulletLights.player.forEach((function(e){return e.visible=!1})),this.bulletLights.enemy.forEach((function(e){return e.visible=!1})),this.lastPlayerShotTime=0,!0}}],t&&R(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Y(i.key),i)}}function Y(e){var t=function(e){if("object"!=U(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==U(t)?t:t+""}var Q=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"basic";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.currentState="patrol",this.targetPosition=new i.Pq0,this.movementVector=new i.Pq0,this.lastStateChange=performance.now(),this.lastDecision=performance.now(),this.decisionInterval=50,this.config={preferredDistance:150,decisionVariability:.3*Math.random(),maxSpeed:.5+1.5*Math.random(),acceleration:.5,turnRate:1.5,maxPitchAngle:Math.PI/3,flankingFactor:.6+.4*Math.random(),aggressiveness:.5+.5*Math.random(),evasiveness:.7*Math.random(),usesFormations:Math.random()>.8,usesAmbush:Math.random()>.7},"boss"===t&&this.configBossEnemy(),this.formationOffset=new i.Pq0(40*(Math.random()-.5),20*(Math.random()-.5),40*(Math.random()-.5))},t=[{key:"configBossEnemy",value:function(){this.config.maxSpeed*=1,this.config.preferredDistance*=.1,this.config.aggressiveness=5,this.config.evasiveness=.8,this.config.usesFormations=!1,this.decisionInterval=300}},{key:"update",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!t)return new i.Pq0;var a=performance.now();return a-this.lastDecision>this.decisionInterval&&(this.updateState(t,n,r),this.lastDecision=a),this.calculateMovement(e,t,n,o)}},{key:"updateState",value:function(e,t,n){var i=this.getDistanceToPlayer(e),o=performance.now()-this.lastStateChange;switch(this.currentState){case"patrol":i<1e3?this.changeState("attack"):o>3e3&&(this.setRandomPatrolPoint(e.position),this.lastStateChange=performance.now());break;case"attack":this.config.flankingFactor>.7&&Math.random()>.7?this.changeState("flank"):n&&Math.random()<this.config.evasiveness?this.changeState("evade"):i>1e3&&this.changeState("patrol");break;case"flank":o>3e3&&this.changeState("attack");break;case"evade":o>2e3&&this.changeState("attack");break;case"formation":i<60*this.config.aggressiveness?this.changeState("attack"):o>4e3&&(this.lastStateChange=performance.now())}this.config.usesFormations&&t.length>2&&"evade"!==this.currentState&&Math.random()>.6&&"formation"!==this.currentState&&this.changeState("formation")}},{key:"changeState",value:function(e){this.currentState=e,this.lastStateChange=performance.now()}},{key:"calculateMovement",value:function(e,t,n,o){var r=new i.Pq0;switch(this.currentState){case"patrol":r.copy(this.calculatePatrolMovement());break;case"attack":r.copy(this.calculateAttackMovement(t));break;case"flank":r.copy(this.calculateFlankMovement(t));break;case"evade":r.copy(this.calculateEvadeMovement(t));break;case"formation":r.copy(this.calculateFormationMovement(t,n))}var a=this.config.maxSpeed*("evade"===this.currentState?1.2:1);return r.normalize().multiplyScalar(a),this.movementVector.copy(r),r}},{key:"calculatePatrolMovement",value:function(){var e=performance.now(),t=new i.Pq0;if(this.targetPosition.lengthSq()>0){t.subVectors(this.targetPosition,this.currentPosition||new i.Pq0).normalize();var n=.2*Math.sin(.001*e);t.x+=n,t.y+=.1*Math.sin(.0015*e)}else this.setRandomPatrolPoint(),t.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize();return t}},{key:"calculateAttackMovement",value:function(e){var t=new i.Pq0,n=this.calculateLeadPosition(e);return t.subVectors(n,this.currentPosition||new i.Pq0),t.length()<this.config.preferredDistance*this.config.aggressiveness?t.negate().multiplyScalar(.5):t.normalize(),t}},{key:"calculateFlankMovement",value:function(e){var t=new i.Pq0;t.subVectors(e.position,this.currentPosition||new i.Pq0);var n=new i.Pq0(-t.z,0,t.x).normalize(),o=1.5*this.config.flankingFactor;return t.normalize(),t.add(n.multiplyScalar(o)),t}},{key:"calculateEvadeMovement",value:function(e){var t=new i.Pq0;return t.subVectors(this.currentPosition||new i.Pq0,e.position),t.x+=2*(Math.random()-.5),t.y+=2*(Math.random()-.5),t.z+=2*(Math.random()-.5),t.normalize()}},{key:"calculateFormationMovement",value:function(e,t){var n=new i.Pq0;n.subVectors(e.position,this.currentPosition||new i.Pq0);var o=n.length();o<120?n.negate().multiplyScalar(.5):o>170?n.normalize():n.set(0,0,0);var r=new i.Pq0(0,0,-1).applyQuaternion(e.quaternion||new i.PTz).normalize(),a=new i.Pq0(1,0,0).applyQuaternion(e.quaternion||new i.PTz),s=new i.Pq0(0,1,0);return n.add(a.clone().multiplyScalar(this.formationOffset.x).add(s.clone().multiplyScalar(this.formationOffset.y).add(r.clone().multiplyScalar(this.formationOffset.z)))),n.normalize()}},{key:"setCurrentPosition",value:function(e){this.currentPosition=e.clone()}},{key:"getMovementVector",value:function(){return this.movementVector}},{key:"calculateLeadPosition",value:function(e){var t=e.position.clone();if(e.velocity){var n=this.getDistanceToPlayer(e),i=Math.min(n/100,1.5);t.add(e.velocity.clone().multiplyScalar(i))}return t}},{key:"getDistanceToPlayer",value:function(e){if(!this.currentPosition)return 1e3;var t=e.position.x-this.currentPosition.x,n=e.position.y-this.currentPosition.y,i=e.position.z-this.currentPosition.z;return Math.sqrt(t*t+n*n+i*i)}},{key:"setRandomPatrolPoint",value:function(e){var t=e||new i.Pq0,n=100+1500*Math.random(),o=Math.random()*Math.PI*2,r=100*Math.random()-50;this.targetPosition.set(t.x+Math.cos(o)*n,t.y+r,t.z+Math.sin(o)*n)}},{key:"getRotationQuaternion",value:function(e){if(!e||0===e.lengthSq())return new i.PTz;var t=new i.kn4;t.lookAt(new i.Pq0(0,0,0),e,new i.Pq0(0,1,0));var n=new i.PTz;return n.setFromRotationMatrix(t),n}}],t&&N(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function W(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=new Q(e);return"hard"===t?(n.config.maxSpeed*=1.3,n.config.flankingFactor*=1.5,n.config.aggressiveness*=1.3,n.decisionInterval*=.7):"easy"===t&&(n.config.maxSpeed*=.8,n.config.flankingFactor*=.7,n.config.aggressiveness*=.7,n.decisionInterval*=1.5),n}function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,X(i.key),i)}}function X(e){var t=function(e){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(t)?t:t+""}var $=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.parent=n,this.enemies=[],this.enemiesDefeated=0,this.totalEnemies=100,this.lastSpawnTime=0,this.spawnInterval=4e3,this.maxEnemies=10,this.bossSpawned=!1,this.bossDefeated=!1,this.bossEnemy=null,this.maxBossHealth=2e4,this.canSpawnGroups=!1,this.groupSize=3,this.groupSpawnChance=.3,this.createGlobalEnemyLights(),this.initSpatialGrid(),this.enemyModels={basic:null,alternate:null,boss:null},this.preloadEnemyModels(),this.initHealthBars()},t=[{key:"preloadEnemyModels",value:function(){if(this.game.assetManager){var e=this.game.assetManager.getModel("bee",!0);e&&(e.scale.set(15,15,15),this.enemyModels.basic=e);var t=this.game.assetManager.getModel("Cybernetic_Wasp",!0);t&&(t.scale.set(12,12,12),this.enemyModels.alternate=t);var n=this.game.assetManager.getModel("ant",!0);n&&(n.scale.set(50,50,50),this.enemyModels.boss=n)}}},{key:"initHealthBars",value:function(){this.healthBarGeometry=new i.bdM(6,.8),this.healthBarBgMaterial=new i.V9B({color:3355443,transparent:!0,opacity:.7,depthTest:!1}),this.healthBarFillMaterial=new i.V9B({color:16724787,transparent:!0,opacity:.8,depthTest:!1}),this.healthBars={},this.healthBarConfig={showDuration:3e3,fadeTime:1e3,yOffset:5,maxAlpha:.8}}},{key:"updateEnemyHealthBar",value:function(e){var t=e.userData.customId,n=e.userData.health/100;if(!this.healthBars[t]){var o=new i.YJl,r=new i.eaF(this.healthBarGeometry,this.healthBarBgMaterial.clone()),a=new i.eaF(this.healthBarGeometry,this.healthBarFillMaterial.clone());a.position.z=.01,o.add(r),o.add(a),this.parent.add(o),this.healthBars[t]={group:o,background:r,fill:a,lastHitTime:performance.now(),visible:!0}}var s=this.healthBars[t];s.lastHitTime=performance.now(),s.visible=!0,s.background.material.opacity=this.healthBarConfig.maxAlpha,s.fill.material.opacity=this.healthBarConfig.maxAlpha,s.fill.scale.x=Math.max(.01,n),s.fill.position.x=3*(n-1),n>.6?s.fill.material.color.setRGB(.2,.8,.2):n>.3?s.fill.material.color.setRGB(.9,.9,.2):s.fill.material.color.setRGB(.9,.2,.2)}},{key:"updateHealthBars",value:function(){var e=this,t=performance.now(),n=this.game.camera;if(n){var i=function(i){var o=e.healthBars[i],r=e.enemies.find((function(e){return e.userData.customId===parseInt(i)}));if(!r)return o.group.parent&&o.group.parent.remove(o.group),delete e.healthBars[i],1;var a=t-o.lastHitTime;if(a>e.healthBarConfig.showDuration){var s=Math.min(1,(a-e.healthBarConfig.showDuration)/e.healthBarConfig.fadeTime),l=e.healthBarConfig.maxAlpha*(1-s);o.background.material.opacity=l,o.fill.material.opacity=l,s>=1&&(o.visible=!1)}o.visible&&(o.group.position.copy(r.position),o.group.position.y+=e.healthBarConfig.yOffset,o.group.lookAt(n.position))};for(var o in this.healthBars)i(o)}}},{key:"createGlobalEnemyLights",value:function(){var e=[[150,50,150],[-150,50,150],[150,50,-150],[-150,50,-150]];this.enemyLights=[];for(var t=0;t<e.length;t++){var n=new i.HiM(16733440,.8,200);n.position.set(e[t][0],e[t][1],e[t][2]),this.parent.add(n),this.enemyLights.push(n)}}},{key:"initSpatialGrid",value:function(){this.gridCellSize=500,this.gridSize=40,this.grid=[];for(var e=0;e<this.gridSize;e++){this.grid[e]=[];for(var t=0;t<this.gridSize;t++)this.grid[e][t]=[]}}},{key:"updateSpatialGrid",value:function(){for(var e=0;e<this.gridSize;e++)for(var t=0;t<this.gridSize;t++)this.grid[e][t]=[];for(var n=0;n<this.enemies.length;n++){var i=this.enemies[n],o=Math.floor(i.position.x/this.gridCellSize+this.gridSize/2),r=Math.floor(i.position.z/this.gridCellSize+this.gridSize/2);o>=0&&o<this.gridSize&&r>=0&&r<this.gridSize&&this.grid[o][r].push(i)}Math.random()}},{key:"spawnInitialEnemies",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;this.createEnemy();for(var n=1;n<t;n++)setTimeout((function(){e.createEnemy()}),500*n)}},{key:"createEnemy",value:function(){if(this.enemies.length>=this.maxEnemies)return null;var e=Date.now()+Math.floor(1e3*Math.random()),t=Math.random()*Math.PI*2,n=1e3*Math.random(),o=50+100*Math.random(),r=new i.Pq0(Math.cos(t)*n,o,Math.sin(t)*n),a=new i.YJl;return a.position.copy(r),a.userData.customId=e,a.userData={health:200,speed:this.enemyBaseSpeed||.5,velocity:new i.Pq0,targetDirection:new i.Pq0,rotationSpeed:.1,maxSpeed:1,acceleration:.5,currentSpeed:0,state:"patrolling",target:new i.Pq0,lastStateChange:performance.now(),lastAttackTime:0,attackCooldown:2e3+1e3*Math.random(),patrolRadius:80+100*Math.random(),originalPosition:r.clone()},a.aiController=W(Math.random()>.8?"aggressive":"basic"),this.addEnemyModel(a),this.parent.add(a),this.setNewPatrolTarget(a),this.enemies.push(a),a}},{key:"addEnemyModel",value:function(e){var t;t=Math.random()>.7&&this.enemyModels.alternate?this.enemyModels.alternate.clone():this.enemyModels.basic?this.enemyModels.basic.clone():this.createFallbackEnemyModel();var n=.9+.2*Math.random();return t.scale.multiplyScalar(n),t.rotation.y=Math.PI,e.add(t),e.model=t,t}},{key:"createFallbackEnemyModel",value:function(){var e=new i.YJl,t=new i.Gu$(1,16,16),n=new i.tXL({color:16720384,emissive:16711680,shininess:80}),o=new i.eaF(t,n);e.add(o);var r=new i.iNn(2,.2,.8),a=new i.tXL({color:16755200,emissive:16733440,shininess:80}),s=new i.eaF(r,a);s.position.set(-1.2,0,0),e.add(s);var l=new i.eaF(r,a);return l.position.set(1.2,0,0),e.add(l),e.scale.set(15,15,15),e}},{key:"spawnEnemyGroup",value:function(e){for(var t=this.getSpawnPosition(),n=0;n<e;n++){var o=n/e*Math.PI*2,r=new i.Pq0(20*Math.cos(o),n%2*10,20*Math.sin(o)),a=this.createEnemyAt(t.clone().add(r));a&&a.userData&&(a.userData.speed*=1.1)}}},{key:"createEnemyAt",value:function(e){if(this.enemies.length>=this.maxEnemies)return null;var t=Date.now()+Math.floor(1e3*Math.random()),n=new i.YJl;return n.position.copy(e),n.userData.customId=t,n.userData={health:this.enemyBaseHealth||100,speed:this.enemyBaseSpeed||.05+.05*Math.random(),velocity:new i.Pq0,state:"patrolling",target:new i.Pq0,lastStateChange:performance.now(),lastAttackTime:0,attackCooldown:2e3+1e3*Math.random(),patrolRadius:80+70*Math.random(),originalPosition:e.clone()},n.aiController=W(Math.random()>.8?"aggressive":"basic"),this.addEnemyModel(n),this.parent.add(n),this.setNewPatrolTarget(n),this.enemies.push(n),n}},{key:"getSpawnPosition",value:function(){var e=new i.Pq0,t=this.game.player?this.game.player.position:new i.Pq0,n=Math.random()*Math.PI*2,o=130+220*Math.random();return e.set(Math.cos(n)*o,t.y+80*Math.random()-40,Math.sin(n)*o),e}},{key:"setNewPatrolTarget",value:function(e){var t=Math.random()*Math.PI*2,n=Math.random()*e.userData.patrolRadius,i=e.userData.originalPosition;return e.userData.target.set(i.x+Math.cos(t)*n,i.y+(50*Math.random()-25),i.z+Math.sin(t)*n),e.userData.target}},{key:"spawnBoss",value:function(){if(!this.bossSpawned){this.bossSpawned=!0,this.bossBar=document.createElement("div"),this.bossBar.style.cssText="position:fixed;top:20px;left:20%;right:20%;height:20px;background:#333;border-radius:5px;z-index:100;";var e=document.createElement("div");e.textContent="BOSS",e.style.cssText="position:absolute;left:50%;transform:translateX(-50%);top:-18px;color:#ff0000;font-weight:bold;font-size:14px;text-shadow:0 0 3px black;",this.bossBar.appendChild(e),this.bossBarFill=document.createElement("div"),this.bossBarFill.style.cssText="width:100%;height:100%;background:red;border-radius:5px;transition:width 0.3s;",this.bossBar.appendChild(this.bossBarFill),document.body.appendChild(this.bossBar);var t=new i.Pq0(0,50,0),n=new i.YJl;if(n.position.copy(t),n.userData.customId=Date.now()+9999,n.userData={health:this.maxBossHealth,speed:.5,velocity:new i.Pq0,state:"attacking",lastAttackTime:0,rotationSpeed:1},n.aiController=W("boss","hard"),this.enemyModels.boss){var o=this.enemyModels.boss.clone();n.add(o),n.model=o}else if(this.game.assetManager){var r=this.game.assetManager.getModel("ant")||this.game.assetManager.getModel("bee");if(r)r.scale.set(50,50,50),n.add(r),n.model=r;else{var a=this.createFallbackEnemyModel();a.scale.set(3,3,3),n.add(a),n.model=a}}this.parent.add(n),this.bossEnemy=n}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16.667;if(this.bossEnemy){if(this.bossEnemy.aiController&&this.game.player){this.bossEnemy.aiController.setCurrentPosition(this.bossEnemy.position);var t=this.bossEnemy.aiController.update(e,this.game.player,this.enemies,[],!1);if(t){var n=this.bossEnemy.userData.speed;this.bossEnemy.position.add(t.clone().multiplyScalar(n))}}var o=performance.now(),r=this.bossEnemy.userData;if(o-r.lastAttackTime>(r.attackCooldown||1500)){var a=this.bossEnemy.position.distanceTo(this.game.player.position);if(a<350){var s=.8-a/500;s*=3,Math.random()<s&&(this.enemyShoot(this.bossEnemy),r.lastAttackTime=o)}}this.bossEnemy.model&&!this.bossEnemy.rotationFixed&&(this.bossEnemy.model.rotation.y=Math.PI,this.bossEnemy.rotationFixed=!0)}if(this.enemies&&0!==this.enemies.length){this.updateSpatialGrid();var l=performance.now();if(this.enemies.length<this.maxEnemies&&this.enemiesDefeated<this.totalEnemies&&l-this.lastSpawnTime>this.spawnInterval){if(Math.random()<.3){var c=2+Math.floor(2*Math.random());this.spawnEnemyGroup(c)}else this.createEnemy();this.lastSpawnTime=l}!this.bossSpawned&&this.enemiesDefeated>=10&&this.spawnBoss(),this.updateHealthBars();for(var h=this.enemies.length-1;h>=0;h--){var u=this.enemies[h],m=u.userData;if(m.velocity||(m.velocity=new i.Pq0,m.rotationSpeed=.1),this.game.player&&l-m.lastAttackTime>m.attackCooldown){var p=u.position.distanceTo(this.game.player.position),d=300,y=1;if("spider"===u.userData.modelType?(d=400,y=1.3):"bee"===u.userData.modelType&&(d=350,m.attackCooldown=Math.min(m.attackCooldown,1800)),p<d){var f=.7-p/500;f*=y,u.aiController&&u.aiController.config&&u.aiController.config.aggressiveness>.7&&(f*=1.5),Math.random()<f&&(this.enemyShoot(u),m.lastAttackTime=l)}}u.aiController.setCurrentPosition(u.position);var v=u.aiController.update(e,this.game.player,this.enemies,[],!1).clone().multiplyScalar(m.speed);if(m.velocity.lerp(v,.7),"stunned"===m.state&&m.velocity.multiplyScalar(.7),this.game.collisionSystem&&this.game.collidersRegistered&&this.game.collisionSystem.checkCollisions(u,10),u.position.add(m.velocity),m.velocity.lengthSq()>.01){var g=m.velocity.clone().normalize(),b=new i.PTz,w=new i.kn4;w.lookAt(new i.Pq0(0,0,0),g,new i.Pq0(0,1,0)),b.setFromRotationMatrix(w),u.quaternion.slerp(b,.6*m.rotationSpeed)}}}else this.spawnInitialEnemies(5)}},{key:"enemyShoot",value:function(e){if(this.game.combatArena&&this.game.player){var t=this.game.player.position.clone(),n=new i.Pq0(0,0,-1).applyQuaternion(e.quaternion),o=e.position.clone().add(n.clone().multiplyScalar(5));o.y+=2;var r=o.distanceTo(t)/30*.1;t.x+=(2*Math.random()-1)*r,t.y+=(2*Math.random()-1)*r,t.z+=(2*Math.random()-1)*r;var a=(new i.Pq0).subVectors(t,o).normalize();if(this.game.combatArena.bulletManager){var s=this.game.combatArena.bulletManager.createBullet(o,a,!1);if(s)try{s.material&&s.material.color&&"function"==typeof s.material.color.set&&(s.material.color.set(16724736),s.material.emissive&&"function"==typeof s.material.emissive.set&&s.material.emissive.set(11149824)),s.scale&&"function"==typeof s.scale.multiplyScalar&&s.scale.multiplyScalar(1.1)}catch(e){}this.game.soundManager&&this.game.soundManager.playSound("shoot")}}}},{key:"handleEnemyHit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;if(e)if(this.bossEnemy&&e===this.bossEnemy){if(e.userData.health-=t,this.game.soundManager&&this.game.soundManager.playSound("enemyHit",.7),this.bossBarFill){var n=Math.max(0,e.userData.health/this.maxBossHealth*100);this.bossBarFill.style.width=n+"%"}e.userData.health<=0&&(this.bossDefeated=!0,this.game.soundManager&&this.game.soundManager.playSound("enemyDefeat",1),e.parent&&e.parent.remove(e),"function"==typeof this.onEnemyDefeated&&this.onEnemyDefeated(1e3),this.game.endGame&&this.game.endGame(!0))}else e.userData.health-=t,this.game.soundManager&&this.game.soundManager.playSound("enemyHit",.5),this.updateEnemyHealthBar(e),e.userData.health<=0?(this.game.soundManager&&this.game.soundManager.playSound("enemyDefeat",.7),"function"==typeof this.onEnemyDefeated&&this.onEnemyDefeated(100),this.destroyEnemy(e)):(this.showEnemyHitEffect(e.position),e.userData.state="stunned",e.userData.lastStateChange=performance.now())}},{key:"showEnemyHitEffect",value:function(e){this.game&&this.game.particlePool&&this.game.particlePool.createEffect({type:"spark",position:e.clone(),count:15,spread:.8,velocity:.25,maxLifetime:30})}},{key:"destroyEnemy",value:function(e){var t=this.enemies.indexOf(e);-1!==t&&(this.game&&this.game.particlePool&&(this.game.particlePool.createExplosion(e.position.clone(),{count:10,spread:1.2,velocity:.25,lifetime:60}),this.game.particlePool.createEffect({type:"honey",position:e.position.clone(),count:12,spread:1,velocity:.2,maxLifetime:50})),this.enemies.splice(t,1),e.parent&&e.parent.remove(e),e.model&&this.disposeEnemyModel(e.model),this.enemiesDefeated++,this.checkVictoryCondition()&&this.game.endGame(!0))}},{key:"disposeEnemyModel",value:function(e){e&&e.traverse((function(e){e.isMesh&&(e.geometry,e.material)}))}},{key:"checkBulletEnemyCollisions",value:function(e){return!!(e&&e.userData&&e.userData.isPlayerBullet)&&(this.bossEnemy&&e.position.distanceTo(this.bossEnemy.position)<25?(this.showEnemyHitEffect(e.position.clone()),this.handleEnemyHit(this.bossEnemy),!0):!!this.checkGridCollisions(e)||this.checkDirectCollisions(e))}},{key:"checkGridCollisions",value:function(e){try{for(var t=Math.floor(e.position.x/this.gridCellSize+this.gridSize/2),n=Math.floor(e.position.z/this.gridCellSize+this.gridSize/2),i=Math.max(0,t-1);i<=Math.min(this.gridSize-1,t+1);i++)for(var o=Math.max(0,n-1);o<=Math.min(this.gridSize-1,n+1);o++)if(this.grid[i]&&this.grid[i][o])for(var r=this.grid[i][o],a=0;a<r.length;a++){var s=r[a];if(s&&e.position.distanceTo(s.position)<25)return this.showEnemyHitEffect(e.position.clone()),this.handleEnemyHit(s),!0}return!1}catch(e){return!1}}},{key:"checkDirectCollisions",value:function(e){for(var t=0;t<this.enemies.length;t++){var n=this.enemies[t];if(n&&e.position.distanceTo(n.position)<25)return this.showEnemyHitEffect(e.position.clone()),this.handleEnemyHit(n),!0}return!1}},{key:"checkVictoryCondition",value:function(){return!!this.bossDefeated||!this.bossSpawned&&this.enemiesDefeated>=this.totalEnemies&&(this.spawnBoss(),!1)}},{key:"reset",value:function(){for(;this.enemies.length>0;){var e=this.enemies[0];e.parent&&e.parent.remove(e),this.enemies.shift()}return this.bossEnemy&&this.bossEnemy.parent&&(this.bossEnemy.parent.remove(this.bossEnemy),this.bossEnemy=null),this.bossBar&&this.bossBar.parentNode&&(this.bossBar.parentNode.removeChild(this.bossBar),this.bossBar=null,this.bossBarFill=null),this.enemiesDefeated=0,this.lastSpawnTime=0,this.bossSpawned=!1,this.bossDefeated=!1,this.enemiesDefeated=0,this.killCount=0,this.lastSpawnTime=0,this.bossSpawned=!1,this.bossDefeated=!1,!0}}],t&&J(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ne(i.key),i)}}function ne(e){var t=function(e){if("object"!=Z(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Z(t)?t:t+""}var ie=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.arenaGroup=n,this.powerUps=[],this.types=["health","speed","weapon"],this.spawnInterval=15e3,this.lastSpawnTime=0,this.maxPowerUps=5,this.initGeometryAndMaterials()},t=[{key:"initGeometryAndMaterials",value:function(){this.geometry=new i.Ufg(20,0),this.materials={health:new i.tXL({color:16711680,emissive:3342336,shininess:50,transparent:!0,opacity:.8}),speed:new i.tXL({color:65535,emissive:13107,shininess:50,transparent:!0,opacity:.8}),weapon:new i.tXL({color:16755200,emissive:3351040,shininess:50,transparent:!0,opacity:.8})}}},{key:"spawnPowerUp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.powerUps.length>=this.maxPowerUps&&this.removePowerUp(this.powerUps[0]);var t=e||this.types[Math.floor(Math.random()*this.types.length)],n=new i.eaF(this.geometry,this.materials[t]),o=this.getSpawnPosition();n.position.copy(o),this.arenaGroup.add(n);var r=new i.HiM(this.materials[t].color,1,150);r.position.copy(o),n.add(r);var a={mesh:n,type:t,effect:this.getEffectForType(t),createdAt:performance.now()};return this.powerUps.push(a),this.lastSpawnTime=performance.now(),a}},{key:"getSpawnPosition",value:function(){var e=new i.Pq0,t=this.game.player?this.game.player.position:new i.Pq0,n=0;do{var o=Math.random()*Math.PI*2,r=100+700*Math.random(),a=100+300*Math.random();e.set(Math.cos(o)*r,a,Math.sin(o)*r),n++}while(e.distanceTo(t)<100&&n<10);return e}},{key:"getEffectForType",value:function(e){var t=this;switch(e){case"health":return function(e){void 0!==t.game.playerHealth&&(t.game.playerHealth=Math.min(100,t.game.playerHealth+25),t.showEffectText("+".concat(25," Health"),16711680))};case"speed":return function(e){if(e){var n=e.maxSpeed||2;e.maxSpeed=1.5*n,t.showEffectText("Speed Boost!",65535),setTimeout((function(){e.maxSpeed=n}),2e4)}};case"weapon":return function(e){if(t.game.weaponPowerUpActive=!0,t.showEffectText("Multi-Shot Weapon!",16755200),t.game.particlePool&&t.game.player){var n=function(){t.game.particlePool.createEffect({type:"spark",position:t.game.player.position.clone(),count:5,spread:2,velocity:.1,maxLifetime:30,onUpdate:function(e){e.material&&e.material.color.setRGB(1,.6,0),e.material.opacity-=.04}})};n();var i=setInterval(n,1e3);setTimeout((function(){clearInterval(i),t.game.weaponPowerUpActive=!1}),15e3)}};default:return function(){}}}},{key:"showEffectText",value:function(e,t){if(document&&document.body){var n=document.createElement("div");n.textContent=e,n.style.position="absolute",n.style.color="#"+new i.Q1f(t).getHexString(),n.style.fontSize="24px",n.style.fontWeight="bold",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.textShadow="0 0 5px black",n.style.pointerEvents="none",n.style.zIndex="1000",n.style.transition="all 1s ease-out",document.body.appendChild(n),setTimeout((function(){n.style.opacity="0",n.style.transform="translate(-50%, -150%)",setTimeout((function(){n.parentNode&&document.body.removeChild(n)}),1e3)}),50)}}},{key:"checkCollisions",value:function(e,t){if(e&&0!==this.powerUps.length)for(var n=this.powerUps.length-1;n>=0;n--){var i=this.powerUps[n];i.mesh&&e.distanceTo(i.mesh.position)<t+40&&(this.game.soundManager&&this.game.soundManager.playSound("pickup"),i.effect&&this.game.player&&i.effect(this.game.player),this.removePowerUp(i))}}},{key:"removePowerUp",value:function(e){var t=this.powerUps.indexOf(e);-1!==t&&(this.powerUps.splice(t,1),e.mesh&&e.mesh.parent&&e.mesh.parent.remove(e.mesh))}},{key:"update",value:function(){var e=performance.now();e-this.lastSpawnTime>this.spawnInterval&&this.powerUps.length<this.maxPowerUps&&this.spawnPowerUp();var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ee(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}(this.powerUps);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.mesh&&(i.mesh.rotation.y+=.02,i.mesh.rotation.x+=.01,i.mesh.position.y+=.05*Math.sin(.001*e))}}catch(e){n.e(e)}finally{n.f()}this.game.player&&this.game.player.position&&this.checkCollisions(this.game.player.position,this.game.player.radius||2)}},{key:"reset",value:function(){for(;this.powerUps.length>0;)this.removePowerUp(this.powerUps[0]);return this.lastSpawnTime=0,!0}}],t&&te(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,a,s=[],l=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ae(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ae(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function se(){se=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,i){var r=t&&t.prototype instanceof v?t:v,a=Object.create(r.prototype),s=new L(i||[]);return o(a,"_invoke",{value:C(e,n,s)}),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var m="suspendedStart",p="suspendedYield",d="executing",y="completed",f={};function v(){}function g(){}function b(){}var w={};c(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(B([])));k&&k!==n&&i.call(k,a)&&(w=k);var S=b.prototype=v.prototype=Object.create(w);function P(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){function n(o,r,a,s){var l=u(e[o],e,r);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==oe(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var r;o(this,"_invoke",{value:function(e,i){function o(){return new t((function(t,o){n(e,i,t,o)}))}return r=r?r.then(o,o):o()}})}function C(t,n,i){var o=m;return function(r,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===r)throw a;return{value:e,done:!0}}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var l=E(s,i);if(l){if(l===f)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===m)throw o=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=d;var c=u(t,n,i);if("normal"===c.type){if(o=i.done?y:p,c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(o=y,i.method="throw",i.arg=c.arg)}}}function E(t,n){var i=n.method,o=t.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var r=u(o,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,f;var a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,f):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function B(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,r=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(oe(t)+" is not iterable")}return g.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},P(M.prototype),c(M.prototype,s,(function(){return this})),t.AsyncIterator=M,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new M(h(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(S),c(S,l,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=B,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(i,o){return s.type="throw",s.arg=t,n.next=i,o&&(n.method="next",n.arg=e),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;A(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:B(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}function le(e,t,n,i,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}function ce(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){le(r,i,o,a,s,"next",e)}function s(e){le(r,i,o,a,s,"throw",e)}a(void 0)}))}}function he(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ue(i.key),i)}}function ue(e){var t=function(e){if("object"!=oe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==oe(t)?t:t+""}var me=function(){return e=function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.parent=n,this.scale=o,this.environmentGroup=new i.YJl,this.parent.add(this.environmentGroup),this.textures={honeycomb:null,honey:null,cells:null},this.hiveElements={honeycombs:null,honeyDrops:null,waxStructures:null},this.particleSystems={},this.energyBeams=[],this.vibeElements=[],this.createEnvironment()},t=[{key:"createEnvironment",value:(o=ce(se().mark((function e(){return se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTextures();case 2:this.createCylindricalArena(),this.createHiveElements(),this.createHoneyParticles(),this.createVibeElements(),this.createEnergyBeams(),this.createSunlight();case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"loadTextures",value:(n=ce(se().mark((function e(){var t,n;return se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.game.honeycombTextures||this.game.textureGenerator||this.game.honeycombTextureGenerator){e.next=3;break}return e.abrupt("return");case 3:if(e.prev=3,"function"!=typeof t.getTexture){e.next=17;break}return e.next=7,t.getTexture("honeycomb");case 7:return this.textures.honeycomb=e.sent,e.next=10,t.getTexture("honey");case 10:return this.textures.honey=e.sent,e.next=13,t.getTexture("cells");case 13:this.textures.cells=e.sent,console.log("Successfully loaded textures during initialization"),e.next=25;break;case 17:if("function"!=typeof t.initialize){e.next=24;break}return e.next=20,t.initialize();case 20:n=e.sent,this.textures.honeycomb=n,e.next=25;break;case 24:t.textures&&(t.textures.honeycomb&&(this.textures.honeycomb=t.textures.honeycomb),t.textures.honey&&(this.textures.honey=t.textures.honey),t.textures.cells&&(this.textures.cells=t.textures.cells));case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),console.log("Note: Initial texture loading deferred - will be applied when available");case 30:case"end":return e.stop()}}),e,this,[[3,27]])}))),function(){return n.apply(this,arguments)})},{key:"createCylindricalArena",value:function(){var e=400*this.scale,t=300*this.scale,n=new i.Ho_(e,e,t,32,1,!0),o=new i.uSd({color:8965375,metalness:.2,roughness:.05,transparent:!0,opacity:.3,side:i.$EB,transmission:.95,reflectivity:.2,clearcoat:.3});this.wallMaterial=o;var r=new i.eaF(n,o);r.position.set(0,t/2,0),r.name="walls",this.environmentGroup.add(r),this.createPulsingFloor(e,32);var a=new i.tcD(e,32),s=new i._4j({map:this.textures.honeycomb||null,color:65501,side:i.$EB,roughness:.8,metalness:.2});this.ceilingMaterial=s;var l=new i.eaF(a,s);l.rotation.x=Math.PI/2,l.position.set(0,t,0),l.name="ceiling",this.environmentGroup.add(l)}},{key:"createPulsingFloor",value:function(e,t){var n=new i.tcD(e,t),o=new i.BKk({uniforms:{time:{value:0},baseColor:{value:new i.Q1f(56780)},glowColor:{value:new i.Q1f(16763904)},hexScale:{value:20},pulseSpeed:{value:.5}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:'\n        uniform float time;\n        uniform vec3 baseColor;\n        uniform vec3 glowColor;\n        uniform float hexScale;\n        uniform float pulseSpeed;\n        varying vec2 vUv;\n        \n        // Hex pattern from distance function\n        float hexDist(vec2 p) {\n          p = abs(p);\n          return max(p.x, p.y * 0.866025 + p.x * 0.5);\n        }\n        \n        vec4 hexagon(vec2 p) {\n          vec2 q = vec2(\n            p.x * 2.0 * 0.5773503, \n            p.y + p.x * 0.5773503\n          );\n          \n          vec2 pi = floor(q);\n          vec2 pf = fract(q);\n          \n          float v = mod(pi.x + pi.y, 3.0);\n          \n          float ca = step(1.0, v);\n          float cb = step(2.0, v);\n          vec2 ma = step(pf.xy, pf.yx);\n          \n          // Distance to hex edge\n          float e = dot(ma, 1.0 - pf.yx);\n          \n          // Get final hex shape\n          float dist = hexDist(mod(pf, 1.0) - 0.5);\n          float value = smoothstep(0.45, 0.5, dist);\n          \n          // Add pulsing glow\n          float pulse = sin(time * pulseSpeed + pi.x * 0.3 + pi.y * 0.5) * 0.5 + 0.5;\n          float glow = smoothstep(0.5, 0.45, dist) * pulse;\n          \n          // Vibe pattern - highlight some hexes as "V I B E"\n          float vibe = 0.0;\n          if (mod(pi.x + pi.y * 3.0, 23.0) < 4.0) {\n            vibe = 0.8;\n          }\n          \n          return vec4(value, glow, e, vibe);\n        }\n        \n        void main() {\n          // Scale UV to create hex grid\n          vec2 scaledUv = vUv * hexScale;\n          \n          // Get hex pattern\n          vec4 hex = hexagon(scaledUv);\n          \n          // Base color with hex pattern\n          vec3 color = mix(baseColor, vec3(0.0), hex.x);\n          \n          // Add pulsing glow - mix yellow and teal\n          vec3 glowMix = mix(glowColor, baseColor, sin(time * 0.5) * 0.5 + 0.5);\n          color = mix(color, glowMix, hex.y * 0.5);\n          \n          // Add subtle edge highlights\n          color = mix(color, vec3(1.0), smoothstep(0.9, 1.0, hex.z) * 0.3);\n          \n          // Add vibe highlights\n          if (hex.w > 0.0) {\n            color = mix(color, vec3(0.0, 1.0, 1.0), hex.w * (sin(time * 2.0) * 0.5 + 0.5));\n          }\n          \n          gl_FragColor = vec4(color, 1.0);\n        }\n      ',side:i.$EB}),r=new i.eaF(n,o);r.rotation.x=-Math.PI/2,r.position.set(0,0,0),r.name="floor",r.receiveShadow=!0,this.environmentGroup.add(r),this.pulsatingFloor=r,this.floorMaterial=o}},{key:"createHiveElements",value:function(){this.createHoneycombParticles(),this.createHoneyDropsParticles()}},{key:"createHoneycombParticles",value:function(){for(var e=400*this.scale,t=300*this.scale,n=new i.LoY,o=new Float32Array(150),r=new Float32Array(150),a=new Float32Array(50),s=0;s<50;s++){var l=3*s,c=Math.random()*Math.PI*2,h=Math.random()*t,u=.95*e+10*(Math.random()-.5);o[l]=Math.cos(c)*u,o[l+1]=h,o[l+2]=Math.sin(c)*u,Math.random()<.6?(r[l]=.9+.1*Math.random(),r[l+1]=.7+.3*Math.random(),r[l+2]=0+.2*Math.random()):(r[l]=0+.1*Math.random(),r[l+1]=.8+.2*Math.random(),r[l+2]=.8+.2*Math.random()),a[s]=4+6*Math.random()}n.setAttribute("position",new i.THS(o,3)),n.setAttribute("color",new i.THS(r,3)),n.setAttribute("size",new i.THS(a,1));var m=new i.BKk({uniforms:{time:{value:0},pixelRatio:{value:Math.min(window.devicePixelRatio,2)}},vertexShader:"\n        attribute float size;\n        attribute vec3 color;\n        varying vec3 vColor;\n        uniform float time;\n        uniform float pixelRatio;\n        \n        void main() {\n          vColor = color;\n          \n          // Add subtle movement\n          vec3 pos = position;\n          float wobble = sin(time * 0.5 + position.x * 0.1 + position.z * 0.1) * 0.5;\n          pos.y += wobble;\n          \n          vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n          gl_PointSize = size * pixelRatio * (300.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        varying vec3 vColor;\n        \n        void main() {\n          // Create a hexagon shape for each particle\n          vec2 coord = gl_PointCoord - vec2(0.5);\n          float len = length(coord);\n          \n          // Sharp hex pattern\n          float a = atan(coord.y, coord.x);\n          float r = 0.5;\n          float d = cos(floor(0.5 + a / (3.1415926 / 3.0)) * (3.1415926 / 3.0) - a) * len / r;\n          \n          if (d > 0.5) {\n            discard;\n          }\n          \n          // Add some glow\n          float alpha = smoothstep(0.5, 0.2, d);\n          gl_FragColor = vec4(vColor, alpha);\n        }\n      ",transparent:!0,depthWrite:!1,blending:i.EZo}),p=new i.ONl(n,m);this.environmentGroup.add(p),this.particleSystems.honeycombs=p}},{key:"createHoneyDropsParticles",value:function(){for(var e=400*this.scale,t=300*this.scale,n=new i.LoY,o=new Float32Array(600),r=new Float32Array(600),a=new Float32Array(200),s=new Float32Array(200),l=0;l<200;l++){var c=3*l,h=Math.random()*Math.PI*2,u=Math.random()*e*.8,m=Math.random()*t;o[c]=Math.cos(h)*u,o[c+1]=m,o[c+2]=Math.sin(h)*u,r[c]=.95+.05*Math.random(),r[c+1]=.6+.2*Math.random(),r[c+2]=0+.1*Math.random(),a[l]=2+2*Math.random(),s[l]=.01+.03*Math.random()}n.setAttribute("position",new i.THS(o,3)),n.setAttribute("color",new i.THS(r,3)),n.setAttribute("size",new i.THS(a,1)),n.userData={velocity:s};var p=new i.BKk({uniforms:{time:{value:0},pixelRatio:{value:Math.min(window.devicePixelRatio,2)}},vertexShader:"\n        attribute float size;\n        attribute vec3 color;\n        varying vec3 vColor;\n        uniform float time;\n        uniform float pixelRatio;\n        \n        void main() {\n          vColor = color;\n          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_PointSize = size * 2.0 * pixelRatio * (300.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        varying vec3 vColor;\n        \n        void main() {\n          // Create a drop shape\n          vec2 coord = gl_PointCoord - vec2(0.5);\n          float r = length(coord) * 2.0;\n          \n          // Create droplet shape\n          float alpha = smoothstep(1.0, 0.0, r);\n          \n          // Make bottom part more elongated\n          if (coord.y > 0.0) {\n            alpha *= smoothstep(1.0, 0.0, coord.y * 2.0);\n          }\n          \n          // Add a highlight\n          float highlight = smoothstep(0.5, 0.0, length(coord + vec2(0.2, -0.2)) * 3.0);\n          vec3 color = mix(vColor, vec3(1.0), highlight * 0.5);\n          \n          gl_FragColor = vec4(color, alpha);\n        }\n      ",transparent:!0,depthWrite:!1,blending:i.EZo}),d=new i.ONl(n,p);this.environmentGroup.add(d),this.particleSystems.honeyDrops=d}},{key:"createHoneyParticles",value:function(){for(var e=new i.LoY,t=new Float32Array(150),n=new Float32Array(150),o=new Float32Array(50),r=400*this.scale,a=300*this.scale,s=0;s<50;s++){var l=3*s,c=Math.random()*Math.PI*2,h=Math.random()*r*.9,u=Math.random()*a;t[l]=Math.cos(c)*h,t[l+1]=u,t[l+2]=Math.sin(c)*h;var m=Math.random();m<.4?(n[l]=.9+.1*Math.random(),n[l+1]=.7+.2*Math.random(),n[l+2]=0+.1*Math.random()):m<.8?(n[l]=0+.1*Math.random(),n[l+1]=.7+.3*Math.random(),n[l+2]=.7+.3*Math.random()):(n[l]=.8+.2*Math.random(),n[l+1]=.8+.2*Math.random(),n[l+2]=.8+.2*Math.random()),o[s]=.5+1.5*Math.random()}e.setAttribute("position",new i.THS(t,3)),e.setAttribute("color",new i.THS(n,3)),e.setAttribute("size",new i.THS(o,1));var p=new i.BKk({uniforms:{time:{value:0},pixelRatio:{value:Math.min(window.devicePixelRatio,2)}},vertexShader:"\n        attribute float size;\n        attribute vec3 color;\n        varying vec3 vColor;\n        uniform float time;\n        uniform float pixelRatio;\n        \n        void main() {\n          vColor = color;\n          \n          // Add gentle floating motion\n          vec3 pos = position;\n          float timeOffset = position.x * 0.01 + position.z * 0.01;\n          pos.y += sin(time * 0.2 + timeOffset) * 2.0;\n          pos.x += cos(time * 0.1 + position.y * 0.01) * 0.5;\n          pos.z += sin(time * 0.15 + position.y * 0.01) * 0.5;\n          \n          vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n          gl_PointSize = size * pixelRatio * (300.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        varying vec3 vColor;\n        \n        void main() {\n          // Soft circular particles\n          float dist = length(gl_PointCoord - 0.5) * 2.0;\n          float alpha = smoothstep(1.0, 0.0, dist);\n          \n          gl_FragColor = vec4(vColor, alpha * 0.6);\n        }\n      ",transparent:!0,depthWrite:!1,blending:i.EZo}),d=new i.ONl(e,p);this.environmentGroup.add(d),this.particleSystems.ambient=d}},{key:"createVibeElements",value:function(){var e=this,t=1024*this.scale,n=256*this.scale,o=function(t,n,o){var r=document.createElement("canvas"),a=r.getContext("2d");r.width=1024,r.height=256,a.fillStyle="#ffffff",a.font="bold 200px Arial",a.textAlign="center",a.textBaseline="middle",a.fillText(t,r.width/2,r.height/2);for(var s=a.getImageData(0,0,r.width,r.height).data,l=[],c=0;c<r.height;c+=3)for(var h=0;h<r.width;h+=3)if(s[4*(c*r.width+h)]>128){var u=h/r.width*2-1,m=c/r.height*2-1;l.push([u,-m])}for(var p=l.length,d=new i.LoY,y=new Float32Array(3*p),f=new Float32Array(3*p),v=new Float32Array(p),g=0;g<p;g++){var b=3*g,w=re(l[g],2),x=w[0],k=w[1];y[b]=200*x+n.x,y[b+1]=80*k+n.y,y[b+2]=n.z,f[b]=o.r,f[b+1]=o.g,f[b+2]=o.b,v[g]=3+3*Math.random()}d.setAttribute("position",new i.THS(y,3)),d.setAttribute("color",new i.THS(f,3)),d.setAttribute("size",new i.THS(v,1));var S=new i.BKk({uniforms:{time:{value:0},pixelRatio:{value:Math.min(window.devicePixelRatio,2)},rotationSpeed:{value:.1}},vertexShader:"\n          attribute float size;\n          attribute vec3 color;\n          varying vec3 vColor;\n          uniform float time;\n          uniform float pixelRatio;\n          uniform float rotationSpeed;\n          \n          void main() {\n            vColor = color;\n            \n            // Add wave effect\n            vec3 pos = position;\n            float wave = sin(position.x * 0.1 + time);\n            pos.y += wave * 2.0;\n            \n            // Add slow rotation around Y axis\n            float angle = time * rotationSpeed;\n            float cosA = cos(angle);\n            float sinA = sin(angle);\n            vec3 rotatedPos = vec3(\n              pos.x * cosA - pos.z * sinA,\n              pos.y,\n              pos.x * sinA + pos.z * cosA\n            );\n            \n            vec4 mvPosition = modelViewMatrix * vec4(rotatedPos, 1.0);\n            gl_PointSize = size * pixelRatio * (300.0 / -mvPosition.z);\n            gl_Position = projectionMatrix * mvPosition;\n          }\n        ",fragmentShader:"\n          varying vec3 vColor;\n          \n          void main() {\n            float dist = length(gl_PointCoord - 0.5) * 2.0;\n            float alpha = smoothstep(1.0, 0.0, dist);\n            gl_FragColor = vec4(vColor, alpha);\n          }\n        ",transparent:!0,depthWrite:!1,blending:i.EZo}),P=new i.ONl(d,S);return e.environmentGroup.add(P),e.vibeElements.push(P),P};o("#VIBE",new i.Pq0(0,.9*n,0),new i.Q1f(65501)).material.uniforms.rotationSpeed.value=.05,o("JAM",new i.Pq0(0,.7*n,0),new i.Q1f(16763904)).material.uniforms.rotationSpeed.value=-.07;for(var r=0;r<3;r++){var a=this.createVibingRing(.8*t-20*r,.4*n+30*r,r%2==0?56780:16755200);this.vibeElements.push(a)}}},{key:"createVibingRing",value:function(e,t,n){for(var o=new i.LoY,r=new Float32Array(150),a=new Float32Array(150),s=new Float32Array(50),l=new i.Q1f(n),c=0;c<50;c++){var h=3*c,u=c/50*Math.PI*2;r[h]=Math.cos(u)*e,r[h+1]=t,r[h+2]=Math.sin(u)*e,a[h]=l.r,a[h+1]=l.g,a[h+2]=l.b,s[c]=2+2*Math.random()}o.setAttribute("position",new i.THS(r,3)),o.setAttribute("color",new i.THS(a,3)),o.setAttribute("size",new i.THS(s,1));var m=new i.BKk({uniforms:{time:{value:0},pixelRatio:{value:Math.min(window.devicePixelRatio,2)}},vertexShader:"\n        attribute float size;\n        attribute vec3 color;\n        varying vec3 vColor;\n        uniform float time;\n        uniform float pixelRatio;\n        \n        void main() {\n          vColor = color;\n          \n          // Rotate the ring\n          float angle = atan(position.z, position.x) + time * 0.2;\n          float radius = length(position.xz);\n          vec3 pos = position;\n          \n          pos.x = cos(angle) * radius;\n          pos.z = sin(angle) * radius;\n          \n          // Add wave effect\n          pos.y += sin(angle * 8.0 + time) * 5.0;\n          \n          vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n          gl_PointSize = size * pixelRatio * (300.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        varying vec3 vColor;\n        \n        void main() {\n          float dist = length(gl_PointCoord - 0.5) * 2.0;\n          float alpha = smoothstep(1.0, 0.0, dist);\n          gl_FragColor = vec4(vColor, alpha);\n        }\n      ",transparent:!0,depthWrite:!1,blending:i.EZo}),p=new i.ONl(o,m);return this.environmentGroup.add(p),p}},{key:"createEnergyBeams",value:function(){for(var e=400*this.scale,t=300*this.scale,n=0;n<5;n++){var o=n/5*Math.PI*2,r=Math.cos(o)*e*.7,a=Math.sin(o)*e*.7,s=new i.Ho_(2,2,t,16,10,!0),l=new i.BKk({uniforms:{time:{value:0},color1:{value:new i.Q1f(65501)},color2:{value:new i.Q1f(16763904)}},vertexShader:"\n          varying vec2 vUv;\n          void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          }\n        ",fragmentShader:"\n          uniform float time;\n          uniform vec3 color1;\n          uniform vec3 color2;\n          varying vec2 vUv;\n          \n          void main() {\n            // Create moving waves\n            float wave = sin(vUv.y * 20.0 + time * 2.0) * 0.5 + 0.5;\n            \n            // Vertical gradient\n            float gradient = pow(vUv.y, 0.5);\n            \n            // Edge glow\n            float edge = pow(sin(vUv.x * 6.28318) * 0.5 + 0.5, 2.0);\n            \n            // Combine effects\n            vec3 finalColor = mix(color1, color2, gradient);\n            finalColor *= wave * edge;\n            \n            // Add transparency at edges\n            float alpha = edge * (0.5 + 0.5 * sin(time + vUv.y * 10.0));\n            \n            gl_FragColor = vec4(finalColor, alpha * 0.7);\n          }\n        ",transparent:!0,side:i.$EB,blending:i.EZo}),c=new i.eaF(s,l);c.position.set(r,t/2,a),this.environmentGroup.add(c),this.energyBeams.push(c);var h=new i.tcD(10,32),u=new i.V9B({color:65501,transparent:!0,opacity:.7,side:i.$EB,blending:i.EZo}),m=new i.eaF(h,u);m.rotation.x=-Math.PI/2,m.position.set(r,1,a),this.environmentGroup.add(m)}}},{key:"createSunlight",value:function(){var e=new i.$p8(16772829,.4);this.environmentGroup.add(e);var t=new i.ZyN(16777215,1.6);t.position.set(0,500*this.scale,200*this.scale),t.castShadow=!0,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.shadow.camera.near=50*this.scale,t.shadow.camera.far=1e3*this.scale;var n=500*this.scale;t.shadow.camera.left=-n,t.shadow.camera.right=n,t.shadow.camera.top=n,t.shadow.camera.bottom=-n,this.environmentGroup.add(t),this.sunLight=t,this.shadowTarget=new i.B69,this.shadowTarget.position.set(0,0,0),this.environmentGroup.add(this.shadowTarget),t.target=this.shadowTarget;var o=new i.HiM(65501,1,200*this.scale);o.position.set(100*this.scale,150*this.scale,100*this.scale),this.environmentGroup.add(o);var r=new i.HiM(16763904,1,200*this.scale);r.position.set(-100*this.scale,150*this.scale,-100*this.scale),this.environmentGroup.add(r)}},{key:"update",value:function(e){this.game.player&&this.shadowTarget&&(this.shadowTarget.position.copy(this.game.player.position),this.sunLight.target.updateMatrixWorld()),this.updateAnimatedTextures(),this.pulsatingFloor&&this.pulsatingFloor.material.uniforms&&(this.pulsatingFloor.material.uniforms.time.value=.001*performance.now()),this.updateHoneycombParticles(),this.updateHoneyDrops(),this.updateAmbientParticles(),this.updateVibeElements(),this.updateEnergyBeams()}},{key:"updateAnimatedTextures",value:function(){}},{key:"updateHoneycombParticles",value:function(){if(this.particleSystems.honeycombs){var e=this.particleSystems.honeycombs.material;e&&e.uniforms&&(e.uniforms.time.value=.001*performance.now())}}},{key:"updateHoneyDrops",value:function(){if(this.particleSystems.honeyDrops){var e=this.particleSystems.honeyDrops.material;e&&e.uniforms&&(e.uniforms.time.value=.001*performance.now());for(var t=this.particleSystems.honeyDrops.geometry.attributes.position.array,n=this.particleSystems.honeyDrops.geometry.userData.velocity,i=0;i<n.length;i++){var o=3*i;t[o+1]-=n[i],t[o+1]<0&&(t[o+1]=300*this.scale)}this.particleSystems.honeyDrops.geometry.attributes.position.needsUpdate=!0}}},{key:"updateAmbientParticles",value:function(){if(this.particleSystems.ambient){var e=this.particleSystems.ambient.material;e&&e.uniforms&&(e.uniforms.time.value=.001*performance.now())}}},{key:"updateVibeElements",value:function(){var e=.001*performance.now();this.vibeElements.forEach((function(t){t.material&&t.material.uniforms&&(t.material.uniforms.time.value=e)}))}},{key:"updateEnergyBeams",value:function(){var e=.001*performance.now();this.energyBeams.forEach((function(t){t.material&&t.material.uniforms&&(t.material.uniforms.time.value=e)}))}},{key:"updateTextures",value:function(e,t){t?(console.log("Updating texture for ".concat(e," - animated: ").concat(t.animated?"yes":"no")),e in this.textures&&(this.textures[e]=t),"honeycomb"===e&&this.ceilingMaterial&&(this.ceilingMaterial.map=t,this.ceilingMaterial.needsUpdate=!0),(t.animated||t.source&&t.source.data&&"CANVAS"===t.source.data.tagName)&&(t.needsConstantUpdate=!0)):console.warn("Attempted to update with null texture of type:",e)}},{key:"getColliders",value:function(){var e=[];e.push({type:"plane",position:new i.Pq0(0,0,0),normal:new i.Pq0(0,1,0)}),e.push({type:"plane",position:new i.Pq0(0,300*this.scale,0),normal:new i.Pq0(0,-1,0)});var t=400*this.scale;return e.push({type:"cylinder",position:new i.Pq0(0,150*this.scale,0),radius:t,height:300*this.scale,invertNormals:!0}),e}}],t&&he(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o}();function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function de(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ye(i.key),i)}}function ye(e){var t=function(e){if("object"!=pe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==pe(t)?t:t+""}var fe=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scene=t.scene,this.arenaGroup=new i.YJl,this.scene.add(this.arenaGroup),this.textureApplied=!1,this.textureUUID=null,this.bulletManager=new V(t,this.arenaGroup),this.enemyManager=new $(t,this.arenaGroup),this.environment=new me(t,this.arenaGroup),this.powerUpManager=new ie(t,this.arenaGroup),this.gameStartTime=0,this.gameScore=0,this.killStreak=0,this.killCount=0,this.createScoreDisplay(),this.createHealthIndicator()},(t=[{key:"createScoreDisplay",value:function(){this.killCount=0,this.killStreak=0}},{key:"addScore",value:function(e){var t=1+.1*this.killStreak,n=Math.round(e*t);this.gameScore+=n,this.killCount++,this.killStreak++,this.showKillNotification(),this.killStreak%10==0&&this.powerUpManager.spawnPowerUp()}},{key:"showScoreText",value:function(e,t){if(this.game.camera&&t){var n=t.clone();n.project(this.game.camera);var i=(.5*n.x+.5)*window.innerWidth,o=-(.5*n.y-.5)*window.innerHeight,r=document.createElement("div");r.textContent=e,r.style.position="absolute",r.style.color="#ffcc00",r.style.fontSize="16px",r.style.fontWeight="bold",r.style.top="".concat(o,"px"),r.style.left="".concat(i,"px"),r.style.textShadow="0 0 3px black",r.style.pointerEvents="none",r.style.zIndex="1000",r.style.transition="all 0.8s ease-out",document.body.appendChild(r),setTimeout((function(){r.style.opacity="0",r.style.transform="translate(0, -30px)",setTimeout((function(){r.parentNode&&document.body.removeChild(r)}),800)}),50)}}},{key:"showKillNotification",value:function(){var e=document.createElement("div");e.style.position="absolute",e.style.top="60%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="#FFCC00",e.style.padding="10px 20px",e.style.borderRadius="8px",e.style.fontSize="24px",e.style.fontWeight="bold",e.style.textAlign="center",e.style.zIndex="101",e.style.boxShadow="0 0 15px rgba(255, 204, 0, 0.5)",e.style.transition="all 0.5s ease-out";var t="number"==typeof this.killCount?this.killCount:0;this.killStreak>1?e.innerHTML='KILLS: <span style="color:red;">'.concat(t,'</span><br>\n                             <span style="color:#FF5500;">🔥 ').concat(this.killStreak," STREAK!</span>"):e.innerHTML='KILLS: <span style="color:red;">'.concat(t,"</span>"),document.body.appendChild(e),setTimeout((function(){e.style.transform="translate(-50%, -150%)",e.style.opacity="0",setTimeout((function(){e.parentNode&&document.body.removeChild(e)}),500)}),1e3)}},{key:"resetStreak",value:function(){this.killStreak=0}},{key:"createHealthIndicator",value:function(){this.healthContainer=document.createElement("div"),this.healthContainer.style.position="absolute",this.healthContainer.style.bottom="20px",this.healthContainer.style.left="50%",this.healthContainer.style.transform="translateX(-50%)",this.healthContainer.style.width="350px",this.healthContainer.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.healthContainer.style.padding="6px 10px",this.healthContainer.style.borderRadius="6px",this.healthContainer.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5)",this.healthContainer.style.display="none",this.healthContainer.style.zIndex="100";var e=document.createElement("div");e.style.width="100%",e.style.height="12px",e.style.backgroundColor="rgba(255, 255, 255, 0.2)",e.style.borderRadius="4px",e.style.overflow="hidden",e.style.border="1px solid rgba(255, 255, 255, 0.3)",this.healthContainer.appendChild(e),this.healthBar=document.createElement("div"),this.healthBar.style.width="100%",this.healthBar.style.height="100%",this.healthBar.style.backgroundColor="#00ff00",this.healthBar.style.transition="width 0.3s, background-color 0.3s",this.healthBar.style.borderRadius="3px",e.appendChild(this.healthBar),this.healthValue=document.createElement("div"),this.healthValue.textContent="100/100",this.healthValue.style.position="absolute",this.healthValue.style.top="50%",this.healthValue.style.left="50%",this.healthValue.style.transform="translate(-50%, -50%)",this.healthValue.style.color="white",this.healthValue.style.fontSize="12px",this.healthValue.style.fontWeight="bold",this.healthValue.style.textShadow="1px 1px 2px rgba(0, 0, 0, 0.8)",e.appendChild(this.healthValue),document.body.appendChild(this.healthContainer),this.updateHealthIndicator(100)}},{key:"updateHealthIndicator",value:function(e){if(this.healthBar&&this.healthValue){var t=Math.max(0,Math.min(100,e/100*100));if(this.healthBar.style.width="".concat(t,"%"),this.healthBar.style.backgroundColor=t>60?"#00ff00":t>30?"#ffff00":"#ff0000",this.healthValue.textContent="".concat(Math.ceil(e),"/").concat(100),t<20){if(this.healthContainer.style.animation="pulse 1.5s infinite",!document.getElementById("health-pulse-animation")){var n=document.createElement("style");n.id="health-pulse-animation",n.textContent="\n          @keyframes pulse {\n            0% { transform: scale(1); }\n            50% { transform: scale(1.05); }\n            100% { transform: scale(1); }\n          }\n        ",document.head.appendChild(n)}}else this.healthContainer.style.animation="none"}}},{key:"initializeCombat",value:function(){var e=this;if(this.arenaGroup.visible=!0,this.game.collisionSystem){var t=this.environment?this.environment.getColliders():[];this.game.collisionSystem.addColliders(t),this.game.collidersRegistered=!0}this.bulletManager&&this.bulletManager.prewarmSystem(),this.scoreDisplay&&(this.scoreDisplay.style.display="block"),this.healthContainer&&(this.healthContainer.style.display="block"),this.gameStartTime=performance.now(),this.gameScore=0,this.killStreak=0,this.enemyManager?(this.enemyManager.reset(),this.enemyManager.spawnInitialEnemies(5)):console.error("Enemy manager not initialized!"),setTimeout((function(){e.powerUpManager&&e.powerUpManager.spawnPowerUp()}),15e3)}},{key:"reset",value:function(){return this.bulletManager&&this.bulletManager.reset(),this.enemyManager&&this.enemyManager.reset(),this.powerUpManager&&this.powerUpManager.reset(),this.gameScore=0,this.killStreak=0,this.killCount=0,this.scoreDisplay&&(this.scoreDisplay.style.display="none"),this.healthContainer&&(this.healthContainer.style.display="none"),!0}},{key:"update",value:function(e){var t=this;this.environment&&this.environment.update(e),this.bulletManager&&this.bulletManager.update((function(e,t){return!1}),this.enemyManager),this.enemyManager&&this.enemyManager.update(e),this.powerUpManager&&this.powerUpManager.update(),void 0!==this.game.playerHealth&&this.healthContainer&&this.updateHealthIndicator(this.game.playerHealth),this.enemyManager&&(this.enemyManager.onEnemyDefeated||(this.enemyManager.onEnemyDefeated=function(){t.addScore(100)}))}}])&&de(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,a,s=[],l=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||we(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=we(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function we(e,t){if(e){if("string"==typeof e)return xe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xe(e,t):void 0}}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){Pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pe(e,t,n){return(t=Ce(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Ce(i.key),i)}}function Ce(e){var t=function(e){if("object"!=ve(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ve(t)?t:t+""}var Ee=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.colliders=[],this.debugMode=!1,this.debugHelpers=[],this.scene=t?t.scene:null,this.constants={slideFriction:.1,minSlideSpeed:.03,maximumPenetration:.2,responseMultiplier:.9,collisionBuffer:.05}},(t=[{key:"addCollider",value:function(e){if(e.type&&e.position)return e.id||(e.id="collider_"+this.colliders.length),this.colliders.push(e),this.debugMode&&this.createDebugHelper(e),e.id}},{key:"removeCollider",value:function(e){var t=this.colliders.findIndex((function(t){return t.id===e}));if(-1!==t&&(this.colliders.splice(t,1),this.debugMode)){var n=this.debugHelpers.findIndex((function(t){return t.userData.colliderId===e}));if(-1!==n){var i=this.debugHelpers[n];i.parent&&i.parent.remove(i),this.debugHelpers.splice(n,1)}}}},{key:"addColliders",value:function(e){var t=this;Array.isArray(e)&&e.forEach((function(e){if("sphere"===e.type&&void 0!==e.radius)t.addCollider(e);else if("cylinder"===e.type&&void 0!==e.radius){var n=Se(Se({},e),{},{height:e.height||140});t.addCollider(n)}else if("plane"===e.type){var o=Se(Se({},e),{},{normal:e.normal||new i.Pq0(0,1,0)});t.addCollider(o)}else if("ring"===e.type)t.addCollider(e);else if("platform"===e.type){var r=Se(Se({},e),{},{type:"plane",normal:e.normal||new i.Pq0(0,1,0),size:e.radius||10});t.addCollider(r)}else if("ramp"===e.type){t.addCollider(e);var a=(new i.Pq0).subVectors(e.end,e.start).normalize(),s=new i.Pq0(0,1,0);s.cross(new i.Pq0(a.z,0,-a.x));var l={type:"plane",position:(new i.Pq0).addVectors(e.start,e.end).multiplyScalar(.5),normal:s,size:e.width||5};t.addCollider(l)}}))}},{key:"checkCollisions",value:function(e,t){if(!e||!e.position)return!1;var n;if(e.velocity)n=e.velocity;else{if(!e.userData||!e.userData.velocity)return!1;n=e.userData.velocity}if(0===this.colliders.length)return!1;var o,r=!1,a=e.position,s=this.colliders.filter((function(e){return"plane"===e.type&&e.normal&&e.normal.y>.9})),l=be(s);try{for(l.s();!(o=l.n()).done;){var c,h,u=o.value,m=new i.Pq0,p=ge(this.planeCollision(a,t,u.position,u.normal),3);c=p[0],m=p[1],h=p[2],c&&(r=!0,this.handleCollisionResponse(e,m,h,n),Math.abs(n.y)<.01&&(a.y+=.01),u.onCollision&&"function"==typeof u.onCollision&&u.onCollision(e))}}catch(e){l.e(e)}finally{l.f()}var d,y=be(this.colliders);try{for(y.s();!(d=y.n()).done;){var f=d.value;if(!s.includes(f)&&!1!==f.active){var v=!1,g=new i.Pq0,b=0;switch(f.type){case"sphere":if(f.invertNormals){var w=a.distanceTo(f.position),x=f.radius-t-1;if(w>x){v=!0;var k=(new i.Pq0).subVectors(a,f.position).normalize();if(g=k.clone().negate(),a.y<5&&g.y<0&&(g.y=0,g.length()>.1?g.normalize():g.set(a.x,0,a.z).normalize()),b=w-x,b*=.1,b=Math.min(b,.5),w>f.radius+20){var S=f.position.clone().add(k.clone().multiplyScalar(.8*x));return S.y=a.y,a.copy(S),n.set(0,0,0),!0}}else v=!1}else{var P=ge(this.sphereCollision(a,t,f.position,f.radius),3);v=P[0],g=P[1],b=P[2]}break;case"cylinder":var M=ge(this.cylinderCollision(a,t,f.position,f.radius,f.height,f.invertNormals),3);v=M[0],g=M[1],b=M[2];break;case"ring":var C=ge(this.ringCollision(a,t,f.position,f.innerRadius,f.outerRadius),3);v=C[0],g=C[1],b=C[2];break;case"plane":var E=ge(this.planeCollision(a,t,f.position,f.normal),3);v=E[0],g=E[1],b=E[2];break;case"platform":var T=a.x-f.position.x,A=a.z-f.position.z;if(T*T+A*A<=Math.pow(f.radius,2)){var L=a.y-f.position.y;(L>=0&&L<=1.2*t||L>-.2&&L<.2)&&n.y<=.1&&(v=!0,g=new i.Pq0(0,1,0),(b=t-L)<.1&&(b=.1),b>t&&(b=t))}}v&&(r=!0,this.handleCollisionResponse(e,g,b,n),f.onCollision&&"function"==typeof f.onCollision&&f.onCollision(e))}}}catch(e){y.e(e)}finally{y.f()}return r}},{key:"meshCollision",value:function(e,t,n,o){if(e.distanceTo(n.position)>t+o)return[!1,new i.Pq0,0];var r=(new i.NRn).setFromObject(n),a=new i.Pq0;a.copy(e),r.clampPoint(e,a);var s=(new i.Pq0).subVectors(e,a),l=t-s.length();return l>0?[!0,s.normalize(),l]:[!1,new i.Pq0,0]}},{key:"handleCollisionResponse",value:function(e,t,n,i){var o=e.position;if(o.y<5&&t.y<-.5&&n>1)i.y=Math.max(i.y,1);else{if(n>this.constants.maximumPenetration){var r=Math.min(n-this.constants.maximumPenetration+this.constants.collisionBuffer,1);o.addScaledVector(t,r)}var a=i.dot(t);if(a<0){var s=i.clone().sub(t.clone().multiplyScalar(a));s.multiplyScalar(this.constants.responseMultiplier),s.length()>this.constants.minSlideSpeed&&s.multiplyScalar(1-this.constants.slideFriction),t.y>.7&&(s.y+=.1),i.copy(s)}}}},{key:"sphereCollision",value:function(e,t,n,o){var r=(new i.Pq0).subVectors(e,n),a=r.length(),s=t+o;return a<s?[!0,r.clone().normalize(),s-a]:[!1,new i.Pq0,0]}},{key:"planeCollision",value:function(e,t,n,o){var r=(new i.Pq0).subVectors(e,n).dot(o);return Math.abs(r)<t?[!0,r>0?o.clone():o.clone().negate(),t-Math.abs(r)]:[!1,new i.Pq0,0]}},{key:"cylinderCollision",value:function(e,t,n,o,r,a){var s=n.clone(),l=r/2,c=e.y-(s.y+l),h=s.y-l-e.y;if(c>t||h>t)return[!1,new i.Pq0,0];var u=e.x-s.x,m=e.z-s.z,p=u*u+m*m,d=Math.sqrt(p),y=new i.Pq0,f=0,v=!1;return a?d>o-t&&(v=!0,y.set(-u,0,-m),y.normalize(),f=d-(o-t)):d<o+t&&(v=!0,y.set(u,0,m),y.normalize(),f=o+t-d),v?[!0,y,f]:[!1,new i.Pq0,0]}},{key:"ringCollision",value:function(e,t,n,o,r){if(Math.abs(e.y-n.y)>t)return[!1,new i.Pq0,0];var a=e.x-n.x,s=e.z-n.z,l=Math.sqrt(a*a+s*s);if(l<o+t)return[!0,new i.Pq0(a,0,s).normalize(),o+t-l];if(l>r-t){var c=l-(r-t);return[!0,new i.Pq0(a,0,s).normalize().negate(),c]}return[!1,new i.Pq0,0]}},{key:"createDebugHelper",value:function(e){var t,n=new i.V9B({color:16711680,transparent:!0,opacity:.3,wireframe:!0});switch(e.type){case"sphere":(t=new i.eaF(new i.Gu$(e.radius,16,16),n)).position.copy(e.position),e.invertNormals&&(t.material=new i.V9B({color:65280,transparent:!0,opacity:.3,wireframe:!0}));break;case"plane":var o=new i.bdM(100,100);(t=new i.eaF(o,n)).position.copy(e.position),t.lookAt(e.position.clone().add(e.normal));break;case"cylinder":(t=new i.eaF(new i.Ho_(e.radius,e.radius,e.height,32),n)).position.copy(e.position);break;case"ring":var r=new i.ypk;r.absarc(0,0,e.outerRadius,0,2*Math.PI,!1);var a=new i.wAk;a.absarc(0,0,e.innerRadius,0,2*Math.PI,!0),r.holes.push(a);var s=new i.MSw(r);(t=new i.eaF(s,n)).rotation.x=-Math.PI/2,t.position.copy(e.position);break;case"platform":(t=new i.eaF(new i.tcD(e.radius,32),n)).rotation.x=-Math.PI/2,t.position.copy(e.position);break;case"ramp":var l=(new i.Pq0).subVectors(e.end,e.start).length();t=new i.eaF(new i.iNn(e.width||5,.5,l),n);var c=(new i.Pq0).addVectors(e.start,e.end).multiplyScalar(.5);t.position.copy(c);var h=(new i.Pq0).subVectors(e.end,e.start),u=Math.atan2(h.z,h.x);t.rotation.y=-u;var m=e.end.y-e.start.y,p=Math.sqrt(h.x*h.x+h.z*h.z),d=Math.atan2(m,p);t.rotation.x=d}t&&(t.userData.colliderId=e.id,this.game&&this.game.scene?this.game.scene.add(t):this.scene&&this.scene.add(t),this.debugHelpers.push(t))}},{key:"destroy",value:function(){this.debugMode&&this.debugHelpers.forEach((function(e){e.parent&&e.parent.remove(e)})),this.debugHelpers=[],this.colliders=[]}},{key:"reset",value:function(){return this.colliders=[],this.debugHelpers.length>0&&(this.debugHelpers.forEach((function(e){e.parent&&e.parent.remove(e)})),this.debugHelpers=[]),this.collidersRegistered=!1,!0}}])&&Me(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function Ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Le(i.key),i)}}function Le(e){var t=function(e){if("object"!=Te(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Te(t)?t:t+""}var Be=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.poolSize=t.poolSize||200,this.scene=t.scene,this.geometries={sphere:[new i.Gu$(.05,4,4),new i.Gu$(.1,6,4),new i.Gu$(.2,8,6)],spark:new i.iNn(.3,.3,.3)},this.materials={honey:new i.V9B({color:16763904,transparent:!0,opacity:.7}),explosion:new i.V9B({color:16733440,transparent:!0,opacity:.8}),spark:new i.V9B({color:16755200,transparent:!0,opacity:.9})},this.pools={honey:[],explosion:[],spark:[]},this.initializePools(),this.activeParticles=[]},t=[{key:"initializePools",value:function(){var e=this;Object.keys(this.pools).forEach((function(t){for(var n=0;n<e.poolSize;n++){var o=void 0;if("honey"===t){var r=Math.floor(Math.random()*e.geometries.sphere.length);o=new i.eaF(e.geometries.sphere[r],e.materials.honey.clone())}else if("explosion"===t){var a=Math.floor(Math.random()*e.geometries.sphere.length);o=new i.eaF(e.geometries.sphere[a],e.materials.explosion.clone())}else"spark"===t&&(o=new i.eaF(e.geometries.spark,e.materials.spark.clone()));o.visible=!1,o.userData={active:!1,type:t,velocity:new i.Pq0,acceleration:new i.Pq0,lifetime:0,maxLifetime:0,onUpdate:null},e.scene&&e.scene.add(o),e.pools[t].push(o)}}))}},{key:"getParticle",value:function(e){var t=this.pools[e];if(!t)return null;for(var n=0;n<t.length;n++)if(!t[n].userData.active)return t[n];if(this.activeParticles.length>0){var i=1/0,o=null;if(this.activeParticles.forEach((function(t){t.userData.type===e&&t.userData.lifetime<i&&(i=t.userData.lifetime,o=t)})),o)return o}return null}},{key:"createEffect",value:function(e){for(var t=e.type,n=e.position,o=e.count,r=void 0===o?10:o,a=e.spread,s=void 0===a?.5:a,l=e.velocity,c=void 0===l?.1:l,h=e.acceleration,u=void 0===h?new i.Pq0(0,-.001,0):h,m=e.maxLifetime,p=void 0===m?60:m,d=e.onUpdate,y=void 0===d?null:d,f=e.parent,v=void 0===f?null:f,g=[],b=0;b<r;b++){var w=this.getParticle(t);if(w){w.position.copy(n),s>0&&(w.position.x+=(Math.random()-.5)*s,w.position.y+=(Math.random()-.5)*s,w.position.z+=(Math.random()-.5)*s);var x=new i.Pq0((Math.random()-.5)*c,(Math.random()-.5)*c,(Math.random()-.5)*c);w.visible=!0,w.material.opacity=1,w.userData.active=!0,w.userData.velocity=x,w.userData.acceleration=u.clone(),w.userData.lifetime=0,w.userData.maxLifetime=p+Math.random()*p*.5,w.userData.onUpdate=y,v&&(w.originalParent=w.parent,v.add(w)),this.activeParticles.includes(w)||this.activeParticles.push(w),g.push(w)}}return g}},{key:"createHoneyDrip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.createEffect({type:"honey",position:e,count:t.count||1,spread:t.spread||.2,velocity:t.velocity||.05,acceleration:new i.Pq0(0,-.002,0),maxLifetime:t.lifetime||120,onUpdate:function(e){var t=e.userData.lifetime/e.userData.maxLifetime;e.scale.y=1+t,t>.7&&(e.material.opacity=1*(1-(t-.7)/.3))}})}},{key:"createExplosion",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.createEffect({type:"explosion",position:e,count:t.count||15,spread:t.spread||.5,velocity:t.velocity||.2,maxLifetime:t.lifetime||60,onUpdate:function(e){var t=e.userData.lifetime/e.userData.maxLifetime;e.material.opacity=1*(1-t),e.userData.velocity.multiplyScalar(.98)}})}},{key:"createTrailEffect",value:function(e){for(var t=e.type,n=void 0===t?"spark":t,o=e.position,r=e.count,a=void 0===r?3:r,s=e.color,l=void 0===s?new i.Q1f(16777130):s,c=e.spread,h=void 0===c?.2:c,u=e.velocity,m=void 0===u?.05:u,p=e.maxLifetime,d=void 0===p?15:p,y=e.onUpdate,f=void 0===y?null:y,v=this.game&&this.game.isMobile?Math.max(1,Math.floor(a/2)):a,g=[],b=0;b<v;b++){var w=this.getParticle(n);if(w){w.position.copy(o),h>0&&(w.position.x+=(Math.random()-.5)*h,w.position.y+=(Math.random()-.5)*h,w.position.z+=(Math.random()-.5)*h);var x=new i.Pq0((Math.random()-.5)*m,(Math.random()-.5)*m*.5,(Math.random()-.5)*m);w.visible=!0,w.material.opacity=.7,l&&w.material.color.copy(l),w.userData.active=!0,w.userData.velocity=x,w.userData.acceleration=new i.Pq0(0,-5e-4,0),w.userData.lifetime=0,w.userData.maxLifetime=d+5*Math.random(),w.userData.onUpdate=f,this.activeParticles.includes(w)||this.activeParticles.push(w),g.push(w)}}return g}},{key:"update",value:function(){if(0!==this.activeParticles.length){for(var e=this.game&&this.game.isMobile?20:50,t=this.lastProcessedIndex||0,n=Math.min(t+e,this.activeParticles.length),i=n-1;i>=t;i--){var o=this.activeParticles[i],r=o.userData;o.position.add(r.velocity),r.velocity.add(r.acceleration),r.lifetime++,r.onUpdate&&r.onUpdate(o),r.lifetime>r.maxLifetime&&(this.recycleParticle(o),this.activeParticles.splice(i,1))}this.lastProcessedIndex=n>=this.activeParticles.length?0:n}}},{key:"recycleParticle",value:function(e){e.visible=!1,e.userData.active=!1,e.userData.lifetime=0,e.userData.onUpdate=null,e.scale.set(1,1,1),e.originalParent&&e.parent!==e.originalParent&&(e.parent.remove(e),e.originalParent&&e.originalParent.add(e))}},{key:"prewarm",value:function(){var e=this,t=new i.Pq0;Object.keys(this.pools).forEach((function(n){for(var i=0;i<10;i++)e.createEffect({type:n,position:t,count:5}).forEach((function(t){return e.recycleParticle(t)}))})),this.activeParticles=[]}},{key:"dispose",value:function(){var e=this;this.activeParticles.forEach((function(t){return e.recycleParticle(t)})),this.activeParticles=[],this.scene&&Object.values(this.pools).flat().forEach((function(t){e.scene.remove(t)})),Object.keys(this.geometries).forEach((function(t){Array.isArray(e.geometries[t])?e.geometries[t].forEach((function(e){return e.dispose()})):e.geometries[t].dispose()})),Object.values(this.materials).forEach((function(e){return e.dispose()})),this.pools={}}}],t&&Ae(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function De(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Fe(i.key),i)}}function Fe(e){var t=function(e){if("object"!=ze(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ze(t)?t:t+""}var Oe=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scene=t.scene,this.currentZone="exterior",this.transitionProgress=0,this.exteriorSkybox=null,this.interiorHive=null,this.game.assetManager&&this.game.assetManager.isLoaded()?(this.exteriorSkybox=this.game.assetManager.getTexture("forestSkybox"),this.interiorHive=this.game.assetManager.getTexture("spaceSkybox"),this.updateEnvironment()):(this.loadExteriorSkybox(),this.loadHiveHDRI())},t=[{key:"loadExteriorSkybox",value:function(){var e=this;(new i.Tap).load("assets/textures/forest_mid.png",(function(t){t.mapping=i.wfO,t.colorSpace=i.er$,e.exteriorSkybox=t,e.updateEnvironment()}))}},{key:"loadHiveHDRI",value:function(){var e=this;(new i.Tap).load("assets/textures/space_hdri.jpg",(function(t){t.mapping=i.wfO,t.colorSpace=i.er$,e.interiorHive=t,e.updateEnvironment()}))}},{key:"updateEnvironment",value:function(){"exterior"===this.currentZone&&this.exteriorSkybox?(this.game.scene.background=this.exteriorSkybox,this.updateLighting("exterior"),this.game.combatArena&&(this.game.combatArena.arenaGroup.visible=!1)):"interior"===this.currentZone&&this.interiorHive&&(this.game.scene.background=this.interiorHive,this.updateLighting("interior"),this.game.combatArena&&(this.game.combatArena.arenaGroup.visible=!0,this.game.inCombat||(this.game.combatArena.initializeCombat(),this.game.inCombat=!0)))}},{key:"updateLighting",value:function(e){this.game.scene.traverse((function(t){t.isLight&&t.userData.environmentLight&&("exterior"===e?(t.intensity=t.userData.exteriorIntensity||1,t.color.set(t.userData.exteriorColor||16777215)):"interior"===e&&(t.intensity=t.userData.interiorIntensity||.7,t.color.set(t.userData.interiorColor||16759671)))}))}},{key:"updateZone",value:function(e){var t=e.length();t<15?"interior"!==this.currentZone&&(this.currentZone="interior","interior"!==this.game.currentEnvironment&&this.game.switchEnvironment("interior"),this.updateEnvironment()):t>20&&"exterior"!==this.currentZone&&(this.currentZone="exterior",this.updateEnvironment())}},{key:"update",value:function(e){if("transition"===this.currentZone)if(this.transitionProgress+=.001*e,this.transitionProgress>=1)this.currentZone="interior",this.updateEnvironment(),"interior"!==this.game.currentEnvironment&&this.game.switchEnvironment("interior");else{var t=this.transitionProgress,n=1-t,i=t;this.blendEnvironments(n,i)}}},{key:"blendEnvironments",value:function(e,t){if(this.game.scene.fog){var n=new i.Q1f(8900331),o=new i.Q1f(13016173),r=(new i.Q1f).copy(n).multiplyScalar(e).add(o.clone().multiplyScalar(t));this.game.scene.fog.color.copy(r),this.game.scene.fog.density=.001*e+.002*t}this.blendLighting(e,t)}},{key:"blendLighting",value:function(e,t){this.game.scene.traverse((function(n){if(n.isLight&&n.userData.environmentLight){var o=n.userData.exteriorIntensity||1,r=n.userData.interiorIntensity||.7,a=new i.Q1f(n.userData.exteriorColor||16777215),s=new i.Q1f(n.userData.interiorColor||16759671);n.intensity=o*e+r*t,n.color.copy(a).multiplyScalar(e).add(s.clone().multiplyScalar(t))}}))}}],t&&De(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,He(i.key),i)}}function He(e){var t=function(e){if("object"!=je(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==je(t)?t:t+""}var Ge=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.scene=t.scene,this.player=t.player,this.exitPortalGroup=null,this.startPortalGroup=null,this.exitPortalBox=null,this.startPortalBox=null,this.checkPortalEntry(),this.createExitPortal(),this.updatePortalVisibility()},(t=[{key:"checkPortalEntry",value:function(){"true"===new URLSearchParams(window.location.search).get("portal")&&(this.createStartPortal(),this.game.player&&(this.game.player.position.set(100,50,100),this.game.camera.position.set(100,55,120)))}},{key:"createStartPortal",value:function(){this.startPortalGroup=new i.YJl,this.startPortalGroup.position.set(100,50,100);var e=new i.O3Y(15,2,16,100),t=new i.tXL({color:16711680,emissive:16711680,transparent:!0,opacity:.8}),n=new i.eaF(e,t);this.startPortalGroup.add(n);var o=new i.tcD(13,32),r=new i.V9B({color:16711680,transparent:!0,opacity:.5,side:i.$EB}),a=new i.eaF(o,r);this.startPortalGroup.add(a),this.createPortalParticles(this.startPortalGroup,16711680),this.startPortalBox=(new i.NRn).setFromObject(this.startPortalGroup),this.scene.add(this.startPortalGroup),this.animatePortal(this.startPortalGroup)}},{key:"createExitPortal",value:function(){this.exitPortalGroup=new i.YJl,this.exitPortalGroup.position.set(300,150,-300);var e=new i.O3Y(15,2,16,100),t=new i.tXL({color:65280,emissive:65280,transparent:!0,opacity:.8}),n=new i.eaF(e,t);this.exitPortalGroup.add(n);var o=new i.tcD(13,32),r=new i.V9B({color:65280,transparent:!0,opacity:.5,side:i.$EB}),a=new i.eaF(o,r);this.exitPortalGroup.add(a),this.createPortalLabel(this.exitPortalGroup),this.createPortalParticles(this.exitPortalGroup,65280),this.exitPortalBox=(new i.NRn).setFromObject(this.exitPortalGroup),this.scene.add(this.exitPortalGroup),this.animatePortal(this.exitPortalGroup),this.exitPortalGroup&&(this.exitPortalGroup.visible=!1)}},{key:"updatePortalVisibility",value:function(){if(this.game){var e="interior"===this.game.currentEnvironment;this.exitPortalGroup&&(this.exitPortalGroup.visible=e)}}},{key:"createPortalLabel",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=512,t.height=64,n.fillStyle="#00ff00",n.font="bold 32px Arial",n.textAlign="center",n.fillText("VIBEVERSE PORTAL",t.width/2,t.height/2);var o=new i.GOR(t),r=new i.bdM(30,5),a=new i.V9B({map:o,transparent:!0,side:i.$EB}),s=new i.eaF(r,a);s.position.y=20,e.add(s)}},{key:"createPortalParticles",value:function(e,t){var n=0,o=0,r=0;16711680===t?(n=1,o=0,r=0):(n=0,o=1,r=0);for(var a=new i.LoY,s=new Float32Array(3e3),l=new Float32Array(3e3),c=0;c<3e3;c+=3){var h=Math.random()*Math.PI*2,u=15+4*(Math.random()-.5);s[c]=Math.cos(h)*u,s[c+1]=Math.sin(h)*u,s[c+2]=4*(Math.random()-.5),l[c]=n*(.8+.2*Math.random()),l[c+1]=o*(.8+.2*Math.random()),l[c+2]=r*(.8+.2*Math.random())}a.setAttribute("position",new i.THS(s,3)),a.setAttribute("color",new i.THS(l,3));var m=new i.BH$({size:.2,vertexColors:!0,transparent:!0,opacity:.6}),p=new i.ONl(a,m);e.userData.particles=p,e.add(p)}},{key:"animatePortal",value:function(e){var t=this;if(e&&e.userData.particles){var n=function(){if(t.game&&"paused"!==t.game.gameState){for(var i=e.userData.particles.geometry.attributes.position.array,o=0;o<i.length;o+=3)i[o+1]+=.05*Math.sin(.001*Date.now()+o);e.userData.particles.geometry.attributes.position.needsUpdate=!0,requestAnimationFrame(n)}else requestAnimationFrame(n)};n()}}},{key:"update",value:function(){if("playing"===this.game.gameState&&(this.updatePortalVisibility(),this.game.player)){var e=this.game.player.position.clone(),t=new i.NRn;if(t.setFromCenterAndSize(e,new i.Pq0(5,5,5)),this.exitPortalBox&&"interior"===this.game.currentEnvironment){this.exitPortalBox.setFromObject(this.exitPortalGroup);var n=new i.Pq0;this.exitPortalBox.getCenter(n),e.distanceTo(n)<50&&t.intersectsBox(this.exitPortalBox)&&this.handleExitPortal()}if(this.startPortalBox&&this.startPortalGroup){this.startPortalBox.setFromObject(this.startPortalGroup);var o=new i.Pq0;this.startPortalBox.getCenter(o),e.distanceTo(o)<50&&t.intersectsBox(this.startPortalBox)&&this.handleStartPortal()}}}},{key:"handleExitPortal",value:function(){var e=new URLSearchParams;e.append("portal","true"),e.append("username","BeePilot"),e.append("color","yellow");var t=.5;if(this.game.player&&(this.game.player.currentProfile&&this.game.player.currentProfile.maxSpeed?t=this.game.player.currentProfile.maxSpeed:this.game.player.maxSpeed?t=this.game.player.maxSpeed:this.game.player.userData&&this.game.player.userData.speed&&(t=this.game.player.userData.speed)),e.append("speed",t),e.append("ref",window.location.href),this.game.player&&this.game.player.velocity&&(e.append("speed_x",this.game.player.velocity.x||0),e.append("speed_y",this.game.player.velocity.y||0),e.append("speed_z",this.game.player.velocity.z||0),this.game.player.quaternion)){var n=(new i.O9p).setFromQuaternion(this.game.player.quaternion);e.append("rotation_x",n.x),e.append("rotation_y",n.y),e.append("rotation_z",n.z)}window.location.href="http://portal.pieter.com?".concat(e.toString())}},{key:"handleStartPortal",value:function(){console.log("Player entered start portal")}}])&&Ie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}function Re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_e(i.key),i)}}function _e(e){var t=function(e){if("object"!=qe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==qe(t)?t:t+""}var Ve=function(){return e=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.isMobile=this.detectMobile(),this.elements={},this.touchIds={joystick:null,look:null},this.buttonSize=60,this.defaultMobileSensitivity=4,this.lastFrameTime=0,this.frameThrottle=80,this.isLowPerformanceMode=!1,this.lastMovementUpdate=0,this.movementThrottle=64,this.createControls(),this.checkAndShowMobileWarning(),document.addEventListener("fullscreenchange",(function(){return n.updateFullscreenButton()})),document.addEventListener("webkitfullscreenchange",(function(){return n.updateFullscreenButton()})),document.addEventListener("mozfullscreenchange",(function(){return n.updateFullscreenButton()})),document.addEventListener("MSFullscreenChange",(function(){return n.updateFullscreenButton()})),this.isMobile&&this.setupPerformanceMonitor()},t=[{key:"detectMobile",value:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=800&&window.innerHeight<=600||"ontouchstart"in window||navigator.maxTouchPoints>0}},{key:"createSensitivitySlider",value:function(){var e=this;if(this.isMobile&&this.game.player){this.removeSensitivityContainer();var t=document.createElement("div");t.id="mobile-sensitivity-container",t.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.7);padding:20px;border-radius:10px;z-index:2000;width:80%;max-width:400px;text-align:center;";var n=document.createElement("div");n.textContent="Touch Sensitivity",n.style.cssText="color:white;font-size:18px;margin-bottom:15px;",t.appendChild(n);var i=document.createElement("input");i.type="range",i.min="0.5",i.max="8.0",i.step="0.5",i.value=this.game.player.mouseSensitivity||this.defaultMobileSensitivity,i.style.cssText="width:100%;height:40px;",t.appendChild(i);var o=document.createElement("div");o.textContent=i.value+"x",o.style.cssText="color:white;margin-top:10px;font-size:16px;",t.appendChild(o),i.addEventListener("input",(function(){var t=parseFloat(i.value);e.game.player&&(e.game.player.mouseSensitivity=t),o.textContent=t.toFixed(1)+"x"})),document.body.appendChild(t),this.elements.sensitivityContainer=t}}},{key:"removeSensitivityContainer",value:function(){this.elements.sensitivityContainer&&this.elements.sensitivityContainer.parentNode&&(this.elements.sensitivityContainer.parentNode.removeChild(this.elements.sensitivityContainer),delete this.elements.sensitivityContainer)}},{key:"findSensitivitySlider",value:function(){var e,t=document.querySelector(".pause-screen")||document.getElementById("pauseScreen")||document.querySelector('[class*="pause"]');return t?t.querySelector('input[type="range"]')||(null===(e=Array.from(t.querySelectorAll("div")).find((function(e){return e.textContent.toLowerCase().includes("sensitivity")})))||void 0===e?void 0:e.querySelector("input")):null}},{key:"setupResumeListener",value:function(){var e=this;this.resumeListener&&document.removeEventListener("keydown",this.resumeListener),this.resumeListener=function(t){"Escape"===t.key&&"paused"===e.game.gameState&&setTimeout((function(){return e.removeSensitivityContainer()}),50)},document.addEventListener("keydown",this.resumeListener),this.stateCheckInterval||(this.stateCheckInterval=setInterval((function(){e.originalPauseState&&"playing"===e.game.gameState&&(e.removeSensitivityContainer(),e.originalPauseState=!1)}),100))}},{key:"createControls",value:function(){var e=this,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;",document.body.appendChild(t),this.elements.container=t,this.isMobile&&(this.createTopBarControls(),this.createJoystick(),this.createLookArea()),window.addEventListener("resize",(function(){return e.handleResize()})),this.isMobile&&this.positionElements(),this.hideControls()}},{key:"createTopBarControls",value:function(){var e=this,t=document.createElement("button");t.innerHTML="🔊",t.style.cssText="position:fixed;left:10px;top:10px;background:rgba(0,0,0,0.3);color:white;border:none;border-radius:5px;padding:8px;font-size:18px;z-index:1001;pointer-events:auto;",t.addEventListener("click",(function(){if(e.game.soundManager){var n=e.game.soundManager.toggleMute();t.innerHTML=n?"🔇":"🔊"}})),document.body.appendChild(t),this.elements.volume=t;var n=document.createElement("button");n.textContent="PAUSE",n.style.cssText="position:fixed;top:10px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.3);color:white;border:none;border-radius:5px;padding:3px 16px;font-size:14px;z-index:1001;pointer-events:auto;line-height:1.2;",n.addEventListener("click",(function(){e.game.togglePause&&e.game.togglePause()})),document.body.appendChild(n),this.elements.pause=n;var i=document.createElement("button");i.textContent="BOOST",i.style.cssText="position:fixed;bottom:20%;right:25px;background:rgba(0,0,0,0.4);color:white;border:2px solid rgba(255,255,255,0.5);border-radius:50%;width:50px;height:50px;font-size:12px;z-index:1001;pointer-events:auto;display:flex;align-items:center;justify-content:center;",i.addEventListener("touchstart",(function(t){if(t.preventDefault(),e.game&&e.game.player)if("function"==typeof e.game.player.boost)e.game.player.boost();else if("function"==typeof e.game.boost)e.game.boost();else{var n=new KeyboardEvent("keydown",{key:" ",code:"Space",keyCode:32});document.dispatchEvent(n)}i.style.backgroundColor="rgba(60,200,255,0.6)"})),i.addEventListener("touchend",(function(){i.style.backgroundColor="rgba(0,0,0,0.4)";var e=new KeyboardEvent("keyup",{key:" ",code:"Space",keyCode:32});document.dispatchEvent(e)})),document.body.appendChild(i),this.elements.boost=i;var o=document.createElement("button");o.innerHTML="⛶",o.style.cssText="position:fixed;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.4);color:white;border:none;border-radius:5px;padding:8px;font-size:18px;z-index:1001;pointer-events:auto;",o.addEventListener("click",(function(){return e.toggleFullscreen()})),document.body.appendChild(o),this.elements.fullscreen=o}},{key:"createJoystick",value:function(){var e=this,t=document.createElement("div");t.style.cssText="position:absolute;border-radius:50%;background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.5);pointer-events:auto;",this.elements.container.appendChild(t);var n=document.createElement("div");n.style.cssText="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);border-radius:50%;background:rgba(255,255,255,0.8);pointer-events:none;",t.appendChild(n),this.elements.joystick=t,this.elements.knob=n,t.addEventListener("touchstart",(function(n){if(n.preventDefault(),null===e.touchIds.joystick){var i=n.changedTouches[0];e.touchIds.joystick=i.identifier;var o=t.getBoundingClientRect();e.joystickCenter={x:o.left+o.width/2,y:o.top+o.height/2},e.processJoystickMovement(i.clientX,i.clientY)}})),t.addEventListener("touchmove",(function(t){t.preventDefault();for(var n=0;n<t.changedTouches.length;n++){var i=t.changedTouches[n];if(i.identifier===e.touchIds.joystick){e.processJoystickMovement(i.clientX,i.clientY);break}}}),{passive:!1});var i=function(t){for(var n=0;n<t.changedTouches.length;n++)if(t.changedTouches[n].identifier===e.touchIds.joystick){e.elements.knob.style.transform="translate(-50%, -50%)",e.game&&e.game.player&&(e.game.player.moveUp=!1,e.game.player.brake=!1,e.game.player.moveLeft=!1,e.game.player.accelarate=!1),e.touchIds.joystick=null;break}};t.addEventListener("touchend",i),t.addEventListener("touchcancel",i)}},{key:"createLookArea",value:function(){var e=this,t=document.createElement("div");t.style.cssText="position:absolute;top:0;right:0;width:50%;height:100%;pointer-events:auto;",this.elements.container.appendChild(t),this.elements.lookArea=t;var n=document.createElement("div");n.style.cssText="position:absolute;border-radius:50%;background:rgba(255,255,255,0.15);border:2px solid rgba(255,255,255,0.4);pointer-events:none;display:none;",this.elements.container.appendChild(n);var i=document.createElement("div");i.style.cssText="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);border-radius:50%;background:rgba(255,255,255,0.6);pointer-events:none;",n.appendChild(i),this.elements.lookJoystick=n,this.elements.lookKnob=i,this.lookPosition={x:0,y:0},this.lookActive=!1,this.lookJoystickCenter={x:0,y:0},this.isShooting=!1,this.touchStartTime=0,this.touchStartPos={x:0,y:0},this.touchMoved=!1;var o=0,r=0;t.addEventListener("touchstart",(function(t){if(null===e.touchIds.look){var n=t.changedTouches[0];if(e.touchIds.look=n.identifier,o=n.clientX,r=n.clientY,e.lookPosition={x:o,y:r},e.lookActive=!0,e.touchStartTime=performance.now(),e.touchStartPos={x:o,y:r},e.touchMoved=!1,e.elements.lookJoystick){var i=1.3*e.buttonSize;e.elements.lookJoystick.style.width="".concat(i,"px"),e.elements.lookJoystick.style.height="".concat(i,"px"),e.elements.lookJoystick.style.left="".concat(o-i/2,"px"),e.elements.lookJoystick.style.top="".concat(r-i/2,"px"),e.elements.lookJoystick.style.display="block",e.elements.lookKnob&&(e.elements.lookKnob.style.width="".concat(.4*i,"px"),e.elements.lookKnob.style.height="".concat(.4*i,"px")),e.lookJoystickCenter={x:o,y:r}}e.elements.fireBtn&&(e.elements.fireBtn.style.display="none"),e.fireShot()}})),t.addEventListener("touchmove",(function(t){if(null!==e.touchIds.look){var n=performance.now();if(!(n-e.lastFrameTime<e.frameThrottle)){e.lastFrameTime=n;for(var i=0;i<t.changedTouches.length;i++){var a=t.changedTouches[i];if(a.identifier===e.touchIds.look){var s=a.clientX-o,l=a.clientY-r;Math.sqrt(Math.pow(a.clientX-e.touchStartPos.x,2)+Math.pow(a.clientY-e.touchStartPos.y,2))>10&&(e.touchMoved=!0),e.game.player&&"function"==typeof e.game.player.handleMouseMove&&e.game.player.handleMouseMove(.8*s,.8*l),o=a.clientX,r=a.clientY,e.lookPosition={x:o,y:r},n-e.lastMovementUpdate>=e.movementThrottle&&(e.lastMovementUpdate=n,e.updateLookJoystickPosition(a.clientX,a.clientY));break}}}}}),{passive:!0});var a=function(t){for(var n=0;n<t.changedTouches.length;n++)if(t.changedTouches[n].identifier===e.touchIds.look){var i=Date.now()-e.touchStartTime;!e.touchMoved&&i<300&&(e.fireShot(),e.elements.lookKnob&&(e.elements.lookKnob.style.backgroundColor="rgba(255,60,60,0.8)",setTimeout((function(){e.elements.lookKnob&&(e.elements.lookKnob.style.backgroundColor="rgba(255,255,255,0.6)")}),150))),e.touchIds.look=null,e.lookActive=!1,setTimeout((function(){!e.lookActive&&e.elements.lookJoystick&&(e.elements.lookJoystick.style.display="none")}),200),e.isShooting&&(e.isShooting=!1),e.game&&(e.game.autoFireEnabled=!1);break}};t.addEventListener("touchend",a),t.addEventListener("touchcancel",a)}},{key:"updateLookJoystickPosition",value:function(e,t){if(this.lookActive&&this.elements.lookKnob&&this.lookJoystickCenter){var n=e-this.lookJoystickCenter.x,i=t-this.lookJoystickCenter.y,o=Math.sqrt(n*n+i*i),r=this.elements.lookJoystick.offsetWidth/2,a=Math.min(o,r),s=Math.atan2(i,n),l=o/r,c=a*Math.cos(s),h=a*Math.sin(s);this.isLowPerformanceMode?(this.elements.lookKnob.style.left="".concat(c,"px"),this.elements.lookKnob.style.top="".concat(h,"px")):this.elements.lookKnob.style.transform="translate(calc(-50% + ".concat(c,"px), calc(-50% + ").concat(h,"px))"),l>=.7?this.isShooting||(this.elements.lookKnob.style.backgroundColor="rgba(255,60,60,0.8)",this.isShooting=!0,this.fireShot()):this.isShooting&&(this.elements.lookKnob.style.backgroundColor="rgba(255,255,255,0.6)",this.isShooting=!1,this.game&&(this.game.autoFireEnabled=!1))}}},{key:"processJoystickMovement",value:function(e,t){if(this.joystickCenter){var n=performance.now();if(!(n-this.lastMovementUpdate<this.movementThrottle)){this.lastMovementUpdate=n;var i=e-this.joystickCenter.x,o=t-this.joystickCenter.y,r=Math.sqrt(i*i+o*o),a=this.elements.joystick.offsetWidth/2,s=Math.min(r,a),l=Math.atan2(o,i),c=s/a,h=s*Math.cos(l),u=s*Math.sin(l);if(this.isLowPerformanceMode?(this.elements.knob.style.left="".concat(h,"px"),this.elements.knob.style.top="".concat(u,"px")):this.elements.knob.style.transform="translate(calc(-50% + ".concat(h,"px), calc(-50% + ").concat(u,"px))"),this.game&&this.game.player&&(this.game.player.accelerate=!1,this.game.player.brake=!1,this.game.player.moveLeft=!1,this.game.player.moveRight=!1,c>.2)){var m=(l+2*Math.PI)%(2*Math.PI);(m<=Math.PI/4||m>7*Math.PI/4)&&(this.game.player.moveRight=!0),m>Math.PI/4&&m<=3*Math.PI/4&&(this.game.player.brake=!0),m>3*Math.PI/4&&m<=5*Math.PI/4&&(this.game.player.moveLeft=!0),m>5*Math.PI/4&&m<=7*Math.PI/4&&(this.game.player.accelerate=!0)}}}}},{key:"checkPauseState",value:function(){var e=this;if(this.game){var t="paused"===this.game.gameState;t!==this.originalPauseState&&(this.originalPauseState=t,t&&setTimeout((function(){var t=e.findSensitivitySlider();t?e.enhanceMobileSensitivitySlider(t):e.createSensitivitySlider()}),100))}}},{key:"enhanceMobileSensitivitySlider",value:function(e){e.style.height="30px",e.style.width="80%";var t=e.closest("div");t&&(t.style.background="rgba(0, 0, 0, 0.7)",t.style.padding="20px",t.style.borderRadius="10px")}},{key:"positionElements",value:function(){if(this.isMobile&&this.elements){var e=window.innerWidth,t=window.innerHeight,n=.03*Math.min(e,t);this.buttonSize=Math.min(.22*t,.1*e);var i=this.buttonSize;if(this.elements.joystick&&this.elements.joystick.style){var o=this.elements.joystick,r=1.3*i;if(o.style.width="".concat(r,"px"),o.style.height="".concat(r,"px"),o.style.bottom="".concat(.25*t,"px"),o.style.left="".concat(6*n,"px"),this.elements.knob&&this.elements.knob.style){var a=this.elements.knob;a.style.width="".concat(.4*r,"px"),a.style.height="".concat(.4*r,"px")}}if(this.elements.volume&&this.elements.volume.style&&(this.elements.volume.style.left="10px",this.elements.volume.style.top="10px"),this.elements.pause&&this.elements.pause.style&&(this.elements.pause.style.top="10px"),this.elements.fullscreen&&this.elements.fullscreen.style&&(this.elements.fullscreen.style.bottom="10px",this.elements.fullscreen.style.left="50%"),this.elements.boost&&this.elements.boost.style){var s=Math.min(.08*e,.08*t,50);this.elements.boost.style.width="".concat(s,"px"),this.elements.boost.style.height="".concat(s,"px"),this.elements.boost.style.bottom="".concat(.2*t,"px"),this.elements.boost.style.right="".concat(3*n,"px"),this.elements.boost.style.fontSize="".concat(.24*s,"px")}this.elements.lookArea&&this.elements.lookArea.style&&(this.elements.lookArea.style.width="50%",this.elements.lookArea.style.height="100%")}}},{key:"handleResize",value:function(){try{this.positionElements()}catch(e){console.warn("Error positioning mobile controls during resize:",e)}}},{key:"toggleFullscreen",value:function(){if(document.fullscreenElement){var e=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;e&&e.call(document),screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock()}else{var t=document.documentElement,n=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen||t.msRequestFullscreen;n&&n.call(t),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").catch((function(e){return console.warn("Screen orientation lock not supported:",e)}))}}},{key:"updateFullscreenButton",value:function(){var e=!!document.fullscreenElement;window.innerWidth,window.innerHeight,this.elements.fullscreen&&(e?this.elements.fullscreen.style.display="none":(this.elements.fullscreen.style.display="block",this.elements.fullscreen.innerHTML="⛶"))}},{key:"showControls",value:function(){var e=this;this.isMobile?this.game&&!0===this.game.forceDesktopControls?console.log("Desktop controls forced by game settings"):(this.game&&this.game.player&&(this.game.player.mouseSensitivity=this.defaultMobileSensitivity),this.elements.container&&(this.elements.container.style.display="block"),Object.keys(this.elements).forEach((function(t){var n=e.elements[t];n&&n.style&&("fullscreen"===t?n.style.display=document.fullscreenElement?"none":"block":"sensitivityContainer"===t?n.style.display=e.game&&"paused"===e.game.gameState?"block":"none":"container"!==t&&(n.style.display="block"))})),console.log("Mobile controls shown with sensitivity:",this.defaultMobileSensitivity)):console.log("Not showing mobile controls on desktop device")}},{key:"showSensitivityControls",value:function(e){if(this.isMobile&&(this.removeSensitivityContainer(),!1!==e)){var t=document.querySelector("#vibejam-overlay")||document.querySelector(".game-screen")||document.querySelector('[class*="pause"]');t&&Array.from(t.querySelectorAll("div")).filter((function(e){return e.textContent&&e.textContent.includes("Mouse Sensitivity")})).forEach((function(e){e&&e.style&&(e.style.display="none")})),this.createSensitivitySlider(),this.originalPauseState="paused"===this.game.gameState,this.setupResumeListener()}}},{key:"hideControls",value:function(){this.isMobile&&(this.elements.container.style.display="none",Object.values(this.elements).forEach((function(e){e&&e.style&&(e.style.display="none")})),this.removeSensitivityContainer(),this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=null),this.resumeListener&&(document.removeEventListener("keydown",this.resumeListener),this.resumeListener=null))}},{key:"fireShot",value:function(){this.game&&(this.game.inCombat=!0,this.game.currentEnvironment="interior",this.game.playerShoot(),this.game.autoFireEnabled=!0,this.game.lastAutoFireTime=performance.now())}},{key:"checkAndShowMobileWarning",value:function(){var e=this;setTimeout((function(){e.isMobile=e.detectMobile(),e.isMobile&&!document.fullscreenElement&&e.createFullscreenWarning()}),500)}},{key:"createFullscreenWarning",value:function(){var e=document.createElement("div");e.innerHTML="Please toggle fullscreen for better experience →",e.style.cssText="position:fixed;top:50px;left:0;right:0;text-align:center;background:rgba(0,0,0,0.8);color:white;padding:12px;z-index:9999;font-size:18px;font-weight:bold;",document.body.appendChild(e),this.elements.fullscreenWarning=e,setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),8e3),document.addEventListener("fullscreenchange",(function(){document.fullscreenElement&&e.parentNode&&e.parentNode.removeChild(e)}),{once:!0})}},{key:"setupPerformanceMonitor",value:function(){var e=this,t=0,n=performance.now(),i=0,o=function(){var r=performance.now();if(t++,r-n>=1e3){var a=Math.round(1e3*t/(r-n));t=0,n=r,a<30?++i>=2&&!e.isLowPerformanceMode&&e.enableLowPerformanceMode():i=0}requestAnimationFrame(o)};requestAnimationFrame(o)}},{key:"enableLowPerformanceMode",value:function(){this.isLowPerformanceMode||(console.log("Enabling low performance mode for mobile"),this.isLowPerformanceMode=!0,this.frameThrottle=32,this.movementThrottle=64,this.game&&"function"==typeof this.game.setLowPerformanceMode?this.game.setLowPerformanceMode(!0):this.game&&(this.game.lowPerformanceMode=!0,this.game.particleSystem&&(this.game.particleSystem.maxParticles=Math.floor(.5*this.game.particleSystem.maxParticles))))}}],t&&Re(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Ue(e){return Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(e)}function Ne(){Ne=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,i){var r=t&&t.prototype instanceof v?t:v,a=Object.create(r.prototype),s=new L(i||[]);return o(a,"_invoke",{value:C(e,n,s)}),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var m="suspendedStart",p="suspendedYield",d="executing",y="completed",f={};function v(){}function g(){}function b(){}var w={};c(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(B([])));k&&k!==n&&i.call(k,a)&&(w=k);var S=b.prototype=v.prototype=Object.create(w);function P(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){function n(o,r,a,s){var l=u(e[o],e,r);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==Ue(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var r;o(this,"_invoke",{value:function(e,i){function o(){return new t((function(t,o){n(e,i,t,o)}))}return r=r?r.then(o,o):o()}})}function C(t,n,i){var o=m;return function(r,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===r)throw a;return{value:e,done:!0}}for(i.method=r,i.arg=a;;){var s=i.delegate;if(s){var l=E(s,i);if(l){if(l===f)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===m)throw o=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=d;var c=u(t,n,i);if("normal"===c.type){if(o=i.done?y:p,c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(o=y,i.method="throw",i.arg=c.arg)}}}function E(t,n){var i=n.method,o=t.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var r=u(o,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,f;var a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,f):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function B(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,r=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(Ue(t)+" is not iterable")}return g.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},P(M.prototype),c(M.prototype,s,(function(){return this})),t.AsyncIterator=M,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new M(h(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},P(S),c(S,l,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=B,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(i,o){return s.type="throw",s.arg=t,n.next=i,o&&(n.method="next",n.arg=e),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;A(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:B(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}function Ye(e,t,n,i,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}function Qe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,We(i.key),i)}}function We(e){var t=function(e){if("object"!=Ue(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ue(t)?t:t+""}var Ke=[{name:"shoot",path:"assets/sounds/shoot.mp3"},{name:"pickup",path:"assets/sounds/pickup.mp3"},{name:"damage",path:"assets/sounds/damage.mp3"},{name:"damage",path:"assets/sounds/enemyHit.mp3"},{name:"damage",path:"assets/sounds/enemyDefeat.mp3"},{name:"main_track_1",path:"assets/sounds/vibe_Jam.mp3"},{name:"main_track_2",path:"assets/sounds/Buzz_Revolution.mp3"}],Je=["main_track_1","main_track_2"],Xe=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.assetManager=new d(this),this.soundManager=new x,this.loadingScreen=new s(this),this.setupRenderer(),this.setupScene(),this.setupCamera(),this.fpsCounter=new D({updateInterval:50,samples:20}),this.targetFPS=100,this.frameDuration=1e3/this.targetFPS,this.frameTimeBudget=0,this.lastAnimationTime=0,this.ui=new A(this),this.gameState="loading",this.currentEnvironment="exterior",this.isPointerLockPending=!1,this.inCombat=!1,this.playerHealth=100,this.isMobile=!1,this.autoFireEnabled=!1,this.lastAutoFireTime=0,this.initializeGame(),this.setupEventListeners(),this.animate(),this.mobileManager=new Ve(this),this.portalSystem=new Ge(this)},t=[{key:"initializeGame",value:(n=Ne().mark((function e(){var t=this;return Ne().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.assetManager.init((function(e){t.loadingScreen&&t.loadingScreen.updateProgress(e.progress);var n=document.getElementById("loading-progress");n&&(n.style.width="".concat(e.progress,"%"))}));case 3:return this.player=new I(this),this.collisionSystem=new Ee(this),this.treeHive=new M(this),this.treeHive.treeGroup&&(this.treeHive.treeGroup.visible=!1),this.skybox=new Oe(this),this.skybox.skyboxMesh&&(this.skybox.skyboxMesh.visible=!1),this.scene.background=new i.Q1f(0),this.particlePool=new Be({scene:this.scene}),this.combatArena=new fe(this),this.combatArena.arenaGroup.visible=!1,e.next=15,this.soundManager.loadSounds(Ke);case 15:this.soundManager.playMusic(Je),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(0),console.error("Error initializing game:",e.t0),this.loadingScreen;case 22:case"end":return e.stop()}}),e,this,[[0,18]])})),o=function(){var e=this,t=arguments;return new Promise((function(i,o){var r=n.apply(e,t);function a(e){Ye(r,i,o,a,s,"next",e)}function s(e){Ye(r,i,o,a,s,"throw",e)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"setupRenderer",value:function(){this.renderer=new i.JeP({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight);var e=this.isMobile?1:1.5;this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,e)),this.isMobile&&(this.renderer.antialias=!1),document.body.appendChild(this.renderer.domElement)}},{key:"setupScene",value:function(){this.scene=new i.Z58}},{key:"setupCamera",value:function(){this.camera=new i.ubm(75,window.innerWidth/window.innerHeight,1,this.isMobile?5e3:1e4),this.camera.position.set(0,5,15),this.cameraTarget=new i.Pq0(0,0,0),this.camera.lookAt(this.cameraTarget)}},{key:"setupEventListeners",value:function(){var e=this;window.addEventListener("resize",(function(){return e.onWindowResize()})),window.addEventListener("keydown",(function(t){return e.handleKeyDown(t)})),window.addEventListener("keyup",(function(t){return e.handleKeyUp(t)})),document.addEventListener("mousemove",(function(t){return e.handleMouseMove(t)})),document.addEventListener("mousedown",(function(t){"playing"===e.gameState&&e.isPointerLocked&&"interior"===e.currentEnvironment&&e.inCombat&&(e.playerShoot(),e.autoFireEnabled=!0,e.lastAutoFireTime=performance.now())})),document.addEventListener("mouseup",(function(){e.player&&(e.player.moveUp=!1),e.autoFireEnabled=!1})),this.renderer.domElement.addEventListener("click",(function(){"playing"!==e.gameState||e.isPointerLocked||e.lockPointer()})),document.addEventListener("pointerlockchange",(function(){return e.handlePointerLockChange()})),document.addEventListener("pointerlockerror",(function(){return console.error("Pointer lock error")})),this.setupMobileControls()}},{key:"setupMobileControls",value:function(){}},{key:"checkMobileDevice",value:function(){return this.isMobile=!!this.mobileManager&&this.mobileManager.isMobile,this.isMobile}},{key:"handleMobileRotation",value:function(e,t){this.mobileManager&&this.mobileManager.applyLookToPlayer(e,t)}},{key:"lockPointer",value:function(){if(!this.isPointerLockPending&&!this.isPointerLocked)try{this.isPointerLockPending=!0,this.renderer.domElement.requestPointerLock=this.renderer.domElement.requestPointerLock||this.renderer.domElement.mozRequestPointerLock||this.renderer.domElement.webkitRequestPointerLock,this.renderer.domElement.requestPointerLock()}catch(e){console.log("Pointer lock request failed:",e),this.isPointerLockPending=!1}}},{key:"handlePointerLockChange",value:function(){this.isPointerLocked=document.pointerLockElement===this.renderer.domElement||document.mozPointerLockElement===this.renderer.domElement||document.webkitPointerLockElement===this.renderer.domElement,this.isPointerLockPending=!1,this.isPointerLocked||"playing"!==this.gameState?this.hideClickToPlayOverlay():this.showClickToPlayOverlay()}},{key:"showClickToPlayOverlay",value:function(){var e=this;this.clickToPlayOverlay?this.clickToPlayOverlay.style.display="flex":(this.clickToPlayOverlay=document.createElement("div"),this.clickToPlayOverlay.style.position="absolute",this.clickToPlayOverlay.style.top="0",this.clickToPlayOverlay.style.left="0",this.clickToPlayOverlay.style.width="100%",this.clickToPlayOverlay.style.height="100%",this.clickToPlayOverlay.style.display="flex",this.clickToPlayOverlay.style.alignItems="center",this.clickToPlayOverlay.style.justifyContent="center",this.clickToPlayOverlay.style.backgroundColor="rgba(0, 0, 0, 0.4)",this.clickToPlayOverlay.style.color="white",this.clickToPlayOverlay.style.fontSize="24px",this.clickToPlayOverlay.style.cursor="pointer",this.clickToPlayOverlay.style.zIndex="100",this.clickToPlayOverlay.innerHTML="Click to control bee",this.clickToPlayOverlay.addEventListener("click",(function(){e.lockPointer(),e.hideClickToPlayOverlay()})),document.body.appendChild(this.clickToPlayOverlay))}},{key:"hideClickToPlayOverlay",value:function(){this.clickToPlayOverlay&&(this.clickToPlayOverlay.style.display="none")}},{key:"handleMouseMove",value:function(e){if("playing"===this.gameState)if(this.isPointerLocked){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;this.lastMouseX=t,this.lastMouseY=n,this.player.handleMouseMove(t,n)}else{var i=window.innerWidth/2,o=window.innerHeight/2,r=.05*(e.clientX-i),a=.05*(e.clientY-o);this.player.handleMouseMove(r,a)}}},{key:"handleKeyDown",value:function(e){if("menu"!==this.gameState&&"gameover"!==this.gameState&&"victory"!==this.gameState)switch(e.code){case"KeyW":case"ArrowUp":this.player.accelerate=!0;break;case"KeyS":case"ArrowDown":this.player.brake=!0;break;case"KeyA":case"ArrowLeft":this.player.moveLeft=!0;break;case"KeyD":case"ArrowRight":this.player.moveRight=!0;break;case"Space":this.player.boost();break;case"KeyP":"playing"!==this.gameState&&"paused"!==this.gameState||(this.escapeKeyPressed=!0,this.togglePause())}else"Space"!==e.code&&"Enter"!==e.code||this.startGame()}},{key:"handleKeyUp",value:function(e){switch(e.code){case"KeyW":case"ArrowUp":this.player.accelerate=!1;break;case"KeyS":case"ArrowDown":this.player.brake=!1;break;case"KeyA":case"ArrowLeft":this.player.moveLeft=!1;break;case"KeyD":case"ArrowRight":this.player.moveRight=!1}}},{key:"startGame",value:function(){var e=this,t="true"===new URLSearchParams(window.location.search).get("portal"),n="gameover"===this.gameState&&"interior"===this.currentEnvironment;this.soundManager&&this.soundManager.resumeContext(),this.player&&(this.player.position.set(0,50,n?30:50),this.player.velocity.set(0,0,0)),this.resetGameElements(n),this.gameState="playing",this.startTime=performance.now(),this.lastFrameTime=performance.now(),this.elapsedTime=0,this.ui.updateGameState(this.gameState),t||this.lockPointer(),this.mobileManager&&(this.mobileManager.isMobile||this.forceMobileControls?this.mobileManager.showControls():this.mobileManager.hideControls()),t||n?(this.treeHive.treeGroup.visible=!1,this.currentEnvironment="interior",this.combatArena&&(this.combatArena.arenaGroup.visible=!0,setTimeout((function(){console.log("Re-initializing combat arena..."),e.combatArena.initializeCombat(),e.inCombat=!0,e.player&&(e.player.position.set(0,50,30),e.player.velocity.set(0,0,0),e.player.updateCamera())}),100))):(this.treeHive&&(this.treeHive.treeGroup.visible=!0),this.currentEnvironment="exterior",this.inCombat=!1,this.combatArena&&(this.combatArena.arenaGroup.visible=!1)),this.skybox&&(this.skybox.currentZone=this.currentEnvironment,"interior"===this.currentEnvironment&&this.skybox.interiorHive&&(this.scene.background=this.skybox.interiorHive)),this.touchRotationArea&&(this.touchRotationArea.style.display="block"),this.combatArena&&this.combatArena.enemyManager&&setTimeout((function(){e.combatArena.enemyManager.spawnBoss()}),9e6)}},{key:"resetGameElements",value:function(){var e="gameover"===this.gameState&&"interior"===this.currentEnvironment?this.currentEnvironment:"exterior";this.maze&&this.maze.reset(),this.combatArena&&this.combatArena.reset(),this.player&&this.player.reset(),this.combatArena&&this.combatArena.enemyManager&&this.combatArena.enemyManager.reset(),this.collisionSystem&&(this.collisionSystem.reset(),this.collidersRegistered=!1,this.mazeCollidersRegistered=!1),this.currentEnvironment=e,this.inCombat="interior"===e,this.playerHealth=100}},{key:"switchEnvironment",value:function(e){var t=this;if(this.currentEnvironment!==e){if(this.player&&this.player.switchMovementProfile(e),"interior"===e)return this.currentEnvironment="interior",this.treeHive&&(this.treeHive.treeGroup.visible=!1,this.treeHive.backgroundPlane&&(this.treeHive.backgroundPlane.visible=!1)),this.skybox&&(this.skybox.currentZone="interior",this.skybox.interiorHive?(this.scene.background=this.skybox.interiorHive,this.scene.environment=null):this.scene.background=new i.Q1f(13016173)),this.renderer&&(this.renderer.autoClear=!0,this.renderer.sortObjects=!0),this.combatArena&&(this.combatArena.arenaGroup.visible=!0,setTimeout((function(){t.combatArena.initializeCombat(),t.inCombat=!0}),1e3)),this.portalSystem&&"function"==typeof this.portalSystem.updatePortalVisibility&&this.portalSystem.updatePortalVisibility(),void(this.player&&(this.player.position.set(0,50,30),this.player.velocity.set(0,0,0)));"exterior"===e&&(this.currentEnvironment="exterior",this.portalSystem&&"function"==typeof this.portalSystem.updatePortalVisibility&&this.portalSystem.updatePortalVisibility())}}},{key:"playerShoot",value:function(){var e;if(this.inCombat&&"interior"===this.currentEnvironment){var t=this.player.position.clone(),n=new i.Pq0(0,0,-1).applyQuaternion(this.player.currentRotation),o=t.clone().add(n.clone().multiplyScalar(1.5));if(this.weaponPowerUpActive){if(this.combatArena&&this.combatArena.bulletManager){var r=this.combatArena.bulletManager,a=r.config.playerCooldown;r.config.playerCooldown=0;var s=r.lastPlayerShotTime;r.lastPlayerShotTime=0;try{for(var l=[-.3,-.1,.1,.3],c=0;c<l.length;c++){var h=l[c],u=(new i.kn4).makeRotationY(h),m=n.clone().applyMatrix4(u),p=r.createBullet(o.clone(),m,!0);p&&(p.userData.damage=30)}this.soundManager&&this.soundManager.playSound("shoot")}finally{r.config.playerCooldown=a,r.lastPlayerShotTime=s}}}else{var d=(null===(e=this.combatArena)||void 0===e||null===(e=e.enemyManager)||void 0===e?void 0:e.killCount)||0,y=1,f=1;if(d>=5&&(y=2,f=1.5),d>=15&&(y=3,f=2),d>=30&&(y=4,f=2.5),this.combatArena&&this.combatArena.bulletManager){var v=this.combatArena.bulletManager,g=v.config.playerCooldown;v.config.playerCooldown=0;var b=v.lastPlayerShotTime;v.lastPlayerShotTime=0;try{var w=[];1===y?w.push(0):2===y?w.push(-.1,.1):3===y?w.push(-.2,0,.2):4===y&&w.push(-.3,-.1,.1,.3);for(var x=0;x<w.length;x++){var k=w[x],S=void 0;if(0===k)S=n.clone();else{var P=(new i.kn4).makeRotationY(k);S=n.clone().applyMatrix4(P)}var M=v.createBullet(o.clone(),S,!0);M&&(M.scale.multiplyScalar(f),M.userData.damage=25*f)}this.soundManager&&this.soundManager.playSound("shoot")}finally{v.config.playerCooldown=g,v.lastPlayerShotTime=b}}}}}},{key:"handlePlayerHit",value:function(){if(this.playerHealth-=10,this.soundManager.playSound("damage"),this.particlePool&&this.player){var e=this.isMobile?8:15;this.particlePool.createEffect({type:"spark",position:this.player.position.clone(),count:e,spread:1,velocity:.3,maxLifetime:30,acceleration:new i.Pq0(0,0,0),onUpdate:function(e){e.material&&e.material.color.setRGB(1,.3,.3),e.material.opacity-=.05}})}this.playerHealth<=0&&this.endGame(!1)}},{key:"endGame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.gameState=e?"victory":"gameover",this.ui.updateGameState(this.gameState,this.elapsedTime),document.exitPointerLock&&document.exitPointerLock(),this.touchRotationArea&&(this.touchRotationArea.style.display="none"),this.mobileManager&&this.mobileManager.hideControls()}},{key:"togglePause",value:function(){if("playing"===this.gameState){if(this.gameState="paused",this.ui.updateGameState(this.gameState),this.mobileManager&&this.mobileManager.isMobile)try{"function"==typeof this.mobileManager.showSensitivityControls&&this.mobileManager.showSensitivityControls(!0)}catch(e){console.warn("Error showing mobile sensitivity controls:",e)}}else if("paused"===this.gameState){if(this.gameState="playing",this.mobileManager&&this.mobileManager.isMobile)try{"function"==typeof this.mobileManager.showSensitivityControls&&this.mobileManager.showSensitivityControls(!1)}catch(e){console.warn("Error hiding mobile sensitivity controls:",e)}this.ui.updateGameState(this.gameState)}}},{key:"onWindowResize",value:function(){if(this.renderer.setSize(window.innerWidth,window.innerHeight),this.mobileManager){this.isMobile=this.mobileManager.isMobile;var e=this.isMobile?1:1.5;this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,e)),"function"==typeof this.mobileManager.handleResize&&this.mobileManager.handleResize()}this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{key:"createHoneyParticles",value:function(){var e=this.isMobile?.03:.1;if(!(Math.random()>e)&&this.particlePool){var t=this.isMobile?0:1;if(0===t)return;var n=new i.Pq0(6*(Math.random()-.5),6*(Math.random()-.5),15-5*Math.random());this.particlePool.createHoneyDrip(n,{count:t,velocity:.03,lifetime:100+Math.floor(50*Math.random())})}}},{key:"startCombat",value:function(){this.inCombat=!1,this.combatArena&&(this.combatArena.initializeCombat(),this.combatArena.arenaGroup.visible=!0,this.maze&&(this.maze.mazeGroup.visible=!1))}},{key:"checkEnvironmentCollisions",value:function(){"interior"===this.currentEnvironment&&this.inCombat&&this.combatArena&&this.collisionSystem&&this.collisionSystem.checkCollisions(this.player,this.player.radius)}},{key:"update",value:function(e){if("playing"===this.gameState){if(this.player&&this.player.update(),"exterior"===this.currentEnvironment?this.treeHive&&this.treeHive.update():"interior"===this.currentEnvironment&&this.combatArena&&this.combatArena.update(),this.autoFireEnabled&&this.inCombat&&"interior"===this.currentEnvironment){var t=performance.now();t-this.lastAutoFireTime>80&&(this.playerShoot(),this.lastAutoFireTime=t)}if(this.collisionSystem&&this.collisionSystem.checkCollisions(this.player,this.player.radius),this.portalSystem&&this.portalSystem.update(),this.particlePool&&this.particlePool.update(),this.player&&this.player.position){var n=this.player.position.x,i=this.player.position.y,o=this.player.position.z;n*n+i*i+o*o<225&&"interior"!==this.currentEnvironment&&this.switchEnvironment("interior")}"interior"===this.currentEnvironment&&(this.inCombat&&this.combatArena?this.combatArena.update(e):this.maze&&this.maze.update(e),this.skybox&&this.skybox.update(e)),this.checkEnvironmentCollisions()}else"loading"===this.gameState&&this.loadingScreen}},{key:"setTargetFrameRate",value:function(e){this.targetFPS=e,this.frameDuration=1e3/e,console.log("Frame rate limiter set to ".concat(e,"fps"))}},{key:"animate",value:function(e){var t=this;if(requestAnimationFrame((function(e){return t.animate(e)})),this.lastAnimationTime){var n=e-this.lastAnimationTime;if(this.frameTimeBudget+=n,this.hasSetAdaptiveFPS||(this.hasSetAdaptiveFPS=!0,this.isMobile||this.mobileManager&&this.mobileManager.isMobile||this.fpsCounter&&this.fpsCounter.fps<40?(this.targetFPS=200,this.frameDuration=1e3/this.targetFPS):console.log("Frame limiter: Using ".concat(this.targetFPS,"fps"))),this.frameTimeBudget>=this.frameDuration){performance.now();var i=Math.min(this.frameDuration,this.frameTimeBudget);if(this.fpsCounter&&this.fpsCounter.update(),"menu"===this.gameState&&this.treeHive){if(this.treeHive.treeGroup.visible=!0,this.skybox&&this.skybox.skyboxMesh&&(this.skybox.skyboxMesh.visible=!1),this.treeHive.backgroundPlane){var o=this.camera.position.clone();this.treeHive.backgroundPlane.position.set(0,0,-500),this.treeHive.backgroundPlane.lookAt(o)}this.treeHive.backgroundTexture&&(this.treeHive.backgroundTexture.needsUpdate=!0)}"paused"!==this.gameState&&(this.update(i),"interior"===this.currentEnvironment&&this.renderer?this.renderer.sortObjects=!0:this.renderer&&(this.renderer.sortObjects=!1),this.renderer.render(this.scene,this.camera)),this.frameTimeBudget-=this.frameDuration,this.frameTimeBudget=Math.min(this.frameTimeBudget,3*this.frameDuration)}this.lastAnimationTime=e}else this.lastAnimationTime=e}}],t&&Qe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o}();const $e=Xe}}]);